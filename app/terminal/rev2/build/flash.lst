ARM GAS  /tmp/cc2q6PEf.s 			page 1


   1              		.cpu cortex-m7
   2              		.arch armv7e-m
   3              		.fpu fpv5-d16
   4              		.eabi_attribute 28, 1
   5              		.eabi_attribute 20, 1
   6              		.eabi_attribute 21, 1
   7              		.eabi_attribute 23, 3
   8              		.eabi_attribute 24, 1
   9              		.eabi_attribute 25, 1
  10              		.eabi_attribute 26, 1
  11              		.eabi_attribute 30, 1
  12              		.eabi_attribute 34, 1
  13              		.eabi_attribute 18, 4
  14              		.file	"flash.c"
  15              		.text
  16              	.Ltext0:
  17              		.cfi_sections	.debug_frame
  18              		.file 1 "../../../mod/flash/flash.c"
  19              		.section	.text.address_to_bytes,"ax",%progbits
  20              		.align	1
  21              		.syntax unified
  22              		.thumb
  23              		.thumb_func
  25              	address_to_bytes:
  26              	.LVL0:
  27              	.LFB155:
   1:../../../mod/flash/flash.c **** /*******************************************************************************
   2:../../../mod/flash/flash.c **** *
   3:../../../mod/flash/flash.c **** * FILE: 
   4:../../../mod/flash/flash.c **** * 		flash.c
   5:../../../mod/flash/flash.c **** *
   6:../../../mod/flash/flash.c **** * DESCRIPTION: 
   7:../../../mod/flash/flash.c **** * 		Contains API functions for writing and reading data from the engine 
   8:../../../mod/flash/flash.c **** *       controller's flash 
   9:../../../mod/flash/flash.c **** *
  10:../../../mod/flash/flash.c **** *******************************************************************************/
  11:../../../mod/flash/flash.c **** 
  12:../../../mod/flash/flash.c **** 
  13:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
  14:../../../mod/flash/flash.c ****  Standard Includes                                                                     
  15:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
  16:../../../mod/flash/flash.c **** #include <string.h>
  17:../../../mod/flash/flash.c **** 
  18:../../../mod/flash/flash.c **** 
  19:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
  20:../../../mod/flash/flash.c ****  MCU Pins 
  21:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
  22:../../../mod/flash/flash.c **** #if   defined( FLIGHT_COMPUTER   )
  23:../../../mod/flash/flash.c **** 	#include "sdr_pin_defines_A0002.h"
  24:../../../mod/flash/flash.c **** #elif defined( ENGINE_CONTROLLER )
  25:../../../mod/flash/flash.c **** 	#include "sdr_pin_defines_L0002.h"
  26:../../../mod/flash/flash.c **** #endif 
  27:../../../mod/flash/flash.c **** 
  28:../../../mod/flash/flash.c **** 
  29:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
  30:../../../mod/flash/flash.c ****  Project Includes                                                                     
  31:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
ARM GAS  /tmp/cc2q6PEf.s 			page 2


  32:../../../mod/flash/flash.c **** #include "main.h"
  33:../../../mod/flash/flash.c **** #include "flash.h"
  34:../../../mod/flash/flash.c **** #include "usb.h"
  35:../../../mod/flash/flash.c **** #include "led.h"
  36:../../../mod/flash/flash.c **** 
  37:../../../mod/flash/flash.c **** 
  38:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
  39:../../../mod/flash/flash.c ****  Global Variables 
  40:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
  41:../../../mod/flash/flash.c **** static bool write_enabled = false;
  42:../../../mod/flash/flash.c **** 
  43:../../../mod/flash/flash.c **** 
  44:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
  45:../../../mod/flash/flash.c ****  Internal function prototypes 
  46:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
  47:../../../mod/flash/flash.c **** 
  48:../../../mod/flash/flash.c **** /* Converts a flash memory address in uint32_t format to a byte array */
  49:../../../mod/flash/flash.c **** static void address_to_bytes
  50:../../../mod/flash/flash.c **** 	(
  51:../../../mod/flash/flash.c **** 	uint32_t address,
  52:../../../mod/flash/flash.c **** 	uint8_t* address_bytes
  53:../../../mod/flash/flash.c **** 	);
  54:../../../mod/flash/flash.c **** 
  55:../../../mod/flash/flash.c **** /* Converts a flash memory address in byte format to uint32_t format */
  56:../../../mod/flash/flash.c **** static inline uint32_t bytes_to_address 
  57:../../../mod/flash/flash.c **** 	(
  58:../../../mod/flash/flash.c **** 	uint8_t address_bytes[3]
  59:../../../mod/flash/flash.c **** 	);
  60:../../../mod/flash/flash.c **** 
  61:../../../mod/flash/flash.c **** /* Enable writing to the external flash chip hardware */
  62:../../../mod/flash/flash.c **** static FLASH_STATUS write_enable
  63:../../../mod/flash/flash.c ****     (
  64:../../../mod/flash/flash.c ****     void 
  65:../../../mod/flash/flash.c ****     );
  66:../../../mod/flash/flash.c **** 
  67:../../../mod/flash/flash.c **** /* Disable writing to the external flash chip hardware */
  68:../../../mod/flash/flash.c **** static FLASH_STATUS write_disable 
  69:../../../mod/flash/flash.c ****     (
  70:../../../mod/flash/flash.c ****     void 
  71:../../../mod/flash/flash.c ****     );
  72:../../../mod/flash/flash.c **** 
  73:../../../mod/flash/flash.c **** 
  74:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
  75:../../../mod/flash/flash.c ****  Procedures 
  76:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
  77:../../../mod/flash/flash.c **** 
  78:../../../mod/flash/flash.c **** 
  79:../../../mod/flash/flash.c **** /*******************************************************************************
  80:../../../mod/flash/flash.c **** *                                                                              *
  81:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   * 
  82:../../../mod/flash/flash.c **** * 		flash_cmd_execute                                                      *
  83:../../../mod/flash/flash.c **** *                                                                              *
  84:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 * 
  85:../../../mod/flash/flash.c **** * 		Executes a flash subcommand based on input from the sdec terminal      *
  86:../../../mod/flash/flash.c **** *                                                                              *
  87:../../../mod/flash/flash.c **** *******************************************************************************/
  88:../../../mod/flash/flash.c **** FLASH_STATUS flash_cmd_execute
ARM GAS  /tmp/cc2q6PEf.s 			page 3


  89:../../../mod/flash/flash.c **** 	(
  90:../../../mod/flash/flash.c ****     uint8_t             subcommand   ,
  91:../../../mod/flash/flash.c **** 	HFLASH_BUFFER*      pflash_handle
  92:../../../mod/flash/flash.c ****     )
  93:../../../mod/flash/flash.c **** {
  94:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
  95:../../../mod/flash/flash.c ****  Local Variables 
  96:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
  97:../../../mod/flash/flash.c **** uint8_t          opcode;              /* Subcommand opcode                    */
  98:../../../mod/flash/flash.c **** uint8_t          num_bytes;           /* Number of bytes on which to 
  99:../../../mod/flash/flash.c ****                                          operate                              */
 100:../../../mod/flash/flash.c **** uint8_t          address[3];          /* flash address in byte form           */
 101:../../../mod/flash/flash.c **** uint8_t*         pbuffer;             /* Position within flash buffer         */
 102:../../../mod/flash/flash.c **** uint8_t          buffer[512];         /* buffer (flash extract)               */
 103:../../../mod/flash/flash.c **** FLASH_STATUS     flash_status;        /* Return value of flash API calls      */
 104:../../../mod/flash/flash.c **** USB_STATUS       usb_status;          /* Return value of USB API calls        */
 105:../../../mod/flash/flash.c **** 
 106:../../../mod/flash/flash.c **** 
 107:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 108:../../../mod/flash/flash.c ****  Pre-processing 
 109:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 110:../../../mod/flash/flash.c **** opcode    = ( subcommand & FLASH_SUBCMD_OP_BITMASK ) >>  5;
 111:../../../mod/flash/flash.c **** num_bytes = ( subcommand & FLASH_NBYTES_BITMASK    ); 
 112:../../../mod/flash/flash.c **** pflash_handle -> num_bytes = num_bytes;
 113:../../../mod/flash/flash.c **** pbuffer   = &buffer[0];
 114:../../../mod/flash/flash.c **** memset( pbuffer, 0, sizeof( buffer ) );
 115:../../../mod/flash/flash.c **** address_to_bytes( pflash_handle -> address, &address[0] );
 116:../../../mod/flash/flash.c **** 
 117:../../../mod/flash/flash.c **** 
 118:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 119:../../../mod/flash/flash.c ****  Call API function 
 120:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 121:../../../mod/flash/flash.c **** switch ( opcode )
 122:../../../mod/flash/flash.c **** 	{
 123:../../../mod/flash/flash.c ****     /*-----------------------------READ Subcommand----------------------------*/
 124:../../../mod/flash/flash.c ****     case FLASH_SUBCMD_READ:
 125:../../../mod/flash/flash.c ****         {
 126:../../../mod/flash/flash.c **** 
 127:../../../mod/flash/flash.c **** 		/* Get flash address from USB */
 128:../../../mod/flash/flash.c **** 		usb_status = usb_receive( &( address[0] )  , 
 129:../../../mod/flash/flash.c ****                                   sizeof( address ), 
 130:../../../mod/flash/flash.c ****                                   HAL_DEFAULT_TIMEOUT );
 131:../../../mod/flash/flash.c **** 		
 132:../../../mod/flash/flash.c **** 		if ( usb_status != USB_OK )
 133:../../../mod/flash/flash.c **** 			{
 134:../../../mod/flash/flash.c **** 			return FLASH_USB_ERROR;
 135:../../../mod/flash/flash.c **** 			}
 136:../../../mod/flash/flash.c **** 		else
 137:../../../mod/flash/flash.c **** 			{
 138:../../../mod/flash/flash.c **** 			/* Call API Function */
 139:../../../mod/flash/flash.c **** 			pflash_handle -> address = bytes_to_address( address );
 140:../../../mod/flash/flash.c **** 			flash_status = flash_read( pflash_handle, num_bytes );
 141:../../../mod/flash/flash.c **** 			
 142:../../../mod/flash/flash.c **** 			/* Check for flash error */
 143:../../../mod/flash/flash.c **** 			if ( flash_status != FLASH_OK )
 144:../../../mod/flash/flash.c **** 				{
 145:../../../mod/flash/flash.c **** 				/* Bytes not read */
ARM GAS  /tmp/cc2q6PEf.s 			page 4


 146:../../../mod/flash/flash.c **** 				return FLASH_FAIL;
 147:../../../mod/flash/flash.c **** 				}
 148:../../../mod/flash/flash.c **** 
 149:../../../mod/flash/flash.c **** 			/* Transmit bytes from pbuffer over USB */
 150:../../../mod/flash/flash.c **** 			usb_status = usb_transmit( pflash_handle -> pbuffer,
 151:../../../mod/flash/flash.c ****                                        num_bytes               ,
 152:../../../mod/flash/flash.c **** 									   HAL_FLASH_TIMEOUT );
 153:../../../mod/flash/flash.c **** 
 154:../../../mod/flash/flash.c **** 			if ( usb_status != USB_OK )
 155:../../../mod/flash/flash.c **** 				{
 156:../../../mod/flash/flash.c **** 				/* Bytes not transimitted */
 157:../../../mod/flash/flash.c **** 				return FLASH_USB_ERROR;
 158:../../../mod/flash/flash.c **** 				}
 159:../../../mod/flash/flash.c **** 
 160:../../../mod/flash/flash.c **** 			}
 161:../../../mod/flash/flash.c **** 
 162:../../../mod/flash/flash.c **** 		/* Bytes read and transimitted back sucessfully */
 163:../../../mod/flash/flash.c **** 		return FLASH_OK;
 164:../../../mod/flash/flash.c **** 
 165:../../../mod/flash/flash.c **** 		} /* FLASH_SUBCMD_READ */
 166:../../../mod/flash/flash.c **** 
 167:../../../mod/flash/flash.c ****     /*------------------------------ENABLE Subcommand-----------------------------*/
 168:../../../mod/flash/flash.c ****     case FLASH_SUBCMD_ENABLE:
 169:../../../mod/flash/flash.c ****         {
 170:../../../mod/flash/flash.c **** 		flash_write_enable();
 171:../../../mod/flash/flash.c **** 		return FLASH_OK;
 172:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_ENABLE */
 173:../../../mod/flash/flash.c **** 
 174:../../../mod/flash/flash.c ****     /*------------------------------DISABLE Subcommand----------------------------*/
 175:../../../mod/flash/flash.c ****     case FLASH_SUBCMD_DISABLE:
 176:../../../mod/flash/flash.c ****         {
 177:../../../mod/flash/flash.c **** 		flash_write_disable();
 178:../../../mod/flash/flash.c **** 		return FLASH_OK;
 179:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_DISABLE */
 180:../../../mod/flash/flash.c **** 
 181:../../../mod/flash/flash.c ****     /*------------------------------WRITE Subcommand------------------------------*/
 182:../../../mod/flash/flash.c ****     case FLASH_SUBCMD_WRITE:
 183:../../../mod/flash/flash.c ****         {
 184:../../../mod/flash/flash.c **** 		/* Get Address bits */
 185:../../../mod/flash/flash.c **** 		usb_status = usb_receive( &( address[0] )  ,
 186:../../../mod/flash/flash.c ****                                   sizeof( address ),
 187:../../../mod/flash/flash.c ****                                   HAL_DEFAULT_TIMEOUT );
 188:../../../mod/flash/flash.c **** 
 189:../../../mod/flash/flash.c **** 		if ( usb_status != USB_OK )	
 190:../../../mod/flash/flash.c **** 			{
 191:../../../mod/flash/flash.c **** 			/* Address not recieved */
 192:../../../mod/flash/flash.c **** 			return FLASH_USB_ERROR;
 193:../../../mod/flash/flash.c ****             }
 194:../../../mod/flash/flash.c **** 		else
 195:../../../mod/flash/flash.c **** 			{
 196:../../../mod/flash/flash.c **** 			/* Convert flash address to uint32_t */
 197:../../../mod/flash/flash.c **** 			pflash_handle -> address = bytes_to_address( address );
 198:../../../mod/flash/flash.c **** 
 199:../../../mod/flash/flash.c **** 			/* Get bytes to be written to flash */
 200:../../../mod/flash/flash.c **** 			for ( int i = 0; i < num_bytes; i++ )
 201:../../../mod/flash/flash.c **** 				{
 202:../../../mod/flash/flash.c **** 				pbuffer = ( pflash_handle -> pbuffer ) + i;
ARM GAS  /tmp/cc2q6PEf.s 			page 5


 203:../../../mod/flash/flash.c **** 				flash_status = usb_receive( pbuffer          , 
 204:../../../mod/flash/flash.c ****                                             sizeof( uint8_t ),
 205:../../../mod/flash/flash.c ****                                             HAL_DEFAULT_TIMEOUT );
 206:../../../mod/flash/flash.c **** 
 207:../../../mod/flash/flash.c **** 				/* Return if usb call failed */
 208:../../../mod/flash/flash.c **** 				if ( usb_status != USB_OK )
 209:../../../mod/flash/flash.c **** 					{
 210:../../../mod/flash/flash.c **** 					/* Bytes not received */
 211:../../../mod/flash/flash.c **** 				    return FLASH_USB_ERROR;	
 212:../../../mod/flash/flash.c ****                     }
 213:../../../mod/flash/flash.c **** 
 214:../../../mod/flash/flash.c **** 				}
 215:../../../mod/flash/flash.c ****             }
 216:../../../mod/flash/flash.c **** 
 217:../../../mod/flash/flash.c **** 		/* Call API function */
 218:../../../mod/flash/flash.c **** 		flash_status = flash_write( pflash_handle );
 219:../../../mod/flash/flash.c **** 
 220:../../../mod/flash/flash.c **** 	    return flash_status;	
 221:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_WRITE */
 222:../../../mod/flash/flash.c **** 
 223:../../../mod/flash/flash.c ****     /*------------------------------ERASE Subcommand------------------------------*/
 224:../../../mod/flash/flash.c ****     case FLASH_SUBCMD_ERASE:
 225:../../../mod/flash/flash.c ****         {
 226:../../../mod/flash/flash.c **** 		/* Call API Function*/
 227:../../../mod/flash/flash.c **** 		flash_status = flash_erase( pflash_handle );
 228:../../../mod/flash/flash.c **** 
 229:../../../mod/flash/flash.c **** 		return flash_status;
 230:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_ERASE */
 231:../../../mod/flash/flash.c **** 
 232:../../../mod/flash/flash.c ****     /*------------------------------STATUS Subcommand-----------------------------*/
 233:../../../mod/flash/flash.c ****     case FLASH_SUBCMD_STATUS:
 234:../../../mod/flash/flash.c ****         {
 235:../../../mod/flash/flash.c **** 		/* Call API function */
 236:../../../mod/flash/flash.c **** 		flash_status = flash_get_status( pflash_handle );
 237:../../../mod/flash/flash.c **** 
 238:../../../mod/flash/flash.c **** 		/* Send status register contents back to PC */
 239:../../../mod/flash/flash.c **** 		usb_status = usb_transmit( &( pflash_handle -> status_register ),
 240:../../../mod/flash/flash.c ****                                    sizeof( uint8_t )                    ,
 241:../../../mod/flash/flash.c ****                                    HAL_DEFAULT_TIMEOUT );
 242:../../../mod/flash/flash.c **** 
 243:../../../mod/flash/flash.c **** 		/* Return status code */
 244:../../../mod/flash/flash.c **** 		if      ( usb_status   != USB_OK   )
 245:../../../mod/flash/flash.c **** 			{
 246:../../../mod/flash/flash.c **** 			return FLASH_USB_ERROR;
 247:../../../mod/flash/flash.c **** 			}
 248:../../../mod/flash/flash.c **** 		else if ( flash_status != FLASH_OK )
 249:../../../mod/flash/flash.c **** 			{
 250:../../../mod/flash/flash.c **** 			return FLASH_SPI_ERROR;
 251:../../../mod/flash/flash.c **** 			}
 252:../../../mod/flash/flash.c **** 		else
 253:../../../mod/flash/flash.c **** 			{
 254:../../../mod/flash/flash.c **** 			return FLASH_OK;	
 255:../../../mod/flash/flash.c **** 			}
 256:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_STATUS */
 257:../../../mod/flash/flash.c **** 
 258:../../../mod/flash/flash.c ****     /*-----------------------------EXTRACT Subcommand-----------------------------*/
 259:../../../mod/flash/flash.c ****     case FLASH_SUBCMD_EXTRACT:
ARM GAS  /tmp/cc2q6PEf.s 			page 6


 260:../../../mod/flash/flash.c ****         {
 261:../../../mod/flash/flash.c **** 		/* Extracts the entire flash chip, flash chip address from 0 to 0x7FFFF */
 262:../../../mod/flash/flash.c **** 		pflash_handle->pbuffer = &buffer[0];
 263:../../../mod/flash/flash.c **** 		pflash_handle->address = 0;
 264:../../../mod/flash/flash.c **** 		while( pflash_handle->address <= FLASH_MAX_ADDR )
 265:../../../mod/flash/flash.c **** 			{
 266:../../../mod/flash/flash.c **** 			flash_status = flash_read( pflash_handle, sizeof( buffer ) );
 267:../../../mod/flash/flash.c **** 			if( flash_status == FLASH_OK )
 268:../../../mod/flash/flash.c **** 				{
 269:../../../mod/flash/flash.c **** 				usb_transmit( &buffer  ,
 270:../../../mod/flash/flash.c **** 						      sizeof( buffer ),
 271:../../../mod/flash/flash.c **** 						      HAL_FLASH_TIMEOUT );
 272:../../../mod/flash/flash.c **** 				}
 273:../../../mod/flash/flash.c **** 			else
 274:../../../mod/flash/flash.c **** 				{
 275:../../../mod/flash/flash.c **** 				/* Extract Failed */
 276:../../../mod/flash/flash.c **** 				Error_Handler();
 277:../../../mod/flash/flash.c **** 				}
 278:../../../mod/flash/flash.c **** 
 279:../../../mod/flash/flash.c **** 			/* Read from next address */
 280:../../../mod/flash/flash.c **** 			(pflash_handle->address) += sizeof( buffer ) ;
 281:../../../mod/flash/flash.c **** 			}
 282:../../../mod/flash/flash.c **** 
 283:../../../mod/flash/flash.c **** 		return FLASH_OK;
 284:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_EXTRACT */
 285:../../../mod/flash/flash.c **** 
 286:../../../mod/flash/flash.c ****     /*---------------------------Unrecognized Subcommand--------------------------*/
 287:../../../mod/flash/flash.c **** 	default:
 288:../../../mod/flash/flash.c ****         {
 289:../../../mod/flash/flash.c **** 	    return FLASH_UNRECOGNIZED_OP;	
 290:../../../mod/flash/flash.c ****         }
 291:../../../mod/flash/flash.c **** 
 292:../../../mod/flash/flash.c ****     }
 293:../../../mod/flash/flash.c **** } /* flash_cmd_execute */
 294:../../../mod/flash/flash.c **** 
 295:../../../mod/flash/flash.c **** 
 296:../../../mod/flash/flash.c **** /*******************************************************************************
 297:../../../mod/flash/flash.c **** *                                                                              *
 298:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   * 
 299:../../../mod/flash/flash.c **** * 		flash_init                                                             *
 300:../../../mod/flash/flash.c **** *                                                                              *
 301:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 * 
 302:../../../mod/flash/flash.c **** *       Initializes the flash chip                                             *
 303:../../../mod/flash/flash.c **** *                                                                              *
 304:../../../mod/flash/flash.c **** *******************************************************************************/
 305:../../../mod/flash/flash.c **** FLASH_STATUS flash_init 
 306:../../../mod/flash/flash.c **** 	(
 307:../../../mod/flash/flash.c **** 	HFLASH_BUFFER* pflash_handle  /* Flash handle */
 308:../../../mod/flash/flash.c **** 	)
 309:../../../mod/flash/flash.c **** {
 310:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 311:../../../mod/flash/flash.c ****  Local variables 
 312:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 313:../../../mod/flash/flash.c **** FLASH_STATUS flash_status;    /* Flash API function return codes        */
 314:../../../mod/flash/flash.c **** uint8_t      status_register; /* Desired status register contents       */
 315:../../../mod/flash/flash.c **** 
 316:../../../mod/flash/flash.c **** 
ARM GAS  /tmp/cc2q6PEf.s 			page 7


 317:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 318:../../../mod/flash/flash.c ****  Initializations 
 319:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 320:../../../mod/flash/flash.c **** flash_status    = FLASH_OK;
 321:../../../mod/flash/flash.c **** status_register = FLASH_REG_RESET_VAL;
 322:../../../mod/flash/flash.c **** 
 323:../../../mod/flash/flash.c **** 
 324:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 325:../../../mod/flash/flash.c ****  Pre-processing 
 326:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 327:../../../mod/flash/flash.c **** 
 328:../../../mod/flash/flash.c **** /* Check for invalid BPL setting */
 329:../../../mod/flash/flash.c **** if ( pflash_handle -> bpl_bits > FLASH_BPL_ALL )
 330:../../../mod/flash/flash.c **** 	{
 331:../../../mod/flash/flash.c **** 	return FLASH_INVALID_INPUT; 
 332:../../../mod/flash/flash.c **** 	}
 333:../../../mod/flash/flash.c **** 
 334:../../../mod/flash/flash.c **** /* Determine the desired status register contents */
 335:../../../mod/flash/flash.c **** status_register &= pflash_handle -> bpl_bits;
 336:../../../mod/flash/flash.c **** status_register |= pflash_handle -> bpl_write_protect;
 337:../../../mod/flash/flash.c **** 
 338:../../../mod/flash/flash.c **** 
 339:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 340:../../../mod/flash/flash.c ****  API Function Implementation 
 341:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 342:../../../mod/flash/flash.c **** 
 343:../../../mod/flash/flash.c **** /* Configure write protection */
 344:../../../mod/flash/flash.c **** if ( pflash_handle -> write_protected )
 345:../../../mod/flash/flash.c **** 	{
 346:../../../mod/flash/flash.c **** 	flash_write_disable();
 347:../../../mod/flash/flash.c **** 	return FLASH_OK;
 348:../../../mod/flash/flash.c **** 	}
 349:../../../mod/flash/flash.c **** else
 350:../../../mod/flash/flash.c **** 	{
 351:../../../mod/flash/flash.c **** 	flash_write_enable();
 352:../../../mod/flash/flash.c **** 	}
 353:../../../mod/flash/flash.c **** 
 354:../../../mod/flash/flash.c **** /* Check the flash chip status register to confirm chip can be reached */
 355:../../../mod/flash/flash.c **** flash_status = flash_get_status( pflash_handle );
 356:../../../mod/flash/flash.c **** if ( flash_status != FLASH_OK )
 357:../../../mod/flash/flash.c **** 	{
 358:../../../mod/flash/flash.c **** 	return flash_status;
 359:../../../mod/flash/flash.c **** 	}
 360:../../../mod/flash/flash.c **** else if ( pflash_handle -> status_register == 0xFF )
 361:../../../mod/flash/flash.c **** 	{
 362:../../../mod/flash/flash.c **** 	return FLASH_INIT_FAIL;
 363:../../../mod/flash/flash.c **** 	}
 364:../../../mod/flash/flash.c **** 
 365:../../../mod/flash/flash.c **** /* Disable writing to the chip in case of prior interrupted write operation */
 366:../../../mod/flash/flash.c **** if ( write_disable() != FLASH_OK )
 367:../../../mod/flash/flash.c **** 	{
 368:../../../mod/flash/flash.c **** 	return FLASH_CANNOT_WRITE_DISABLE;
 369:../../../mod/flash/flash.c **** 	}
 370:../../../mod/flash/flash.c **** 
 371:../../../mod/flash/flash.c **** /* Set the bpl bits in the flash chip */
 372:../../../mod/flash/flash.c **** flash_status = flash_set_status( status_register );
 373:../../../mod/flash/flash.c **** 
ARM GAS  /tmp/cc2q6PEf.s 			page 8


 374:../../../mod/flash/flash.c **** /* Confirm Status register contents */
 375:../../../mod/flash/flash.c **** while( flash_is_flash_busy() == FLASH_BUSY ){}
 376:../../../mod/flash/flash.c **** flash_status = flash_get_status( pflash_handle );
 377:../../../mod/flash/flash.c **** if ( pflash_handle -> status_register != status_register )
 378:../../../mod/flash/flash.c **** 	{
 379:../../../mod/flash/flash.c **** 	return FLASH_INIT_FAIL;
 380:../../../mod/flash/flash.c **** 	}
 381:../../../mod/flash/flash.c **** else
 382:../../../mod/flash/flash.c **** 	{
 383:../../../mod/flash/flash.c **** 	return flash_status;
 384:../../../mod/flash/flash.c **** 	}
 385:../../../mod/flash/flash.c **** 
 386:../../../mod/flash/flash.c **** } /* flash_init */
 387:../../../mod/flash/flash.c **** 
 388:../../../mod/flash/flash.c **** 
 389:../../../mod/flash/flash.c **** /*******************************************************************************
 390:../../../mod/flash/flash.c **** *                                                                              *
 391:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   * 
 392:../../../mod/flash/flash.c **** * 		flash_get_status                                                       *
 393:../../../mod/flash/flash.c **** *                                                                              *
 394:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 * 
 395:../../../mod/flash/flash.c **** *       Read the status register of the flash chip                             *
 396:../../../mod/flash/flash.c **** *                                                                              *
 397:../../../mod/flash/flash.c **** *******************************************************************************/
 398:../../../mod/flash/flash.c **** FLASH_STATUS flash_get_status
 399:../../../mod/flash/flash.c **** 	(
 400:../../../mod/flash/flash.c **** 	HFLASH_BUFFER* pflash_handle
 401:../../../mod/flash/flash.c ****     )
 402:../../../mod/flash/flash.c **** {
 403:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 404:../../../mod/flash/flash.c ****  Local variables 
 405:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 406:../../../mod/flash/flash.c **** HAL_StatusTypeDef hal_status[2];  /* Status codes returned by SPI HAL         */
 407:../../../mod/flash/flash.c **** uint8_t           flash_opcode;   /* Data to be transmitted over SPI          */
 408:../../../mod/flash/flash.c **** 
 409:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 410:../../../mod/flash/flash.c ****  Initialiazations 
 411:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 412:../../../mod/flash/flash.c **** flash_opcode = FLASH_OP_HW_RDSR;
 413:../../../mod/flash/flash.c **** 
 414:../../../mod/flash/flash.c **** 
 415:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 416:../../../mod/flash/flash.c ****  API function implementation 
 417:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 418:../../../mod/flash/flash.c **** 
 419:../../../mod/flash/flash.c **** /* Drive slave select line low */
 420:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT,
 421:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 422:../../../mod/flash/flash.c ****                    GPIO_PIN_RESET );
 423:../../../mod/flash/flash.c **** 
 424:../../../mod/flash/flash.c **** /* Send RDSR code to flash chip */
 425:../../../mod/flash/flash.c **** hal_status[0] = HAL_SPI_Transmit( &( FLASH_SPI )        ,
 426:../../../mod/flash/flash.c ****                                   &flash_opcode         ,
 427:../../../mod/flash/flash.c ****                                   sizeof( flash_opcode ),
 428:../../../mod/flash/flash.c ****                                   HAL_DEFAULT_TIMEOUT );
 429:../../../mod/flash/flash.c **** 
 430:../../../mod/flash/flash.c **** /* Recieve status code */
ARM GAS  /tmp/cc2q6PEf.s 			page 9


 431:../../../mod/flash/flash.c **** hal_status[1] = HAL_SPI_Receive( &( FLASH_SPI ),
 432:../../../mod/flash/flash.c ****                                  &( pflash_handle      -> status_register ),
 433:../../../mod/flash/flash.c ****                                  sizeof( pflash_handle -> status_register ),
 434:../../../mod/flash/flash.c **** 							     HAL_DEFAULT_TIMEOUT );
 435:../../../mod/flash/flash.c **** 
 436:../../../mod/flash/flash.c **** /* Drive slave select line high */
 437:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT,
 438:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 439:../../../mod/flash/flash.c ****                    GPIO_PIN_SET );
 440:../../../mod/flash/flash.c **** 
 441:../../../mod/flash/flash.c **** /* Return flash status code */
 442:../../../mod/flash/flash.c **** if ( hal_status[0] != HAL_OK || hal_status[1] != HAL_OK )
 443:../../../mod/flash/flash.c **** 	{
 444:../../../mod/flash/flash.c **** 	return FLASH_SPI_ERROR;
 445:../../../mod/flash/flash.c **** 	}
 446:../../../mod/flash/flash.c **** else
 447:../../../mod/flash/flash.c **** 	{
 448:../../../mod/flash/flash.c **** 	return FLASH_OK;
 449:../../../mod/flash/flash.c **** 	}
 450:../../../mod/flash/flash.c **** 
 451:../../../mod/flash/flash.c **** } /* flash_get_status */
 452:../../../mod/flash/flash.c **** 
 453:../../../mod/flash/flash.c **** 
 454:../../../mod/flash/flash.c **** /*******************************************************************************
 455:../../../mod/flash/flash.c **** *                                                                              *
 456:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   * 
 457:../../../mod/flash/flash.c **** * 		flash_set_status                                                       *
 458:../../../mod/flash/flash.c **** *                                                                              *
 459:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 * 
 460:../../../mod/flash/flash.c **** *       Writes to the status register                                          *
 461:../../../mod/flash/flash.c **** *                                                                              *
 462:../../../mod/flash/flash.c **** *******************************************************************************/
 463:../../../mod/flash/flash.c **** FLASH_STATUS flash_set_status
 464:../../../mod/flash/flash.c **** 	(
 465:../../../mod/flash/flash.c **** 	uint8_t        flash_status	
 466:../../../mod/flash/flash.c ****     )
 467:../../../mod/flash/flash.c **** {
 468:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 469:../../../mod/flash/flash.c ****  Local variables 
 470:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 471:../../../mod/flash/flash.c **** uint8_t hal_status   [3];   /* Status code returned by hal spi functions      */
 472:../../../mod/flash/flash.c **** uint8_t flash_opcodes[2];   /* Flash instruction cycle bytes                  */
 473:../../../mod/flash/flash.c **** 
 474:../../../mod/flash/flash.c **** 
 475:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 476:../../../mod/flash/flash.c ****  Initializations 
 477:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 478:../../../mod/flash/flash.c **** flash_opcodes[0] = FLASH_OP_HW_EWSR;
 479:../../../mod/flash/flash.c **** flash_opcodes[1] = FLASH_OP_HW_WRSR;
 480:../../../mod/flash/flash.c **** 
 481:../../../mod/flash/flash.c **** 
 482:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 483:../../../mod/flash/flash.c ****  Pre-processing 
 484:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 485:../../../mod/flash/flash.c **** if ( !( write_enabled ) )
 486:../../../mod/flash/flash.c **** 	{
 487:../../../mod/flash/flash.c **** 	return FLASH_WRITE_PROTECTED;
ARM GAS  /tmp/cc2q6PEf.s 			page 10


 488:../../../mod/flash/flash.c **** 	}
 489:../../../mod/flash/flash.c **** 
 490:../../../mod/flash/flash.c **** 
 491:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 492:../../../mod/flash/flash.c ****  API function implementation 
 493:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 494:../../../mod/flash/flash.c **** 
 495:../../../mod/flash/flash.c **** /* Enable write to status register */
 496:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT,
 497:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 498:../../../mod/flash/flash.c ****                    GPIO_PIN_RESET );
 499:../../../mod/flash/flash.c **** hal_status[0] = HAL_SPI_Transmit( &( FLASH_SPI )   ,
 500:../../../mod/flash/flash.c ****                                   &flash_opcodes[0],
 501:../../../mod/flash/flash.c ****                                   sizeof( uint8_t ),
 502:../../../mod/flash/flash.c ****                                   HAL_DEFAULT_TIMEOUT );
 503:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT,
 504:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 505:../../../mod/flash/flash.c ****                    GPIO_PIN_SET );
 506:../../../mod/flash/flash.c **** 
 507:../../../mod/flash/flash.c **** /* Write the Data to the status register */
 508:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT,
 509:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 510:../../../mod/flash/flash.c ****                    GPIO_PIN_RESET );
 511:../../../mod/flash/flash.c **** hal_status[1] = HAL_SPI_Transmit( &( FLASH_SPI )   ,
 512:../../../mod/flash/flash.c ****                                   &flash_opcodes[1],
 513:../../../mod/flash/flash.c ****                                   sizeof( uint8_t ),
 514:../../../mod/flash/flash.c **** 							      HAL_DEFAULT_TIMEOUT );
 515:../../../mod/flash/flash.c **** hal_status[2] = HAL_SPI_Transmit( &( FLASH_SPI )        ,
 516:../../../mod/flash/flash.c ****                                   &flash_status         ,
 517:../../../mod/flash/flash.c ****                                   sizeof( flash_status ),
 518:../../../mod/flash/flash.c **** 							      HAL_DEFAULT_TIMEOUT );
 519:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT,
 520:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 521:../../../mod/flash/flash.c ****                    GPIO_PIN_SET );
 522:../../../mod/flash/flash.c **** 
 523:../../../mod/flash/flash.c **** /* Return flash status */
 524:../../../mod/flash/flash.c **** if ( hal_status[0] != HAL_OK ||
 525:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK ||
 526:../../../mod/flash/flash.c **** 	 hal_status[2] != HAL_OK )
 527:../../../mod/flash/flash.c **** 	{
 528:../../../mod/flash/flash.c **** 	return FLASH_SPI_ERROR;
 529:../../../mod/flash/flash.c **** 	}
 530:../../../mod/flash/flash.c **** else
 531:../../../mod/flash/flash.c **** 	{
 532:../../../mod/flash/flash.c **** 	return FLASH_OK;
 533:../../../mod/flash/flash.c **** 	}
 534:../../../mod/flash/flash.c **** 
 535:../../../mod/flash/flash.c **** } /* flash_set_status */
 536:../../../mod/flash/flash.c **** 
 537:../../../mod/flash/flash.c **** 
 538:../../../mod/flash/flash.c **** /*******************************************************************************
 539:../../../mod/flash/flash.c **** *                                                                              *
 540:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   *
 541:../../../mod/flash/flash.c **** * 		flash_is_flash_busy                                                    *
 542:../../../mod/flash/flash.c **** *                                                                              *
 543:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 *
 544:../../../mod/flash/flash.c **** *       Polls the flash status register to see if the chip is busy. False      *
ARM GAS  /tmp/cc2q6PEf.s 			page 11


 545:../../../mod/flash/flash.c **** *       boolean return value indicates the chip is ready for write operations  *
 546:../../../mod/flash/flash.c **** *                                                                              *
 547:../../../mod/flash/flash.c **** *******************************************************************************/
 548:../../../mod/flash/flash.c **** bool flash_is_flash_busy
 549:../../../mod/flash/flash.c **** 	(
 550:../../../mod/flash/flash.c **** 	void
 551:../../../mod/flash/flash.c **** 	)
 552:../../../mod/flash/flash.c **** {
 553:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 554:../../../mod/flash/flash.c ****  Local variables  
 555:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 556:../../../mod/flash/flash.c **** HFLASH_BUFFER flash_handle; /* Flash handle to store status reg contents      */
 557:../../../mod/flash/flash.c **** FLASH_STATUS  flash_status; /* Flash API return codes                         */
 558:../../../mod/flash/flash.c **** 
 559:../../../mod/flash/flash.c **** 
 560:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 561:../../../mod/flash/flash.c ****  Initializations 
 562:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 563:../../../mod/flash/flash.c **** flash_status                 = FLASH_OK;
 564:../../../mod/flash/flash.c **** flash_handle.status_register = 0xFF;
 565:../../../mod/flash/flash.c **** 
 566:../../../mod/flash/flash.c **** 
 567:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 568:../../../mod/flash/flash.c ****  Implementation 
 569:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 570:../../../mod/flash/flash.c **** 
 571:../../../mod/flash/flash.c **** /* Read status register */
 572:../../../mod/flash/flash.c **** flash_status = flash_get_status( &flash_handle );
 573:../../../mod/flash/flash.c **** if      ( flash_status != FLASH_OK                          )
 574:../../../mod/flash/flash.c **** 	{
 575:../../../mod/flash/flash.c **** 	return FLASH_BUSY;
 576:../../../mod/flash/flash.c **** 	}
 577:../../../mod/flash/flash.c **** else if ( flash_handle.status_register & FLASH_BUSY_BITMASK )
 578:../../../mod/flash/flash.c **** 	{
 579:../../../mod/flash/flash.c **** 	return FLASH_BUSY;
 580:../../../mod/flash/flash.c **** 	}
 581:../../../mod/flash/flash.c **** else
 582:../../../mod/flash/flash.c **** 	{
 583:../../../mod/flash/flash.c **** 	return FLASH_READY;
 584:../../../mod/flash/flash.c **** 	}
 585:../../../mod/flash/flash.c **** 
 586:../../../mod/flash/flash.c **** } /* flash_is_flash_busy */
 587:../../../mod/flash/flash.c **** 
 588:../../../mod/flash/flash.c **** 
 589:../../../mod/flash/flash.c **** /*******************************************************************************
 590:../../../mod/flash/flash.c **** *                                                                              *
 591:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   * 
 592:../../../mod/flash/flash.c **** * 		flash_write_enable                                                     *
 593:../../../mod/flash/flash.c **** *                                                                              *
 594:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 * 
 595:../../../mod/flash/flash.c **** *       Enable writing to the external flash chip by configuring the global    *
 596:../../../mod/flash/flash.c **** *       write protection variable                                              *
 597:../../../mod/flash/flash.c **** *                                                                              *
 598:../../../mod/flash/flash.c **** *******************************************************************************/
 599:../../../mod/flash/flash.c **** void flash_write_enable
 600:../../../mod/flash/flash.c **** 	(
 601:../../../mod/flash/flash.c **** 	void
ARM GAS  /tmp/cc2q6PEf.s 			page 12


 602:../../../mod/flash/flash.c **** 	)
 603:../../../mod/flash/flash.c **** {
 604:../../../mod/flash/flash.c **** write_enabled = true;
 605:../../../mod/flash/flash.c **** } /* flash_write_enable */
 606:../../../mod/flash/flash.c **** 
 607:../../../mod/flash/flash.c **** 
 608:../../../mod/flash/flash.c **** /*******************************************************************************
 609:../../../mod/flash/flash.c **** *                                                                              *
 610:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   * 
 611:../../../mod/flash/flash.c **** * 		flash_write_disable                                                    *
 612:../../../mod/flash/flash.c **** *                                                                              *
 613:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 * 
 614:../../../mod/flash/flash.c **** *       Disable writing to the external flash chip                             *
 615:../../../mod/flash/flash.c **** *                                                                              *
 616:../../../mod/flash/flash.c **** *******************************************************************************/
 617:../../../mod/flash/flash.c **** void flash_write_disable
 618:../../../mod/flash/flash.c ****     (
 619:../../../mod/flash/flash.c ****     void 
 620:../../../mod/flash/flash.c ****     )
 621:../../../mod/flash/flash.c **** {
 622:../../../mod/flash/flash.c **** write_enabled = false;
 623:../../../mod/flash/flash.c **** } /* flash_write_disable */
 624:../../../mod/flash/flash.c **** 
 625:../../../mod/flash/flash.c **** 
 626:../../../mod/flash/flash.c **** /*******************************************************************************
 627:../../../mod/flash/flash.c **** *                                                                              *
 628:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   * 
 629:../../../mod/flash/flash.c **** * 		flash_write_byte                                                       *
 630:../../../mod/flash/flash.c **** *                                                                              *
 631:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 * 
 632:../../../mod/flash/flash.c **** *       writes a byte to the external flash                                    *
 633:../../../mod/flash/flash.c **** *                                                                              *
 634:../../../mod/flash/flash.c **** *******************************************************************************/
 635:../../../mod/flash/flash.c **** FLASH_STATUS flash_write_byte 
 636:../../../mod/flash/flash.c ****     (
 637:../../../mod/flash/flash.c **** 	HFLASH_BUFFER* pflash_handle,
 638:../../../mod/flash/flash.c **** 	uint8_t        byte
 639:../../../mod/flash/flash.c ****     )
 640:../../../mod/flash/flash.c **** {
 641:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 642:../../../mod/flash/flash.c ****  Local variables 
 643:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 644:../../../mod/flash/flash.c **** HAL_StatusTypeDef hal_status[3];    /* Status code return by hal functions    */
 645:../../../mod/flash/flash.c **** FLASH_STATUS      flash_status;     /* Status code returned by flash API      */
 646:../../../mod/flash/flash.c **** uint8_t           flash_opcode;     /* Data to be transmitted over SPI        */
 647:../../../mod/flash/flash.c **** uint8_t           address[3];       /* Flash memory address in byte form      */
 648:../../../mod/flash/flash.c **** 
 649:../../../mod/flash/flash.c **** 
 650:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 651:../../../mod/flash/flash.c ****  Initializations 
 652:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 653:../../../mod/flash/flash.c **** flash_status  = FLASH_OK;
 654:../../../mod/flash/flash.c **** flash_opcode  = FLASH_OP_HW_BYTE_PROGRAM;
 655:../../../mod/flash/flash.c **** address_to_bytes( pflash_handle -> address, &address[0] );
 656:../../../mod/flash/flash.c **** 
 657:../../../mod/flash/flash.c **** 
 658:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
ARM GAS  /tmp/cc2q6PEf.s 			page 13


 659:../../../mod/flash/flash.c ****  Pre-processing 
 660:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 661:../../../mod/flash/flash.c **** 
 662:../../../mod/flash/flash.c **** /* Check if write_enabled */
 663:../../../mod/flash/flash.c **** if( !( write_enabled ) )
 664:../../../mod/flash/flash.c **** 	{
 665:../../../mod/flash/flash.c **** 	return FLASH_WRITE_PROTECTED;
 666:../../../mod/flash/flash.c **** 	}
 667:../../../mod/flash/flash.c **** 
 668:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 669:../../../mod/flash/flash.c ****  API function implementation
 670:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 671:../../../mod/flash/flash.c **** 
 672:../../../mod/flash/flash.c **** /* Enable the chip for writing */
 673:../../../mod/flash/flash.c **** flash_status = write_enable();
 674:../../../mod/flash/flash.c **** if ( flash_status != FLASH_OK )
 675:../../../mod/flash/flash.c **** 	{
 676:../../../mod/flash/flash.c **** 	return FLASH_CANNOT_WRITE_ENABLE;
 677:../../../mod/flash/flash.c **** 	}
 678:../../../mod/flash/flash.c **** 
 679:../../../mod/flash/flash.c **** /* Send the byte program command to the flash over SPI */
 680:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT, FLASH_SS_PIN, GPIO_PIN_RESET );
 681:../../../mod/flash/flash.c **** hal_status[0] = HAL_SPI_Transmit( &( FLASH_SPI )       ,
 682:../../../mod/flash/flash.c **** 							      &flash_opcode        ,
 683:../../../mod/flash/flash.c **** 							      sizeof( flash_opcode ),
 684:../../../mod/flash/flash.c **** 							      HAL_DEFAULT_TIMEOUT );
 685:../../../mod/flash/flash.c **** 
 686:../../../mod/flash/flash.c **** /* Send address bytes */
 687:../../../mod/flash/flash.c **** hal_status[1] = HAL_SPI_Transmit( &( FLASH_SPI )   ,
 688:../../../mod/flash/flash.c **** 							      &address[0]      ,
 689:../../../mod/flash/flash.c **** 							      sizeof( address ),
 690:../../../mod/flash/flash.c **** 							      HAL_DEFAULT_TIMEOUT );
 691:../../../mod/flash/flash.c **** 
 692:../../../mod/flash/flash.c **** /* Write bytes */
 693:../../../mod/flash/flash.c **** hal_status[2] = HAL_SPI_Transmit( &( FLASH_SPI ),
 694:../../../mod/flash/flash.c **** 							     &byte          ,
 695:../../../mod/flash/flash.c **** 							     sizeof( byte ) ,
 696:../../../mod/flash/flash.c **** 							     HAL_FLASH_TIMEOUT );
 697:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT, FLASH_SS_PIN, GPIO_PIN_SET );
 698:../../../mod/flash/flash.c **** 
 699:../../../mod/flash/flash.c **** /* Return flash status */
 700:../../../mod/flash/flash.c **** if ( hal_status[0] != HAL_OK ||
 701:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK ||
 702:../../../mod/flash/flash.c **** 	 hal_status[2] != HAL_OK )
 703:../../../mod/flash/flash.c **** 	{
 704:../../../mod/flash/flash.c **** 	return FLASH_SPI_ERROR;
 705:../../../mod/flash/flash.c **** 	}
 706:../../../mod/flash/flash.c **** else
 707:../../../mod/flash/flash.c **** 	{
 708:../../../mod/flash/flash.c **** 	return FLASH_OK;
 709:../../../mod/flash/flash.c **** 	}
 710:../../../mod/flash/flash.c **** 
 711:../../../mod/flash/flash.c **** } /* flash_write_byte */
 712:../../../mod/flash/flash.c **** 
 713:../../../mod/flash/flash.c **** 
 714:../../../mod/flash/flash.c **** /*******************************************************************************
 715:../../../mod/flash/flash.c **** *                                                                              *
ARM GAS  /tmp/cc2q6PEf.s 			page 14


 716:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   * 
 717:../../../mod/flash/flash.c **** * 		flash_write                                                            *
 718:../../../mod/flash/flash.c **** *                                                                              *
 719:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 * 
 720:../../../mod/flash/flash.c **** *       writes bytes from a flash buffer to the external flash                 *
 721:../../../mod/flash/flash.c **** *                                                                              *
 722:../../../mod/flash/flash.c **** *******************************************************************************/
 723:../../../mod/flash/flash.c **** FLASH_STATUS flash_write 
 724:../../../mod/flash/flash.c ****     (
 725:../../../mod/flash/flash.c **** 	HFLASH_BUFFER* pflash_handle
 726:../../../mod/flash/flash.c ****     )
 727:../../../mod/flash/flash.c **** {
 728:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 729:../../../mod/flash/flash.c ****  Local variables 
 730:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 731:../../../mod/flash/flash.c **** HAL_StatusTypeDef hal_status[3];    /* Status codes returned by HAL           */
 732:../../../mod/flash/flash.c **** FLASH_STATUS      flash_status;     /* Status codes returned by flash API     */
 733:../../../mod/flash/flash.c **** uint8_t           flash_opcode;     /* Opcode for flash instructions          */
 734:../../../mod/flash/flash.c **** uint32_t          timeout;          /* Timeout for flash write calls          */
 735:../../../mod/flash/flash.c **** uint32_t          timeout_ctr;      /* Counter to trigger timeout             */
 736:../../../mod/flash/flash.c **** uint8_t*          pbuffer;          /* Pointer to data in flash buffer        */
 737:../../../mod/flash/flash.c **** uint8_t           address_bytes[3]; /* Flash memory address in byte form      */
 738:../../../mod/flash/flash.c **** 
 739:../../../mod/flash/flash.c **** 
 740:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 741:../../../mod/flash/flash.c ****  Initializations 
 742:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 743:../../../mod/flash/flash.c **** flash_opcode  = FLASH_OP_HW_AAI_PROGRAM; 
 744:../../../mod/flash/flash.c **** flash_status  = FLASH_OK;
 745:../../../mod/flash/flash.c **** timeout       = 100;
 746:../../../mod/flash/flash.c **** timeout_ctr   = 0;
 747:../../../mod/flash/flash.c **** pbuffer       = pflash_handle -> pbuffer;
 748:../../../mod/flash/flash.c **** address_to_bytes( pflash_handle -> address, &address_bytes[0] );
 749:../../../mod/flash/flash.c **** 
 750:../../../mod/flash/flash.c **** 
 751:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 752:../../../mod/flash/flash.c ****  Pre-processing 
 753:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 754:../../../mod/flash/flash.c **** 
 755:../../../mod/flash/flash.c **** /* Check if write_enabled */
 756:../../../mod/flash/flash.c **** if( !( write_enabled ) )
 757:../../../mod/flash/flash.c **** 	{
 758:../../../mod/flash/flash.c **** 	return FLASH_WRITE_PROTECTED;
 759:../../../mod/flash/flash.c **** 	}
 760:../../../mod/flash/flash.c **** 
 761:../../../mod/flash/flash.c **** /* Check for 1/0 byte edge case */
 762:../../../mod/flash/flash.c **** if      ( pflash_handle -> num_bytes == 1 )
 763:../../../mod/flash/flash.c **** 	{
 764:../../../mod/flash/flash.c **** 	return flash_write_byte( pflash_handle, *( pflash_handle -> pbuffer ) );
 765:../../../mod/flash/flash.c **** 	}
 766:../../../mod/flash/flash.c **** else if ( pflash_handle -> num_bytes == 0 )
 767:../../../mod/flash/flash.c **** 	{
 768:../../../mod/flash/flash.c **** 	return FLASH_ERROR_MISSING_DATA;
 769:../../../mod/flash/flash.c **** 	}
 770:../../../mod/flash/flash.c **** 
 771:../../../mod/flash/flash.c **** 
 772:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
ARM GAS  /tmp/cc2q6PEf.s 			page 15


 773:../../../mod/flash/flash.c ****  API function implementation
 774:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 775:../../../mod/flash/flash.c **** 
 776:../../../mod/flash/flash.c **** /* Enable the chip for writing */
 777:../../../mod/flash/flash.c **** flash_status = write_enable();
 778:../../../mod/flash/flash.c **** if ( flash_status != FLASH_OK )
 779:../../../mod/flash/flash.c **** 	{
 780:../../../mod/flash/flash.c **** 	return FLASH_CANNOT_WRITE_ENABLE;
 781:../../../mod/flash/flash.c **** 	}
 782:../../../mod/flash/flash.c **** 
 783:../../../mod/flash/flash.c **** /* Initial SPI transmission */
 784:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT, FLASH_SS_PIN, GPIO_PIN_RESET );
 785:../../../mod/flash/flash.c **** hal_status[0] = HAL_SPI_Transmit( &( FLASH_SPI )        ,
 786:../../../mod/flash/flash.c **** 							      &flash_opcode         ,
 787:../../../mod/flash/flash.c **** 							      sizeof( flash_opcode ),
 788:../../../mod/flash/flash.c **** 							      HAL_DEFAULT_TIMEOUT );
 789:../../../mod/flash/flash.c **** hal_status[1] = HAL_SPI_Transmit( &( FLASH_SPI )         ,
 790:../../../mod/flash/flash.c **** 							      &address_bytes[0]      ,
 791:../../../mod/flash/flash.c **** 							      sizeof( address_bytes ),
 792:../../../mod/flash/flash.c **** 							      HAL_DEFAULT_TIMEOUT );
 793:../../../mod/flash/flash.c **** hal_status[2] = HAL_SPI_Transmit( &( FLASH_SPI ), 
 794:../../../mod/flash/flash.c ****                                   pbuffer       ,
 795:../../../mod/flash/flash.c **** 								  2             , 
 796:../../../mod/flash/flash.c **** 								  HAL_DEFAULT_TIMEOUT );						
 797:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT, FLASH_SS_PIN, GPIO_PIN_SET );
 798:../../../mod/flash/flash.c **** 
 799:../../../mod/flash/flash.c **** /* Check for SPI errors */
 800:../../../mod/flash/flash.c **** if ( hal_status[0] != HAL_OK ||
 801:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK ||
 802:../../../mod/flash/flash.c **** 	 hal_status[2] != HAL_OK )
 803:../../../mod/flash/flash.c **** 	{
 804:../../../mod/flash/flash.c **** 	return FLASH_SPI_ERROR;
 805:../../../mod/flash/flash.c **** 	}
 806:../../../mod/flash/flash.c **** 
 807:../../../mod/flash/flash.c **** /* Transmit remaining data */
 808:../../../mod/flash/flash.c **** for ( int i = 2; i < pflash_handle -> num_bytes; i += 2 )
 809:../../../mod/flash/flash.c **** 	{
 810:../../../mod/flash/flash.c **** 	/* Setup buffer pointer  */
 811:../../../mod/flash/flash.c **** 	pbuffer += 2;
 812:../../../mod/flash/flash.c **** 
 813:../../../mod/flash/flash.c **** 	/* Wait for flash to be ready */
 814:../../../mod/flash/flash.c **** 	while( flash_is_flash_busy() == FLASH_BUSY )
 815:../../../mod/flash/flash.c **** 		{
 816:../../../mod/flash/flash.c **** 		if ( timeout_ctr >= timeout )
 817:../../../mod/flash/flash.c **** 			{
 818:../../../mod/flash/flash.c **** 			return FLASH_TIMEOUT;
 819:../../../mod/flash/flash.c **** 			}
 820:../../../mod/flash/flash.c **** 		else
 821:../../../mod/flash/flash.c **** 			{
 822:../../../mod/flash/flash.c **** 			timeout_ctr++;
 823:../../../mod/flash/flash.c **** 			HAL_Delay( 1 );
 824:../../../mod/flash/flash.c **** 			}
 825:../../../mod/flash/flash.c **** 		}
 826:../../../mod/flash/flash.c **** 
 827:../../../mod/flash/flash.c **** 	/* SPI Transmission */	
 828:../../../mod/flash/flash.c **** 	HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT, FLASH_SS_PIN, GPIO_PIN_RESET );
 829:../../../mod/flash/flash.c **** 	hal_status[0] = HAL_SPI_Transmit( &( FLASH_SPI )        ,
ARM GAS  /tmp/cc2q6PEf.s 			page 16


 830:../../../mod/flash/flash.c **** 									&flash_opcode         ,
 831:../../../mod/flash/flash.c **** 									sizeof( flash_opcode ),
 832:../../../mod/flash/flash.c **** 									HAL_DEFAULT_TIMEOUT );
 833:../../../mod/flash/flash.c **** 	hal_status[1] = HAL_SPI_Transmit( &( FLASH_SPI ), 
 834:../../../mod/flash/flash.c **** 									pbuffer       ,
 835:../../../mod/flash/flash.c **** 									2             , 
 836:../../../mod/flash/flash.c **** 									HAL_DEFAULT_TIMEOUT );						
 837:../../../mod/flash/flash.c **** 	HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT, FLASH_SS_PIN, GPIO_PIN_SET );
 838:../../../mod/flash/flash.c **** 
 839:../../../mod/flash/flash.c **** 	/* Check for errors */
 840:../../../mod/flash/flash.c **** 	if ( hal_status[0] != HAL_OK || hal_status[1] != HAL_OK )
 841:../../../mod/flash/flash.c **** 		{
 842:../../../mod/flash/flash.c **** 		return FLASH_WRITE_ERROR;
 843:../../../mod/flash/flash.c **** 		}
 844:../../../mod/flash/flash.c **** 	} /* for ( i < pflash_handle -> num_bytes )*/
 845:../../../mod/flash/flash.c **** 
 846:../../../mod/flash/flash.c **** /* Wait for AAI to complete */
 847:../../../mod/flash/flash.c **** while ( flash_is_flash_busy() == FLASH_BUSY ){}
 848:../../../mod/flash/flash.c **** 
 849:../../../mod/flash/flash.c **** /* Terminate AAI Programming */
 850:../../../mod/flash/flash.c **** flash_status = write_disable();
 851:../../../mod/flash/flash.c **** if ( flash_status != FLASH_OK )
 852:../../../mod/flash/flash.c **** 	{
 853:../../../mod/flash/flash.c **** 	return FLASH_CANNOT_EXIT_AAI;
 854:../../../mod/flash/flash.c **** 	}
 855:../../../mod/flash/flash.c **** 
 856:../../../mod/flash/flash.c **** /* Wait for WRDI to complete */
 857:../../../mod/flash/flash.c **** while ( flash_is_flash_busy() == FLASH_BUSY ){}
 858:../../../mod/flash/flash.c **** 
 859:../../../mod/flash/flash.c **** /* Transmit final byte if num_bytes is odd */
 860:../../../mod/flash/flash.c **** if ( ( pflash_handle -> num_bytes ) %2 == 1 )
 861:../../../mod/flash/flash.c **** 	{
 862:../../../mod/flash/flash.c **** 	pbuffer += 1;
 863:../../../mod/flash/flash.c **** 	return flash_write_byte( pflash_handle, *pbuffer );
 864:../../../mod/flash/flash.c **** 	}
 865:../../../mod/flash/flash.c **** else
 866:../../../mod/flash/flash.c **** 	{
 867:../../../mod/flash/flash.c **** 	/* Flash write successful */
 868:../../../mod/flash/flash.c **** 	return FLASH_OK;
 869:../../../mod/flash/flash.c **** 	}
 870:../../../mod/flash/flash.c **** 
 871:../../../mod/flash/flash.c **** } /* flash_write */
 872:../../../mod/flash/flash.c **** 
 873:../../../mod/flash/flash.c **** 
 874:../../../mod/flash/flash.c **** /*******************************************************************************
 875:../../../mod/flash/flash.c **** *                                                                              *
 876:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   * 
 877:../../../mod/flash/flash.c **** * 		flash_read                                                             *
 878:../../../mod/flash/flash.c **** *                                                                              *
 879:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 * 
 880:../../../mod/flash/flash.c **** *       reads a specified number of bytes using a flash buffer                 *
 881:../../../mod/flash/flash.c **** *                                                                              *
 882:../../../mod/flash/flash.c **** *******************************************************************************/
 883:../../../mod/flash/flash.c **** FLASH_STATUS flash_read
 884:../../../mod/flash/flash.c ****     (
 885:../../../mod/flash/flash.c **** 	HFLASH_BUFFER* pflash_handle,
 886:../../../mod/flash/flash.c ****     uint32_t       num_bytes
ARM GAS  /tmp/cc2q6PEf.s 			page 17


 887:../../../mod/flash/flash.c ****     )
 888:../../../mod/flash/flash.c **** {
 889:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 890:../../../mod/flash/flash.c ****  Local variables 
 891:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 892:../../../mod/flash/flash.c **** HAL_StatusTypeDef hal_status[4]; /* Status code return by hal spi functions   */
 893:../../../mod/flash/flash.c **** uint8_t           flash_opcode;  /* Data to be transmitted over SPI           */
 894:../../../mod/flash/flash.c **** uint8_t           address[3];    /* Flash address in byte format              */
 895:../../../mod/flash/flash.c **** uint8_t*          pbuffer;       /* Pointer to position in output buffer      */
 896:../../../mod/flash/flash.c **** uint8_t           dummy_byte;    /* Dummy byte needed for high speed read     */
 897:../../../mod/flash/flash.c **** 
 898:../../../mod/flash/flash.c **** 
 899:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 900:../../../mod/flash/flash.c ****  Initializations 
 901:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 902:../../../mod/flash/flash.c **** flash_opcode = FLASH_OP_HW_READ_HS;
 903:../../../mod/flash/flash.c **** dummy_byte   = 0;
 904:../../../mod/flash/flash.c **** address_to_bytes( pflash_handle -> address, &address[0] );
 905:../../../mod/flash/flash.c **** 
 906:../../../mod/flash/flash.c **** 
 907:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 908:../../../mod/flash/flash.c ****  API function implementation
 909:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 910:../../../mod/flash/flash.c **** 
 911:../../../mod/flash/flash.c **** /* Initiate SPI transmission */
 912:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT, FLASH_SS_PIN, GPIO_PIN_RESET );
 913:../../../mod/flash/flash.c **** 
 914:../../../mod/flash/flash.c **** /* Command opcode */
 915:../../../mod/flash/flash.c **** hal_status[0] = HAL_SPI_Transmit( &( FLASH_SPI )        ,
 916:../../../mod/flash/flash.c **** 							      &flash_opcode         ,
 917:../../../mod/flash/flash.c **** 							      sizeof( flash_opcode ),
 918:../../../mod/flash/flash.c **** 							      HAL_DEFAULT_TIMEOUT );
 919:../../../mod/flash/flash.c **** 
 920:../../../mod/flash/flash.c **** /* Address */
 921:../../../mod/flash/flash.c **** hal_status[1] = HAL_SPI_Transmit( &( FLASH_SPI )   ,
 922:../../../mod/flash/flash.c **** 							      &( address[0] )  ,
 923:../../../mod/flash/flash.c **** 							      sizeof( address ),
 924:../../../mod/flash/flash.c **** 							      HAL_DEFAULT_TIMEOUT );
 925:../../../mod/flash/flash.c **** 
 926:../../../mod/flash/flash.c **** /* Dummy Cycle */
 927:../../../mod/flash/flash.c **** hal_status[2] = HAL_SPI_Transmit( &( FLASH_SPI )   ,
 928:../../../mod/flash/flash.c **** 							      &( dummy_byte )  ,
 929:../../../mod/flash/flash.c **** 							      sizeof( dummy_byte ),
 930:../../../mod/flash/flash.c **** 							      HAL_DEFAULT_TIMEOUT );
 931:../../../mod/flash/flash.c **** 
 932:../../../mod/flash/flash.c **** /* Check for SPI errors */
 933:../../../mod/flash/flash.c **** if ( hal_status[0] != HAL_OK || 
 934:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK || 
 935:../../../mod/flash/flash.c **** 	 hal_status[2] != HAL_OK )
 936:../../../mod/flash/flash.c **** 	{   
 937:../../../mod/flash/flash.c **** 	return FLASH_SPI_ERROR;
 938:../../../mod/flash/flash.c **** 	}
 939:../../../mod/flash/flash.c **** 
 940:../../../mod/flash/flash.c **** /* Recieve output into buffer*/
 941:../../../mod/flash/flash.c **** for ( int i = 0; i < num_bytes; ++i )
 942:../../../mod/flash/flash.c **** 	{
 943:../../../mod/flash/flash.c **** 	pbuffer = ( pflash_handle -> pbuffer ) + i;
ARM GAS  /tmp/cc2q6PEf.s 			page 18


 944:../../../mod/flash/flash.c **** 	hal_status[3] = HAL_SPI_Receive( &( FLASH_SPI )      ,
 945:../../../mod/flash/flash.c **** 								     pbuffer             ,
 946:../../../mod/flash/flash.c **** 								     sizeof( uint8_t )   ,
 947:../../../mod/flash/flash.c **** 								     HAL_DEFAULT_TIMEOUT );
 948:../../../mod/flash/flash.c **** 
 949:../../../mod/flash/flash.c **** 	if ( hal_status[3] != HAL_OK )
 950:../../../mod/flash/flash.c **** 		{
 951:../../../mod/flash/flash.c **** 		return FLASH_SPI_ERROR;
 952:../../../mod/flash/flash.c **** 		}
 953:../../../mod/flash/flash.c **** 	}
 954:../../../mod/flash/flash.c **** 
 955:../../../mod/flash/flash.c **** /* Drive chip enable line high */
 956:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT, FLASH_SS_PIN, GPIO_PIN_SET );
 957:../../../mod/flash/flash.c **** 
 958:../../../mod/flash/flash.c **** /* Flash read successful */
 959:../../../mod/flash/flash.c **** return FLASH_OK;
 960:../../../mod/flash/flash.c **** 
 961:../../../mod/flash/flash.c **** } /* flash_read */
 962:../../../mod/flash/flash.c **** 
 963:../../../mod/flash/flash.c **** 
 964:../../../mod/flash/flash.c **** /*******************************************************************************
 965:../../../mod/flash/flash.c **** *                                                                              *
 966:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   * 
 967:../../../mod/flash/flash.c **** * 		flash_erase                                                            *
 968:../../../mod/flash/flash.c **** *                                                                              *
 969:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 * 
 970:../../../mod/flash/flash.c **** *       erases the entire flash chip                                           *
 971:../../../mod/flash/flash.c **** *                                                                              *
 972:../../../mod/flash/flash.c **** *******************************************************************************/
 973:../../../mod/flash/flash.c **** FLASH_STATUS flash_erase
 974:../../../mod/flash/flash.c ****     (
 975:../../../mod/flash/flash.c ****     HFLASH_BUFFER* pflash_handle	
 976:../../../mod/flash/flash.c ****     )
 977:../../../mod/flash/flash.c **** {
 978:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 979:../../../mod/flash/flash.c ****  Local variables 
 980:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 981:../../../mod/flash/flash.c **** int8_t       hal_status;    /* Status code return by hal spi functions        */
 982:../../../mod/flash/flash.c **** uint8_t      flash_opcode;  /* Data to be transmitted over SPI                */
 983:../../../mod/flash/flash.c **** FLASH_STATUS flash_status;
 984:../../../mod/flash/flash.c **** 
 985:../../../mod/flash/flash.c **** 
 986:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 987:../../../mod/flash/flash.c ****  Initializations 
 988:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 989:../../../mod/flash/flash.c **** flash_opcode = FLASH_OP_HW_FULL_ERASE;
 990:../../../mod/flash/flash.c **** 
 991:../../../mod/flash/flash.c **** 
 992:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 993:../../../mod/flash/flash.c ****  Pre-processing 
 994:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 995:../../../mod/flash/flash.c **** 
 996:../../../mod/flash/flash.c **** /* Check if write_enabled */
 997:../../../mod/flash/flash.c **** if( !( write_enabled ) )
 998:../../../mod/flash/flash.c ****     {
 999:../../../mod/flash/flash.c ****     return FLASH_WRITE_PROTECTED;
1000:../../../mod/flash/flash.c ****     }
ARM GAS  /tmp/cc2q6PEf.s 			page 19


1001:../../../mod/flash/flash.c **** 
1002:../../../mod/flash/flash.c **** 
1003:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
1004:../../../mod/flash/flash.c ****  API function implementation
1005:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
1006:../../../mod/flash/flash.c **** 
1007:../../../mod/flash/flash.c **** /* Enable writing to flash */
1008:../../../mod/flash/flash.c **** flash_status = write_enable();
1009:../../../mod/flash/flash.c **** 
1010:../../../mod/flash/flash.c **** /* Full chip erase */
1011:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT, FLASH_SS_PIN, GPIO_PIN_RESET );
1012:../../../mod/flash/flash.c **** hal_status = HAL_SPI_Transmit( &( FLASH_SPI )        ,
1013:../../../mod/flash/flash.c **** 							   &flash_opcode         ,
1014:../../../mod/flash/flash.c **** 							   sizeof( flash_opcode ),
1015:../../../mod/flash/flash.c **** 							   HAL_DEFAULT_TIMEOUT );
1016:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT, FLASH_SS_PIN, GPIO_PIN_SET );
1017:../../../mod/flash/flash.c **** 
1018:../../../mod/flash/flash.c **** /* Return status code */
1019:../../../mod/flash/flash.c **** if      ( hal_status   != HAL_OK   )
1020:../../../mod/flash/flash.c **** 	{
1021:../../../mod/flash/flash.c **** 	return FLASH_SPI_ERROR;
1022:../../../mod/flash/flash.c **** 	}
1023:../../../mod/flash/flash.c **** else if ( flash_status != FLASH_OK )
1024:../../../mod/flash/flash.c **** 	{
1025:../../../mod/flash/flash.c **** 	return FLASH_FAIL;
1026:../../../mod/flash/flash.c **** 	}
1027:../../../mod/flash/flash.c **** else
1028:../../../mod/flash/flash.c **** 	{
1029:../../../mod/flash/flash.c **** 	return FLASH_OK;
1030:../../../mod/flash/flash.c **** 	}
1031:../../../mod/flash/flash.c **** 
1032:../../../mod/flash/flash.c **** } /* flash_erase */
1033:../../../mod/flash/flash.c **** 
1034:../../../mod/flash/flash.c **** 
1035:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
1036:../../../mod/flash/flash.c ****  Internal procedures 
1037:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
1038:../../../mod/flash/flash.c **** 
1039:../../../mod/flash/flash.c **** 
1040:../../../mod/flash/flash.c **** /*******************************************************************************
1041:../../../mod/flash/flash.c **** *                                                                              *
1042:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   * 
1043:../../../mod/flash/flash.c **** * 		address_to_bytes                                                       *
1044:../../../mod/flash/flash.c **** *                                                                              *
1045:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 * 
1046:../../../mod/flash/flash.c **** * 		Converts a flash memory address in uint32_t format to a byte array     *
1047:../../../mod/flash/flash.c **** *                                                                              *
1048:../../../mod/flash/flash.c **** *******************************************************************************/
1049:../../../mod/flash/flash.c **** static void address_to_bytes
1050:../../../mod/flash/flash.c **** 	(
1051:../../../mod/flash/flash.c **** 	uint32_t address,
1052:../../../mod/flash/flash.c **** 	uint8_t* address_bytes
1053:../../../mod/flash/flash.c **** 	)
1054:../../../mod/flash/flash.c **** {
  28              		.loc 1 1054 1 view -0
  29              		.cfi_startproc
  30              		@ args = 0, pretend = 0, frame = 0
ARM GAS  /tmp/cc2q6PEf.s 			page 20


  31              		@ frame_needed = 0, uses_anonymous_args = 0
  32              		@ link register save eliminated.
1055:../../../mod/flash/flash.c **** address_bytes[0] = (address >> 16) & 0xFF;
  33              		.loc 1 1055 1 view .LVU1
  34              		.loc 1 1055 29 is_stmt 0 view .LVU2
  35 0000 030C     		lsrs	r3, r0, #16
  36              		.loc 1 1055 18 view .LVU3
  37 0002 0B70     		strb	r3, [r1]
1056:../../../mod/flash/flash.c **** address_bytes[1] = (address >> 8 ) & 0xFF;
  38              		.loc 1 1056 1 is_stmt 1 view .LVU4
  39              		.loc 1 1056 29 is_stmt 0 view .LVU5
  40 0004 030A     		lsrs	r3, r0, #8
  41              		.loc 1 1056 18 view .LVU6
  42 0006 4B70     		strb	r3, [r1, #1]
1057:../../../mod/flash/flash.c **** address_bytes[2] =  address        & 0xFF;
  43              		.loc 1 1057 1 is_stmt 1 view .LVU7
  44              		.loc 1 1057 18 is_stmt 0 view .LVU8
  45 0008 8870     		strb	r0, [r1, #2]
1058:../../../mod/flash/flash.c **** } /* address_to_bytes */
  46              		.loc 1 1058 1 view .LVU9
  47 000a 7047     		bx	lr
  48              		.cfi_endproc
  49              	.LFE155:
  51              		.section	.text.write_disable,"ax",%progbits
  52              		.align	1
  53              		.syntax unified
  54              		.thumb
  55              		.thumb_func
  57              	write_disable:
  58              	.LFB158:
1059:../../../mod/flash/flash.c **** 
1060:../../../mod/flash/flash.c **** 
1061:../../../mod/flash/flash.c **** /*******************************************************************************
1062:../../../mod/flash/flash.c **** *                                                                              *
1063:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   * 
1064:../../../mod/flash/flash.c **** * 		bytes_to_address                                                       *
1065:../../../mod/flash/flash.c **** *                                                                              *
1066:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 * 
1067:../../../mod/flash/flash.c **** * 		Converts a flash memory address in byte format to uint32_t format      *
1068:../../../mod/flash/flash.c **** *                                                                              *
1069:../../../mod/flash/flash.c **** *******************************************************************************/
1070:../../../mod/flash/flash.c **** static inline uint32_t bytes_to_address 
1071:../../../mod/flash/flash.c **** 	(
1072:../../../mod/flash/flash.c **** 	uint8_t address_bytes[3]
1073:../../../mod/flash/flash.c **** 	)
1074:../../../mod/flash/flash.c **** {
1075:../../../mod/flash/flash.c **** return ( (uint32_t) address_bytes[0] << 16 ) |
1076:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[1] << 8  ) |
1077:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[2] << 0  );
1078:../../../mod/flash/flash.c **** } /* address_to_bytes */
1079:../../../mod/flash/flash.c **** 
1080:../../../mod/flash/flash.c **** 
1081:../../../mod/flash/flash.c **** /*******************************************************************************
1082:../../../mod/flash/flash.c **** *                                                                              *
1083:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   *
1084:../../../mod/flash/flash.c **** * 		write_enable                                                           *
1085:../../../mod/flash/flash.c **** *                                                                              *
ARM GAS  /tmp/cc2q6PEf.s 			page 21


1086:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 *
1087:../../../mod/flash/flash.c **** *       Enable writing to the external flash chip hardware                     *
1088:../../../mod/flash/flash.c **** *                                                                              *
1089:../../../mod/flash/flash.c **** *******************************************************************************/
1090:../../../mod/flash/flash.c **** static FLASH_STATUS write_enable
1091:../../../mod/flash/flash.c ****     (
1092:../../../mod/flash/flash.c ****     void 
1093:../../../mod/flash/flash.c ****     )
1094:../../../mod/flash/flash.c **** {
1095:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
1096:../../../mod/flash/flash.c ****  Local variables  
1097:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
1098:../../../mod/flash/flash.c **** uint8_t hal_status;        /* Status code return by hal spi functions         */
1099:../../../mod/flash/flash.c **** uint8_t flash_opcode;      /* Flash operation/instruction cyle byte           */
1100:../../../mod/flash/flash.c **** 
1101:../../../mod/flash/flash.c **** 
1102:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
1103:../../../mod/flash/flash.c ****  Local variables  
1104:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
1105:../../../mod/flash/flash.c **** hal_status    = HAL_OK;
1106:../../../mod/flash/flash.c **** flash_opcode  = FLASH_OP_HW_WREN;
1107:../../../mod/flash/flash.c **** 
1108:../../../mod/flash/flash.c **** 
1109:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
1110:../../../mod/flash/flash.c ****  API function implementation 
1111:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
1112:../../../mod/flash/flash.c **** 
1113:../../../mod/flash/flash.c **** /* Send the write enable instruction to the flash over SPI */
1114:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT,
1115:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
1116:../../../mod/flash/flash.c ****                    GPIO_PIN_RESET );
1117:../../../mod/flash/flash.c **** hal_status = HAL_SPI_Transmit( &( FLASH_SPI )        ,
1118:../../../mod/flash/flash.c ****                                &flash_opcode         ,
1119:../../../mod/flash/flash.c ****                                sizeof( flash_opcode ),
1120:../../../mod/flash/flash.c ****                                HAL_DEFAULT_TIMEOUT );
1121:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT,
1122:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
1123:../../../mod/flash/flash.c ****                    GPIO_PIN_SET );
1124:../../../mod/flash/flash.c **** 
1125:../../../mod/flash/flash.c **** /* Set write enabled bit in flash buffer handle */
1126:../../../mod/flash/flash.c **** if ( hal_status != HAL_OK )
1127:../../../mod/flash/flash.c **** 	{
1128:../../../mod/flash/flash.c **** 	return FLASH_SPI_ERROR;
1129:../../../mod/flash/flash.c ****     }
1130:../../../mod/flash/flash.c **** else
1131:../../../mod/flash/flash.c **** 	{
1132:../../../mod/flash/flash.c **** 	return FLASH_OK;
1133:../../../mod/flash/flash.c ****     }
1134:../../../mod/flash/flash.c **** 
1135:../../../mod/flash/flash.c **** } /* write_enable */
1136:../../../mod/flash/flash.c **** 
1137:../../../mod/flash/flash.c **** 
1138:../../../mod/flash/flash.c **** /*******************************************************************************
1139:../../../mod/flash/flash.c **** *                                                                              *
1140:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   *
1141:../../../mod/flash/flash.c **** * 		write_disable                                                          *
1142:../../../mod/flash/flash.c **** *                                                                              *
ARM GAS  /tmp/cc2q6PEf.s 			page 22


1143:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 *
1144:../../../mod/flash/flash.c **** *       Disable writing to the external flash chip hardware                    *
1145:../../../mod/flash/flash.c **** *                                                                              *
1146:../../../mod/flash/flash.c **** *******************************************************************************/
1147:../../../mod/flash/flash.c **** static FLASH_STATUS write_disable 
1148:../../../mod/flash/flash.c ****     (
1149:../../../mod/flash/flash.c ****     void 
1150:../../../mod/flash/flash.c ****     )
1151:../../../mod/flash/flash.c **** {
  59              		.loc 1 1151 1 is_stmt 1 view -0
  60              		.cfi_startproc
  61              		@ args = 0, pretend = 0, frame = 8
  62              		@ frame_needed = 0, uses_anonymous_args = 0
  63 0000 30B5     		push	{r4, r5, lr}
  64              	.LCFI0:
  65              		.cfi_def_cfa_offset 12
  66              		.cfi_offset 4, -12
  67              		.cfi_offset 5, -8
  68              		.cfi_offset 14, -4
  69 0002 83B0     		sub	sp, sp, #12
  70              	.LCFI1:
  71              		.cfi_def_cfa_offset 24
1152:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
1153:../../../mod/flash/flash.c ****  Local variables  
1154:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
1155:../../../mod/flash/flash.c **** uint8_t hal_status;        /* Status code return by hal spi functions         */
  72              		.loc 1 1155 1 view .LVU11
1156:../../../mod/flash/flash.c **** uint8_t flash_opcode;      /* Flash operation/instruction cyle byte           */
  73              		.loc 1 1156 1 view .LVU12
1157:../../../mod/flash/flash.c **** 
1158:../../../mod/flash/flash.c **** 
1159:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
1160:../../../mod/flash/flash.c ****  Local variables  
1161:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
1162:../../../mod/flash/flash.c **** hal_status    = HAL_OK;
  74              		.loc 1 1162 1 view .LVU13
  75              	.LVL1:
1163:../../../mod/flash/flash.c **** flash_opcode  = FLASH_OP_HW_WRDI;
  76              		.loc 1 1163 1 view .LVU14
  77              		.loc 1 1163 15 is_stmt 0 view .LVU15
  78 0004 0423     		movs	r3, #4
  79 0006 8DF80730 		strb	r3, [sp, #7]
1164:../../../mod/flash/flash.c **** 
1165:../../../mod/flash/flash.c **** 
1166:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
1167:../../../mod/flash/flash.c ****  API function implementation 
1168:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
1169:../../../mod/flash/flash.c **** 
1170:../../../mod/flash/flash.c **** /* Send the write enable instruction to the flash over SPI */
1171:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT,
  80              		.loc 1 1171 1 is_stmt 1 view .LVU16
  81 000a 0D4D     		ldr	r5, .L6
  82 000c 0022     		movs	r2, #0
  83 000e 4FF48051 		mov	r1, #4096
  84 0012 2846     		mov	r0, r5
  85 0014 FFF7FEFF 		bl	HAL_GPIO_WritePin
  86              	.LVL2:
ARM GAS  /tmp/cc2q6PEf.s 			page 23


1172:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
1173:../../../mod/flash/flash.c ****                    GPIO_PIN_RESET );
1174:../../../mod/flash/flash.c **** hal_status = HAL_SPI_Transmit( &( FLASH_SPI )        ,
  87              		.loc 1 1174 1 view .LVU17
  88              		.loc 1 1174 14 is_stmt 0 view .LVU18
  89 0018 0A23     		movs	r3, #10
  90 001a 0122     		movs	r2, #1
  91 001c 0DF10701 		add	r1, sp, #7
  92 0020 0848     		ldr	r0, .L6+4
  93 0022 FFF7FEFF 		bl	HAL_SPI_Transmit
  94              	.LVL3:
  95 0026 0446     		mov	r4, r0
  96              	.LVL4:
1175:../../../mod/flash/flash.c ****                                &flash_opcode         ,
1176:../../../mod/flash/flash.c ****                                sizeof( flash_opcode ),
1177:../../../mod/flash/flash.c ****                                HAL_DEFAULT_TIMEOUT );
1178:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT,
  97              		.loc 1 1178 1 is_stmt 1 view .LVU19
  98 0028 0122     		movs	r2, #1
  99 002a 4FF48051 		mov	r1, #4096
 100 002e 2846     		mov	r0, r5
 101 0030 FFF7FEFF 		bl	HAL_GPIO_WritePin
 102              	.LVL5:
1179:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
1180:../../../mod/flash/flash.c ****                    GPIO_PIN_SET );
1181:../../../mod/flash/flash.c **** 
1182:../../../mod/flash/flash.c **** /* Return results of SPI HAL calls */
1183:../../../mod/flash/flash.c **** if ( hal_status != HAL_OK )
 103              		.loc 1 1183 1 view .LVU20
 104              		.loc 1 1183 4 is_stmt 0 view .LVU21
 105 0034 14B9     		cbnz	r4, .L5
 106              	.LVL6:
 107              	.L3:
1184:../../../mod/flash/flash.c **** 	{
1185:../../../mod/flash/flash.c **** 	return FLASH_SPI_ERROR;
1186:../../../mod/flash/flash.c ****     }
1187:../../../mod/flash/flash.c **** else
1188:../../../mod/flash/flash.c **** 	{
1189:../../../mod/flash/flash.c **** 	return FLASH_OK;
1190:../../../mod/flash/flash.c ****     }
1191:../../../mod/flash/flash.c **** 
1192:../../../mod/flash/flash.c **** } /* write_disable */
 108              		.loc 1 1192 1 view .LVU22
 109 0036 2046     		mov	r0, r4
 110 0038 03B0     		add	sp, sp, #12
 111              	.LCFI2:
 112              		.cfi_remember_state
 113              		.cfi_def_cfa_offset 12
 114              		@ sp needed
 115 003a 30BD     		pop	{r4, r5, pc}
 116              	.LVL7:
 117              	.L5:
 118              	.LCFI3:
 119              		.cfi_restore_state
1185:../../../mod/flash/flash.c ****     }
 120              		.loc 1 1185 9 view .LVU23
 121 003c 0824     		movs	r4, #8
ARM GAS  /tmp/cc2q6PEf.s 			page 24


 122              	.LVL8:
1185:../../../mod/flash/flash.c ****     }
 123              		.loc 1 1185 9 view .LVU24
 124 003e FAE7     		b	.L3
 125              	.L7:
 126              		.align	2
 127              	.L6:
 128 0040 00040258 		.word	1476527104
 129 0044 00000000 		.word	hspi2
 130              		.cfi_endproc
 131              	.LFE158:
 133              		.section	.text.write_enable,"ax",%progbits
 134              		.align	1
 135              		.syntax unified
 136              		.thumb
 137              		.thumb_func
 139              	write_enable:
 140              	.LFB157:
1094:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 141              		.loc 1 1094 1 is_stmt 1 view -0
 142              		.cfi_startproc
 143              		@ args = 0, pretend = 0, frame = 8
 144              		@ frame_needed = 0, uses_anonymous_args = 0
 145 0000 30B5     		push	{r4, r5, lr}
 146              	.LCFI4:
 147              		.cfi_def_cfa_offset 12
 148              		.cfi_offset 4, -12
 149              		.cfi_offset 5, -8
 150              		.cfi_offset 14, -4
 151 0002 83B0     		sub	sp, sp, #12
 152              	.LCFI5:
 153              		.cfi_def_cfa_offset 24
1098:../../../mod/flash/flash.c **** uint8_t flash_opcode;      /* Flash operation/instruction cyle byte           */
 154              		.loc 1 1098 1 view .LVU26
1099:../../../mod/flash/flash.c **** 
 155              		.loc 1 1099 1 view .LVU27
1105:../../../mod/flash/flash.c **** flash_opcode  = FLASH_OP_HW_WREN;
 156              		.loc 1 1105 1 view .LVU28
 157              	.LVL9:
1106:../../../mod/flash/flash.c **** 
 158              		.loc 1 1106 1 view .LVU29
1106:../../../mod/flash/flash.c **** 
 159              		.loc 1 1106 15 is_stmt 0 view .LVU30
 160 0004 0623     		movs	r3, #6
 161 0006 8DF80730 		strb	r3, [sp, #7]
1114:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 162              		.loc 1 1114 1 is_stmt 1 view .LVU31
 163 000a 0D4D     		ldr	r5, .L12
 164 000c 0022     		movs	r2, #0
 165 000e 4FF48051 		mov	r1, #4096
 166 0012 2846     		mov	r0, r5
 167 0014 FFF7FEFF 		bl	HAL_GPIO_WritePin
 168              	.LVL10:
1117:../../../mod/flash/flash.c ****                                &flash_opcode         ,
 169              		.loc 1 1117 1 view .LVU32
1117:../../../mod/flash/flash.c ****                                &flash_opcode         ,
 170              		.loc 1 1117 14 is_stmt 0 view .LVU33
ARM GAS  /tmp/cc2q6PEf.s 			page 25


 171 0018 0A23     		movs	r3, #10
 172 001a 0122     		movs	r2, #1
 173 001c 0DF10701 		add	r1, sp, #7
 174 0020 0848     		ldr	r0, .L12+4
 175 0022 FFF7FEFF 		bl	HAL_SPI_Transmit
 176              	.LVL11:
 177 0026 0446     		mov	r4, r0
 178              	.LVL12:
1121:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 179              		.loc 1 1121 1 is_stmt 1 view .LVU34
 180 0028 0122     		movs	r2, #1
 181 002a 4FF48051 		mov	r1, #4096
 182 002e 2846     		mov	r0, r5
 183 0030 FFF7FEFF 		bl	HAL_GPIO_WritePin
 184              	.LVL13:
1126:../../../mod/flash/flash.c **** 	{
 185              		.loc 1 1126 1 view .LVU35
1126:../../../mod/flash/flash.c **** 	{
 186              		.loc 1 1126 4 is_stmt 0 view .LVU36
 187 0034 14B9     		cbnz	r4, .L11
 188              	.LVL14:
 189              	.L9:
1135:../../../mod/flash/flash.c **** 
 190              		.loc 1 1135 1 view .LVU37
 191 0036 2046     		mov	r0, r4
 192 0038 03B0     		add	sp, sp, #12
 193              	.LCFI6:
 194              		.cfi_remember_state
 195              		.cfi_def_cfa_offset 12
 196              		@ sp needed
 197 003a 30BD     		pop	{r4, r5, pc}
 198              	.LVL15:
 199              	.L11:
 200              	.LCFI7:
 201              		.cfi_restore_state
1128:../../../mod/flash/flash.c ****     }
 202              		.loc 1 1128 9 view .LVU38
 203 003c 0824     		movs	r4, #8
 204              	.LVL16:
1128:../../../mod/flash/flash.c ****     }
 205              		.loc 1 1128 9 view .LVU39
 206 003e FAE7     		b	.L9
 207              	.L13:
 208              		.align	2
 209              	.L12:
 210 0040 00040258 		.word	1476527104
 211 0044 00000000 		.word	hspi2
 212              		.cfi_endproc
 213              	.LFE157:
 215              		.section	.text.flash_get_status,"ax",%progbits
 216              		.align	1
 217              		.global	flash_get_status
 218              		.syntax unified
 219              		.thumb
 220              		.thumb_func
 222              	flash_get_status:
 223              	.LVL17:
ARM GAS  /tmp/cc2q6PEf.s 			page 26


 224              	.LFB146:
 402:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 225              		.loc 1 402 1 is_stmt 1 view -0
 226              		.cfi_startproc
 227              		@ args = 0, pretend = 0, frame = 8
 228              		@ frame_needed = 0, uses_anonymous_args = 0
 402:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 229              		.loc 1 402 1 is_stmt 0 view .LVU41
 230 0000 F0B5     		push	{r4, r5, r6, r7, lr}
 231              	.LCFI8:
 232              		.cfi_def_cfa_offset 20
 233              		.cfi_offset 4, -20
 234              		.cfi_offset 5, -16
 235              		.cfi_offset 6, -12
 236              		.cfi_offset 7, -8
 237              		.cfi_offset 14, -4
 238 0002 83B0     		sub	sp, sp, #12
 239              	.LCFI9:
 240              		.cfi_def_cfa_offset 32
 241 0004 0446     		mov	r4, r0
 406:../../../mod/flash/flash.c **** uint8_t           flash_opcode;   /* Data to be transmitted over SPI          */
 242              		.loc 1 406 1 is_stmt 1 view .LVU42
 407:../../../mod/flash/flash.c **** 
 243              		.loc 1 407 1 view .LVU43
 412:../../../mod/flash/flash.c **** 
 244              		.loc 1 412 1 view .LVU44
 412:../../../mod/flash/flash.c **** 
 245              		.loc 1 412 14 is_stmt 0 view .LVU45
 246 0006 0523     		movs	r3, #5
 247 0008 8DF80330 		strb	r3, [sp, #3]
 420:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 248              		.loc 1 420 1 is_stmt 1 view .LVU46
 249 000c 154E     		ldr	r6, .L19
 250 000e 0022     		movs	r2, #0
 251 0010 4FF48051 		mov	r1, #4096
 252 0014 3046     		mov	r0, r6
 253              	.LVL18:
 420:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 254              		.loc 1 420 1 is_stmt 0 view .LVU47
 255 0016 FFF7FEFF 		bl	HAL_GPIO_WritePin
 256              	.LVL19:
 425:../../../mod/flash/flash.c ****                                   &flash_opcode         ,
 257              		.loc 1 425 1 is_stmt 1 view .LVU48
 425:../../../mod/flash/flash.c ****                                   &flash_opcode         ,
 258              		.loc 1 425 17 is_stmt 0 view .LVU49
 259 001a 134F     		ldr	r7, .L19+4
 260 001c 0A23     		movs	r3, #10
 261 001e 0122     		movs	r2, #1
 262 0020 0DF10301 		add	r1, sp, #3
 263 0024 3846     		mov	r0, r7
 264 0026 FFF7FEFF 		bl	HAL_SPI_Transmit
 265              	.LVL20:
 266 002a 0546     		mov	r5, r0
 425:../../../mod/flash/flash.c ****                                   &flash_opcode         ,
 267              		.loc 1 425 15 view .LVU50
 268 002c 8DF80400 		strb	r0, [sp, #4]
 431:../../../mod/flash/flash.c ****                                  &( pflash_handle      -> status_register ),
ARM GAS  /tmp/cc2q6PEf.s 			page 27


 269              		.loc 1 431 1 is_stmt 1 view .LVU51
 431:../../../mod/flash/flash.c ****                                  &( pflash_handle      -> status_register ),
 270              		.loc 1 431 17 is_stmt 0 view .LVU52
 271 0030 0A23     		movs	r3, #10
 272 0032 0122     		movs	r2, #1
 273 0034 04F10F01 		add	r1, r4, #15
 274 0038 3846     		mov	r0, r7
 275 003a FFF7FEFF 		bl	HAL_SPI_Receive
 276              	.LVL21:
 277 003e 0446     		mov	r4, r0
 278              	.LVL22:
 431:../../../mod/flash/flash.c ****                                  &( pflash_handle      -> status_register ),
 279              		.loc 1 431 15 view .LVU53
 280 0040 8DF80500 		strb	r0, [sp, #5]
 437:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 281              		.loc 1 437 1 is_stmt 1 view .LVU54
 282 0044 0122     		movs	r2, #1
 283 0046 4FF48051 		mov	r1, #4096
 284 004a 3046     		mov	r0, r6
 285 004c FFF7FEFF 		bl	HAL_GPIO_WritePin
 286              	.LVL23:
 442:../../../mod/flash/flash.c **** 	{
 287              		.loc 1 442 1 view .LVU55
 442:../../../mod/flash/flash.c **** 	{
 288              		.loc 1 442 4 is_stmt 0 view .LVU56
 289 0050 2DB9     		cbnz	r5, .L16
 442:../../../mod/flash/flash.c **** 	{
 290              		.loc 1 442 30 discriminator 1 view .LVU57
 291 0052 14B9     		cbnz	r4, .L18
 292              	.L15:
 451:../../../mod/flash/flash.c **** 
 293              		.loc 1 451 1 view .LVU58
 294 0054 2046     		mov	r0, r4
 295 0056 03B0     		add	sp, sp, #12
 296              	.LCFI10:
 297              		.cfi_remember_state
 298              		.cfi_def_cfa_offset 20
 299              		@ sp needed
 300 0058 F0BD     		pop	{r4, r5, r6, r7, pc}
 301              	.L18:
 302              	.LCFI11:
 303              		.cfi_restore_state
 444:../../../mod/flash/flash.c **** 	}
 304              		.loc 1 444 9 view .LVU59
 305 005a 0824     		movs	r4, #8
 306 005c FAE7     		b	.L15
 307              	.L16:
 308 005e 0824     		movs	r4, #8
 309 0060 F8E7     		b	.L15
 310              	.L20:
 311 0062 00BF     		.align	2
 312              	.L19:
 313 0064 00040258 		.word	1476527104
 314 0068 00000000 		.word	hspi2
 315              		.cfi_endproc
 316              	.LFE146:
 318              		.section	.text.flash_set_status,"ax",%progbits
ARM GAS  /tmp/cc2q6PEf.s 			page 28


 319              		.align	1
 320              		.global	flash_set_status
 321              		.syntax unified
 322              		.thumb
 323              		.thumb_func
 325              	flash_set_status:
 326              	.LVL24:
 327              	.LFB147:
 467:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 328              		.loc 1 467 1 is_stmt 1 view -0
 329              		.cfi_startproc
 330              		@ args = 0, pretend = 0, frame = 16
 331              		@ frame_needed = 0, uses_anonymous_args = 0
 467:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 332              		.loc 1 467 1 is_stmt 0 view .LVU61
 333 0000 F0B5     		push	{r4, r5, r6, r7, lr}
 334              	.LCFI12:
 335              		.cfi_def_cfa_offset 20
 336              		.cfi_offset 4, -20
 337              		.cfi_offset 5, -16
 338              		.cfi_offset 6, -12
 339              		.cfi_offset 7, -8
 340              		.cfi_offset 14, -4
 341 0002 85B0     		sub	sp, sp, #20
 342              	.LCFI13:
 343              		.cfi_def_cfa_offset 40
 344 0004 8DF80700 		strb	r0, [sp, #7]
 471:../../../mod/flash/flash.c **** uint8_t flash_opcodes[2];   /* Flash instruction cycle bytes                  */
 345              		.loc 1 471 1 is_stmt 1 view .LVU62
 472:../../../mod/flash/flash.c **** 
 346              		.loc 1 472 1 view .LVU63
 478:../../../mod/flash/flash.c **** flash_opcodes[1] = FLASH_OP_HW_WRSR;
 347              		.loc 1 478 1 view .LVU64
 478:../../../mod/flash/flash.c **** flash_opcodes[1] = FLASH_OP_HW_WRSR;
 348              		.loc 1 478 18 is_stmt 0 view .LVU65
 349 0008 5023     		movs	r3, #80
 350 000a 8DF80830 		strb	r3, [sp, #8]
 479:../../../mod/flash/flash.c **** 
 351              		.loc 1 479 1 is_stmt 1 view .LVU66
 479:../../../mod/flash/flash.c **** 
 352              		.loc 1 479 18 is_stmt 0 view .LVU67
 353 000e 0123     		movs	r3, #1
 354 0010 8DF80930 		strb	r3, [sp, #9]
 485:../../../mod/flash/flash.c **** 	{
 355              		.loc 1 485 1 is_stmt 1 view .LVU68
 485:../../../mod/flash/flash.c **** 	{
 356              		.loc 1 485 6 is_stmt 0 view .LVU69
 357 0014 234B     		ldr	r3, .L27
 358 0016 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 485:../../../mod/flash/flash.c **** 	{
 359              		.loc 1 485 4 view .LVU70
 360 0018 DBB3     		cbz	r3, .L23
 496:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 361              		.loc 1 496 1 is_stmt 1 view .LVU71
 362 001a 234E     		ldr	r6, .L27+4
 363 001c 0022     		movs	r2, #0
 364 001e 4FF48051 		mov	r1, #4096
ARM GAS  /tmp/cc2q6PEf.s 			page 29


 365 0022 3046     		mov	r0, r6
 366              	.LVL25:
 496:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 367              		.loc 1 496 1 is_stmt 0 view .LVU72
 368 0024 FFF7FEFF 		bl	HAL_GPIO_WritePin
 369              	.LVL26:
 499:../../../mod/flash/flash.c ****                                   &flash_opcodes[0],
 370              		.loc 1 499 1 is_stmt 1 view .LVU73
 499:../../../mod/flash/flash.c ****                                   &flash_opcodes[0],
 371              		.loc 1 499 17 is_stmt 0 view .LVU74
 372 0028 204C     		ldr	r4, .L27+8
 373 002a 0A23     		movs	r3, #10
 374 002c 0122     		movs	r2, #1
 375 002e 02A9     		add	r1, sp, #8
 376 0030 2046     		mov	r0, r4
 377 0032 FFF7FEFF 		bl	HAL_SPI_Transmit
 378              	.LVL27:
 379 0036 0546     		mov	r5, r0
 499:../../../mod/flash/flash.c ****                                   &flash_opcodes[0],
 380              		.loc 1 499 15 view .LVU75
 381 0038 8DF80C00 		strb	r0, [sp, #12]
 503:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 382              		.loc 1 503 1 is_stmt 1 view .LVU76
 383 003c 0122     		movs	r2, #1
 384 003e 4FF48051 		mov	r1, #4096
 385 0042 3046     		mov	r0, r6
 386 0044 FFF7FEFF 		bl	HAL_GPIO_WritePin
 387              	.LVL28:
 508:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 388              		.loc 1 508 1 view .LVU77
 389 0048 0022     		movs	r2, #0
 390 004a 4FF48051 		mov	r1, #4096
 391 004e 3046     		mov	r0, r6
 392 0050 FFF7FEFF 		bl	HAL_GPIO_WritePin
 393              	.LVL29:
 511:../../../mod/flash/flash.c ****                                   &flash_opcodes[1],
 394              		.loc 1 511 1 view .LVU78
 511:../../../mod/flash/flash.c ****                                   &flash_opcodes[1],
 395              		.loc 1 511 17 is_stmt 0 view .LVU79
 396 0054 0A23     		movs	r3, #10
 397 0056 0122     		movs	r2, #1
 398 0058 0DF10901 		add	r1, sp, #9
 399 005c 2046     		mov	r0, r4
 400 005e FFF7FEFF 		bl	HAL_SPI_Transmit
 401              	.LVL30:
 402 0062 0746     		mov	r7, r0
 511:../../../mod/flash/flash.c ****                                   &flash_opcodes[1],
 403              		.loc 1 511 15 view .LVU80
 404 0064 8DF80D00 		strb	r0, [sp, #13]
 515:../../../mod/flash/flash.c ****                                   &flash_status         ,
 405              		.loc 1 515 1 is_stmt 1 view .LVU81
 515:../../../mod/flash/flash.c ****                                   &flash_status         ,
 406              		.loc 1 515 17 is_stmt 0 view .LVU82
 407 0068 0A23     		movs	r3, #10
 408 006a 0122     		movs	r2, #1
 409 006c 0DF10701 		add	r1, sp, #7
 410 0070 2046     		mov	r0, r4
ARM GAS  /tmp/cc2q6PEf.s 			page 30


 411 0072 FFF7FEFF 		bl	HAL_SPI_Transmit
 412              	.LVL31:
 413 0076 0446     		mov	r4, r0
 515:../../../mod/flash/flash.c ****                                   &flash_status         ,
 414              		.loc 1 515 15 view .LVU83
 415 0078 8DF80E00 		strb	r0, [sp, #14]
 519:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 416              		.loc 1 519 1 is_stmt 1 view .LVU84
 417 007c 0122     		movs	r2, #1
 418 007e 4FF48051 		mov	r1, #4096
 419 0082 3046     		mov	r0, r6
 420 0084 FFF7FEFF 		bl	HAL_GPIO_WritePin
 421              	.LVL32:
 524:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK ||
 422              		.loc 1 524 1 view .LVU85
 524:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK ||
 423              		.loc 1 524 4 is_stmt 0 view .LVU86
 424 0088 3DB9     		cbnz	r5, .L24
 524:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK ||
 425              		.loc 1 524 30 discriminator 1 view .LVU87
 426 008a 47B9     		cbnz	r7, .L25
 525:../../../mod/flash/flash.c **** 	 hal_status[2] != HAL_OK )
 427              		.loc 1 525 30 view .LVU88
 428 008c 14B1     		cbz	r4, .L22
 528:../../../mod/flash/flash.c **** 	}
 429              		.loc 1 528 9 view .LVU89
 430 008e 0824     		movs	r4, #8
 431 0090 00E0     		b	.L22
 432              	.LVL33:
 433              	.L23:
 487:../../../mod/flash/flash.c **** 	}
 434              		.loc 1 487 9 view .LVU90
 435 0092 0524     		movs	r4, #5
 436              	.LVL34:
 437              	.L22:
 535:../../../mod/flash/flash.c **** 
 438              		.loc 1 535 1 view .LVU91
 439 0094 2046     		mov	r0, r4
 440 0096 05B0     		add	sp, sp, #20
 441              	.LCFI14:
 442              		.cfi_remember_state
 443              		.cfi_def_cfa_offset 20
 444              		@ sp needed
 445 0098 F0BD     		pop	{r4, r5, r6, r7, pc}
 446              	.L24:
 447              	.LCFI15:
 448              		.cfi_restore_state
 528:../../../mod/flash/flash.c **** 	}
 449              		.loc 1 528 9 view .LVU92
 450 009a 0824     		movs	r4, #8
 451 009c FAE7     		b	.L22
 452              	.L25:
 453 009e 0824     		movs	r4, #8
 454 00a0 F8E7     		b	.L22
 455              	.L28:
 456 00a2 00BF     		.align	2
 457              	.L27:
ARM GAS  /tmp/cc2q6PEf.s 			page 31


 458 00a4 00000000 		.word	write_enabled
 459 00a8 00040258 		.word	1476527104
 460 00ac 00000000 		.word	hspi2
 461              		.cfi_endproc
 462              	.LFE147:
 464              		.section	.text.flash_is_flash_busy,"ax",%progbits
 465              		.align	1
 466              		.global	flash_is_flash_busy
 467              		.syntax unified
 468              		.thumb
 469              		.thumb_func
 471              	flash_is_flash_busy:
 472              	.LFB148:
 552:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 473              		.loc 1 552 1 is_stmt 1 view -0
 474              		.cfi_startproc
 475              		@ args = 0, pretend = 0, frame = 16
 476              		@ frame_needed = 0, uses_anonymous_args = 0
 477 0000 00B5     		push	{lr}
 478              	.LCFI16:
 479              		.cfi_def_cfa_offset 4
 480              		.cfi_offset 14, -4
 481 0002 85B0     		sub	sp, sp, #20
 482              	.LCFI17:
 483              		.cfi_def_cfa_offset 24
 556:../../../mod/flash/flash.c **** FLASH_STATUS  flash_status; /* Flash API return codes                         */
 484              		.loc 1 556 1 view .LVU94
 557:../../../mod/flash/flash.c **** 
 485              		.loc 1 557 1 view .LVU95
 563:../../../mod/flash/flash.c **** flash_handle.status_register = 0xFF;
 486              		.loc 1 563 1 view .LVU96
 487              	.LVL35:
 564:../../../mod/flash/flash.c **** 
 488              		.loc 1 564 1 view .LVU97
 564:../../../mod/flash/flash.c **** 
 489              		.loc 1 564 30 is_stmt 0 view .LVU98
 490 0004 FF23     		movs	r3, #255
 491 0006 8DF80F30 		strb	r3, [sp, #15]
 572:../../../mod/flash/flash.c **** if      ( flash_status != FLASH_OK                          )
 492              		.loc 1 572 1 is_stmt 1 view .LVU99
 572:../../../mod/flash/flash.c **** if      ( flash_status != FLASH_OK                          )
 493              		.loc 1 572 16 is_stmt 0 view .LVU100
 494 000a 6846     		mov	r0, sp
 495 000c FFF7FEFF 		bl	flash_get_status
 496              	.LVL36:
 573:../../../mod/flash/flash.c **** 	{
 497              		.loc 1 573 1 is_stmt 1 view .LVU101
 573:../../../mod/flash/flash.c **** 	{
 498              		.loc 1 573 9 is_stmt 0 view .LVU102
 499 0010 30B9     		cbnz	r0, .L31
 577:../../../mod/flash/flash.c **** 	{
 500              		.loc 1 577 6 is_stmt 1 view .LVU103
 577:../../../mod/flash/flash.c **** 	{
 501              		.loc 1 577 23 is_stmt 0 view .LVU104
 502 0012 9DF80F30 		ldrb	r3, [sp, #15]	@ zero_extendqisi2
 577:../../../mod/flash/flash.c **** 	{
 503              		.loc 1 577 9 view .LVU105
ARM GAS  /tmp/cc2q6PEf.s 			page 32


 504 0016 13F0010F 		tst	r3, #1
 505 001a 05D0     		beq	.L32
 579:../../../mod/flash/flash.c **** 	}
 506              		.loc 1 579 9 view .LVU106
 507 001c 0120     		movs	r0, #1
 508              	.LVL37:
 579:../../../mod/flash/flash.c **** 	}
 509              		.loc 1 579 9 view .LVU107
 510 001e 00E0     		b	.L30
 511              	.LVL38:
 512              	.L31:
 575:../../../mod/flash/flash.c **** 	}
 513              		.loc 1 575 9 view .LVU108
 514 0020 0120     		movs	r0, #1
 515              	.LVL39:
 516              	.L30:
 586:../../../mod/flash/flash.c **** 
 517              		.loc 1 586 1 view .LVU109
 518 0022 05B0     		add	sp, sp, #20
 519              	.LCFI18:
 520              		.cfi_remember_state
 521              		.cfi_def_cfa_offset 4
 522              		@ sp needed
 523 0024 5DF804FB 		ldr	pc, [sp], #4
 524              	.LVL40:
 525              	.L32:
 526              	.LCFI19:
 527              		.cfi_restore_state
 583:../../../mod/flash/flash.c **** 	}
 528              		.loc 1 583 9 view .LVU110
 529 0028 0020     		movs	r0, #0
 530              	.LVL41:
 583:../../../mod/flash/flash.c **** 	}
 531              		.loc 1 583 9 view .LVU111
 532 002a FAE7     		b	.L30
 533              		.cfi_endproc
 534              	.LFE148:
 536              		.section	.text.flash_write_enable,"ax",%progbits
 537              		.align	1
 538              		.global	flash_write_enable
 539              		.syntax unified
 540              		.thumb
 541              		.thumb_func
 543              	flash_write_enable:
 544              	.LFB149:
 603:../../../mod/flash/flash.c **** write_enabled = true;
 545              		.loc 1 603 1 is_stmt 1 view -0
 546              		.cfi_startproc
 547              		@ args = 0, pretend = 0, frame = 0
 548              		@ frame_needed = 0, uses_anonymous_args = 0
 549              		@ link register save eliminated.
 604:../../../mod/flash/flash.c **** } /* flash_write_enable */
 550              		.loc 1 604 1 view .LVU113
 604:../../../mod/flash/flash.c **** } /* flash_write_enable */
 551              		.loc 1 604 15 is_stmt 0 view .LVU114
 552 0000 014B     		ldr	r3, .L35
 553 0002 0122     		movs	r2, #1
ARM GAS  /tmp/cc2q6PEf.s 			page 33


 554 0004 1A70     		strb	r2, [r3]
 605:../../../mod/flash/flash.c **** 
 555              		.loc 1 605 1 view .LVU115
 556 0006 7047     		bx	lr
 557              	.L36:
 558              		.align	2
 559              	.L35:
 560 0008 00000000 		.word	write_enabled
 561              		.cfi_endproc
 562              	.LFE149:
 564              		.section	.text.flash_write_disable,"ax",%progbits
 565              		.align	1
 566              		.global	flash_write_disable
 567              		.syntax unified
 568              		.thumb
 569              		.thumb_func
 571              	flash_write_disable:
 572              	.LFB150:
 621:../../../mod/flash/flash.c **** write_enabled = false;
 573              		.loc 1 621 1 is_stmt 1 view -0
 574              		.cfi_startproc
 575              		@ args = 0, pretend = 0, frame = 0
 576              		@ frame_needed = 0, uses_anonymous_args = 0
 577              		@ link register save eliminated.
 622:../../../mod/flash/flash.c **** } /* flash_write_disable */
 578              		.loc 1 622 1 view .LVU117
 622:../../../mod/flash/flash.c **** } /* flash_write_disable */
 579              		.loc 1 622 15 is_stmt 0 view .LVU118
 580 0000 014B     		ldr	r3, .L38
 581 0002 0022     		movs	r2, #0
 582 0004 1A70     		strb	r2, [r3]
 623:../../../mod/flash/flash.c **** 
 583              		.loc 1 623 1 view .LVU119
 584 0006 7047     		bx	lr
 585              	.L39:
 586              		.align	2
 587              	.L38:
 588 0008 00000000 		.word	write_enabled
 589              		.cfi_endproc
 590              	.LFE150:
 592              		.section	.text.flash_init,"ax",%progbits
 593              		.align	1
 594              		.global	flash_init
 595              		.syntax unified
 596              		.thumb
 597              		.thumb_func
 599              	flash_init:
 600              	.LVL42:
 601              	.LFB145:
 309:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 602              		.loc 1 309 1 is_stmt 1 view -0
 603              		.cfi_startproc
 604              		@ args = 0, pretend = 0, frame = 0
 605              		@ frame_needed = 0, uses_anonymous_args = 0
 309:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 606              		.loc 1 309 1 is_stmt 0 view .LVU121
 607 0000 38B5     		push	{r3, r4, r5, lr}
ARM GAS  /tmp/cc2q6PEf.s 			page 34


 608              	.LCFI20:
 609              		.cfi_def_cfa_offset 16
 610              		.cfi_offset 3, -16
 611              		.cfi_offset 4, -12
 612              		.cfi_offset 5, -8
 613              		.cfi_offset 14, -4
 614 0002 0446     		mov	r4, r0
 313:../../../mod/flash/flash.c **** uint8_t      status_register; /* Desired status register contents       */
 615              		.loc 1 313 1 is_stmt 1 view .LVU122
 314:../../../mod/flash/flash.c **** 
 616              		.loc 1 314 1 view .LVU123
 320:../../../mod/flash/flash.c **** status_register = FLASH_REG_RESET_VAL;
 617              		.loc 1 320 1 view .LVU124
 618              	.LVL43:
 321:../../../mod/flash/flash.c **** 
 619              		.loc 1 321 1 view .LVU125
 329:../../../mod/flash/flash.c **** 	{
 620              		.loc 1 329 1 view .LVU126
 329:../../../mod/flash/flash.c **** 	{
 621              		.loc 1 329 20 is_stmt 0 view .LVU127
 622 0004 407B     		ldrb	r0, [r0, #13]	@ zero_extendqisi2
 623              	.LVL44:
 329:../../../mod/flash/flash.c **** 	{
 624              		.loc 1 329 4 view .LVU128
 625 0006 DC28     		cmp	r0, #220
 626 0008 25D8     		bhi	.L44
 335:../../../mod/flash/flash.c **** status_register |= pflash_handle -> bpl_write_protect;
 627              		.loc 1 335 1 is_stmt 1 view .LVU129
 335:../../../mod/flash/flash.c **** status_register |= pflash_handle -> bpl_write_protect;
 628              		.loc 1 335 17 is_stmt 0 view .LVU130
 629 000a 00F03800 		and	r0, r0, #56
 630              	.LVL45:
 336:../../../mod/flash/flash.c **** 
 631              		.loc 1 336 1 is_stmt 1 view .LVU131
 336:../../../mod/flash/flash.c **** 
 632              		.loc 1 336 34 is_stmt 0 view .LVU132
 633 000e A37B     		ldrb	r3, [r4, #14]	@ zero_extendqisi2
 336:../../../mod/flash/flash.c **** 
 634              		.loc 1 336 17 view .LVU133
 635 0010 43EA0005 		orr	r5, r3, r0
 636              	.LVL46:
 344:../../../mod/flash/flash.c **** 	{
 637              		.loc 1 344 1 is_stmt 1 view .LVU134
 344:../../../mod/flash/flash.c **** 	{
 638              		.loc 1 344 20 is_stmt 0 view .LVU135
 639 0014 237B     		ldrb	r3, [r4, #12]	@ zero_extendqisi2
 344:../../../mod/flash/flash.c **** 	{
 640              		.loc 1 344 4 view .LVU136
 641 0016 D3B9     		cbnz	r3, .L48
 351:../../../mod/flash/flash.c **** 	}
 642              		.loc 1 351 2 is_stmt 1 view .LVU137
 643 0018 FFF7FEFF 		bl	flash_write_enable
 644              	.LVL47:
 355:../../../mod/flash/flash.c **** if ( flash_status != FLASH_OK )
 645              		.loc 1 355 1 view .LVU138
 355:../../../mod/flash/flash.c **** if ( flash_status != FLASH_OK )
 646              		.loc 1 355 16 is_stmt 0 view .LVU139
ARM GAS  /tmp/cc2q6PEf.s 			page 35


 647 001c 2046     		mov	r0, r4
 648 001e FFF7FEFF 		bl	flash_get_status
 649              	.LVL48:
 356:../../../mod/flash/flash.c **** 	{
 650              		.loc 1 356 1 is_stmt 1 view .LVU140
 356:../../../mod/flash/flash.c **** 	{
 651              		.loc 1 356 4 is_stmt 0 view .LVU141
 652 0022 B8B9     		cbnz	r0, .L41
 360:../../../mod/flash/flash.c **** 	{
 653              		.loc 1 360 6 is_stmt 1 view .LVU142
 360:../../../mod/flash/flash.c **** 	{
 654              		.loc 1 360 25 is_stmt 0 view .LVU143
 655 0024 E37B     		ldrb	r3, [r4, #15]	@ zero_extendqisi2
 360:../../../mod/flash/flash.c **** 	{
 656              		.loc 1 360 9 view .LVU144
 657 0026 FF2B     		cmp	r3, #255
 658 0028 17D0     		beq	.L45
 366:../../../mod/flash/flash.c **** 	{
 659              		.loc 1 366 1 is_stmt 1 view .LVU145
 366:../../../mod/flash/flash.c **** 	{
 660              		.loc 1 366 6 is_stmt 0 view .LVU146
 661 002a FFF7FEFF 		bl	write_disable
 662              	.LVL49:
 366:../../../mod/flash/flash.c **** 	{
 663              		.loc 1 366 4 view .LVU147
 664 002e B0B9     		cbnz	r0, .L46
 372:../../../mod/flash/flash.c **** 
 665              		.loc 1 372 1 is_stmt 1 view .LVU148
 372:../../../mod/flash/flash.c **** 
 666              		.loc 1 372 16 is_stmt 0 view .LVU149
 667 0030 2846     		mov	r0, r5
 668 0032 FFF7FEFF 		bl	flash_set_status
 669              	.LVL50:
 375:../../../mod/flash/flash.c **** flash_status = flash_get_status( pflash_handle );
 670              		.loc 1 375 1 is_stmt 1 view .LVU150
 671              	.L43:
 375:../../../mod/flash/flash.c **** flash_status = flash_get_status( pflash_handle );
 672              		.loc 1 375 46 discriminator 1 view .LVU151
 375:../../../mod/flash/flash.c **** flash_status = flash_get_status( pflash_handle );
 673              		.loc 1 375 30 discriminator 1 view .LVU152
 375:../../../mod/flash/flash.c **** flash_status = flash_get_status( pflash_handle );
 674              		.loc 1 375 8 is_stmt 0 discriminator 1 view .LVU153
 675 0036 FFF7FEFF 		bl	flash_is_flash_busy
 676              	.LVL51:
 375:../../../mod/flash/flash.c **** flash_status = flash_get_status( pflash_handle );
 677              		.loc 1 375 30 discriminator 1 view .LVU154
 678 003a 0028     		cmp	r0, #0
 679 003c FBD1     		bne	.L43
 376:../../../mod/flash/flash.c **** if ( pflash_handle -> status_register != status_register )
 680              		.loc 1 376 1 is_stmt 1 view .LVU155
 376:../../../mod/flash/flash.c **** if ( pflash_handle -> status_register != status_register )
 681              		.loc 1 376 16 is_stmt 0 view .LVU156
 682 003e 2046     		mov	r0, r4
 683 0040 FFF7FEFF 		bl	flash_get_status
 684              	.LVL52:
 377:../../../mod/flash/flash.c **** 	{
 685              		.loc 1 377 1 is_stmt 1 view .LVU157
ARM GAS  /tmp/cc2q6PEf.s 			page 36


 377:../../../mod/flash/flash.c **** 	{
 686              		.loc 1 377 20 is_stmt 0 view .LVU158
 687 0044 E37B     		ldrb	r3, [r4, #15]	@ zero_extendqisi2
 377:../../../mod/flash/flash.c **** 	{
 688              		.loc 1 377 4 view .LVU159
 689 0046 AB42     		cmp	r3, r5
 690 0048 04D0     		beq	.L41
 379:../../../mod/flash/flash.c **** 	}
 691              		.loc 1 379 9 view .LVU160
 692 004a 0F20     		movs	r0, #15
 693              	.LVL53:
 379:../../../mod/flash/flash.c **** 	}
 694              		.loc 1 379 9 view .LVU161
 695 004c 02E0     		b	.L41
 696              	.LVL54:
 697              	.L48:
 346:../../../mod/flash/flash.c **** 	return FLASH_OK;
 698              		.loc 1 346 2 is_stmt 1 view .LVU162
 699 004e FFF7FEFF 		bl	flash_write_disable
 700              	.LVL55:
 347:../../../mod/flash/flash.c **** 	}
 701              		.loc 1 347 2 view .LVU163
 347:../../../mod/flash/flash.c **** 	}
 702              		.loc 1 347 9 is_stmt 0 view .LVU164
 703 0052 0020     		movs	r0, #0
 704              	.LVL56:
 705              	.L41:
 386:../../../mod/flash/flash.c **** 
 706              		.loc 1 386 1 view .LVU165
 707 0054 38BD     		pop	{r3, r4, r5, pc}
 708              	.LVL57:
 709              	.L44:
 331:../../../mod/flash/flash.c **** 	}
 710              		.loc 1 331 9 view .LVU166
 711 0056 0A20     		movs	r0, #10
 712 0058 FCE7     		b	.L41
 713              	.LVL58:
 714              	.L45:
 362:../../../mod/flash/flash.c **** 	}
 715              		.loc 1 362 9 view .LVU167
 716 005a 0F20     		movs	r0, #15
 717              	.LVL59:
 362:../../../mod/flash/flash.c **** 	}
 718              		.loc 1 362 9 view .LVU168
 719 005c FAE7     		b	.L41
 720              	.L46:
 368:../../../mod/flash/flash.c **** 	}
 721              		.loc 1 368 9 view .LVU169
 722 005e 0E20     		movs	r0, #14
 723 0060 F8E7     		b	.L41
 724              		.cfi_endproc
 725              	.LFE145:
 727              		.section	.text.flash_write_byte,"ax",%progbits
 728              		.align	1
 729              		.global	flash_write_byte
 730              		.syntax unified
 731              		.thumb
ARM GAS  /tmp/cc2q6PEf.s 			page 37


 732              		.thumb_func
 734              	flash_write_byte:
 735              	.LVL60:
 736              	.LFB151:
 640:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 737              		.loc 1 640 1 is_stmt 1 view -0
 738              		.cfi_startproc
 739              		@ args = 0, pretend = 0, frame = 16
 740              		@ frame_needed = 0, uses_anonymous_args = 0
 640:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 741              		.loc 1 640 1 is_stmt 0 view .LVU171
 742 0000 F0B5     		push	{r4, r5, r6, r7, lr}
 743              	.LCFI21:
 744              		.cfi_def_cfa_offset 20
 745              		.cfi_offset 4, -20
 746              		.cfi_offset 5, -16
 747              		.cfi_offset 6, -12
 748              		.cfi_offset 7, -8
 749              		.cfi_offset 14, -4
 750 0002 85B0     		sub	sp, sp, #20
 751              	.LCFI22:
 752              		.cfi_def_cfa_offset 40
 753 0004 8DF80710 		strb	r1, [sp, #7]
 644:../../../mod/flash/flash.c **** FLASH_STATUS      flash_status;     /* Status code returned by flash API      */
 754              		.loc 1 644 1 is_stmt 1 view .LVU172
 645:../../../mod/flash/flash.c **** uint8_t           flash_opcode;     /* Data to be transmitted over SPI        */
 755              		.loc 1 645 1 view .LVU173
 646:../../../mod/flash/flash.c **** uint8_t           address[3];       /* Flash memory address in byte form      */
 756              		.loc 1 646 1 view .LVU174
 647:../../../mod/flash/flash.c **** 
 757              		.loc 1 647 1 view .LVU175
 653:../../../mod/flash/flash.c **** flash_opcode  = FLASH_OP_HW_BYTE_PROGRAM;
 758              		.loc 1 653 1 view .LVU176
 759              	.LVL61:
 654:../../../mod/flash/flash.c **** address_to_bytes( pflash_handle -> address, &address[0] );
 760              		.loc 1 654 1 view .LVU177
 654:../../../mod/flash/flash.c **** address_to_bytes( pflash_handle -> address, &address[0] );
 761              		.loc 1 654 15 is_stmt 0 view .LVU178
 762 0008 0223     		movs	r3, #2
 763 000a 8DF80B30 		strb	r3, [sp, #11]
 655:../../../mod/flash/flash.c **** 
 764              		.loc 1 655 1 is_stmt 1 view .LVU179
 765 000e 02A9     		add	r1, sp, #8
 766              	.LVL62:
 655:../../../mod/flash/flash.c **** 
 767              		.loc 1 655 1 is_stmt 0 view .LVU180
 768 0010 4068     		ldr	r0, [r0, #4]
 769              	.LVL63:
 655:../../../mod/flash/flash.c **** 
 770              		.loc 1 655 1 view .LVU181
 771 0012 FFF7FEFF 		bl	address_to_bytes
 772              	.LVL64:
 663:../../../mod/flash/flash.c **** 	{
 773              		.loc 1 663 1 is_stmt 1 view .LVU182
 663:../../../mod/flash/flash.c **** 	{
 774              		.loc 1 663 5 is_stmt 0 view .LVU183
 775 0016 204B     		ldr	r3, .L56
ARM GAS  /tmp/cc2q6PEf.s 			page 38


 776 0018 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 663:../../../mod/flash/flash.c **** 	{
 777              		.loc 1 663 3 view .LVU184
 778 001a 93B3     		cbz	r3, .L51
 673:../../../mod/flash/flash.c **** if ( flash_status != FLASH_OK )
 779              		.loc 1 673 1 is_stmt 1 view .LVU185
 673:../../../mod/flash/flash.c **** if ( flash_status != FLASH_OK )
 780              		.loc 1 673 16 is_stmt 0 view .LVU186
 781 001c FFF7FEFF 		bl	write_enable
 782              	.LVL65:
 674:../../../mod/flash/flash.c **** 	{
 783              		.loc 1 674 1 is_stmt 1 view .LVU187
 674:../../../mod/flash/flash.c **** 	{
 784              		.loc 1 674 4 is_stmt 0 view .LVU188
 785 0020 98BB     		cbnz	r0, .L52
 680:../../../mod/flash/flash.c **** hal_status[0] = HAL_SPI_Transmit( &( FLASH_SPI )       ,
 786              		.loc 1 680 1 is_stmt 1 view .LVU189
 787 0022 1E4F     		ldr	r7, .L56+4
 788 0024 0022     		movs	r2, #0
 789 0026 4FF48051 		mov	r1, #4096
 790 002a 3846     		mov	r0, r7
 791              	.LVL66:
 680:../../../mod/flash/flash.c **** hal_status[0] = HAL_SPI_Transmit( &( FLASH_SPI )       ,
 792              		.loc 1 680 1 is_stmt 0 view .LVU190
 793 002c FFF7FEFF 		bl	HAL_GPIO_WritePin
 794              	.LVL67:
 681:../../../mod/flash/flash.c **** 							      &flash_opcode        ,
 795              		.loc 1 681 1 is_stmt 1 view .LVU191
 681:../../../mod/flash/flash.c **** 							      &flash_opcode        ,
 796              		.loc 1 681 17 is_stmt 0 view .LVU192
 797 0030 1B4C     		ldr	r4, .L56+8
 798 0032 0A23     		movs	r3, #10
 799 0034 0122     		movs	r2, #1
 800 0036 0DF10B01 		add	r1, sp, #11
 801 003a 2046     		mov	r0, r4
 802 003c FFF7FEFF 		bl	HAL_SPI_Transmit
 803              	.LVL68:
 804 0040 0546     		mov	r5, r0
 681:../../../mod/flash/flash.c **** 							      &flash_opcode        ,
 805              		.loc 1 681 15 view .LVU193
 806 0042 8DF80C00 		strb	r0, [sp, #12]
 687:../../../mod/flash/flash.c **** 							      &address[0]      ,
 807              		.loc 1 687 1 is_stmt 1 view .LVU194
 687:../../../mod/flash/flash.c **** 							      &address[0]      ,
 808              		.loc 1 687 17 is_stmt 0 view .LVU195
 809 0046 0A23     		movs	r3, #10
 810 0048 0322     		movs	r2, #3
 811 004a 02A9     		add	r1, sp, #8
 812 004c 2046     		mov	r0, r4
 813 004e FFF7FEFF 		bl	HAL_SPI_Transmit
 814              	.LVL69:
 815 0052 0646     		mov	r6, r0
 687:../../../mod/flash/flash.c **** 							      &address[0]      ,
 816              		.loc 1 687 15 view .LVU196
 817 0054 8DF80D00 		strb	r0, [sp, #13]
 693:../../../mod/flash/flash.c **** 							     &byte          ,
 818              		.loc 1 693 1 is_stmt 1 view .LVU197
ARM GAS  /tmp/cc2q6PEf.s 			page 39


 693:../../../mod/flash/flash.c **** 							     &byte          ,
 819              		.loc 1 693 17 is_stmt 0 view .LVU198
 820 0058 6423     		movs	r3, #100
 821 005a 0122     		movs	r2, #1
 822 005c 0DF10701 		add	r1, sp, #7
 823 0060 2046     		mov	r0, r4
 824 0062 FFF7FEFF 		bl	HAL_SPI_Transmit
 825              	.LVL70:
 826 0066 0446     		mov	r4, r0
 693:../../../mod/flash/flash.c **** 							     &byte          ,
 827              		.loc 1 693 15 view .LVU199
 828 0068 8DF80E00 		strb	r0, [sp, #14]
 697:../../../mod/flash/flash.c **** 
 829              		.loc 1 697 1 is_stmt 1 view .LVU200
 830 006c 0122     		movs	r2, #1
 831 006e 4FF48051 		mov	r1, #4096
 832 0072 3846     		mov	r0, r7
 833 0074 FFF7FEFF 		bl	HAL_GPIO_WritePin
 834              	.LVL71:
 700:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK ||
 835              		.loc 1 700 1 view .LVU201
 700:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK ||
 836              		.loc 1 700 4 is_stmt 0 view .LVU202
 837 0078 4DB9     		cbnz	r5, .L53
 700:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK ||
 838              		.loc 1 700 30 discriminator 1 view .LVU203
 839 007a 56B9     		cbnz	r6, .L54
 701:../../../mod/flash/flash.c **** 	 hal_status[2] != HAL_OK )
 840              		.loc 1 701 30 view .LVU204
 841 007c 14B1     		cbz	r4, .L50
 704:../../../mod/flash/flash.c **** 	}
 842              		.loc 1 704 9 view .LVU205
 843 007e 0824     		movs	r4, #8
 844 0080 00E0     		b	.L50
 845              	.LVL72:
 846              	.L51:
 665:../../../mod/flash/flash.c **** 	}
 847              		.loc 1 665 9 view .LVU206
 848 0082 0524     		movs	r4, #5
 849              	.LVL73:
 850              	.L50:
 711:../../../mod/flash/flash.c **** 
 851              		.loc 1 711 1 view .LVU207
 852 0084 2046     		mov	r0, r4
 853 0086 05B0     		add	sp, sp, #20
 854              	.LCFI23:
 855              		.cfi_remember_state
 856              		.cfi_def_cfa_offset 20
 857              		@ sp needed
 858 0088 F0BD     		pop	{r4, r5, r6, r7, pc}
 859              	.LVL74:
 860              	.L52:
 861              	.LCFI24:
 862              		.cfi_restore_state
 676:../../../mod/flash/flash.c **** 	}
 863              		.loc 1 676 9 view .LVU208
 864 008a 0924     		movs	r4, #9
ARM GAS  /tmp/cc2q6PEf.s 			page 40


 865 008c FAE7     		b	.L50
 866              	.LVL75:
 867              	.L53:
 704:../../../mod/flash/flash.c **** 	}
 868              		.loc 1 704 9 view .LVU209
 869 008e 0824     		movs	r4, #8
 870 0090 F8E7     		b	.L50
 871              	.L54:
 872 0092 0824     		movs	r4, #8
 873 0094 F6E7     		b	.L50
 874              	.L57:
 875 0096 00BF     		.align	2
 876              	.L56:
 877 0098 00000000 		.word	write_enabled
 878 009c 00040258 		.word	1476527104
 879 00a0 00000000 		.word	hspi2
 880              		.cfi_endproc
 881              	.LFE151:
 883              		.section	.text.flash_write,"ax",%progbits
 884              		.align	1
 885              		.global	flash_write
 886              		.syntax unified
 887              		.thumb
 888              		.thumb_func
 890              	flash_write:
 891              	.LVL76:
 892              	.LFB152:
 727:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 893              		.loc 1 727 1 is_stmt 1 view -0
 894              		.cfi_startproc
 895              		@ args = 0, pretend = 0, frame = 8
 896              		@ frame_needed = 0, uses_anonymous_args = 0
 727:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 897              		.loc 1 727 1 is_stmt 0 view .LVU211
 898 0000 2DE9F047 		push	{r4, r5, r6, r7, r8, r9, r10, lr}
 899              	.LCFI25:
 900              		.cfi_def_cfa_offset 32
 901              		.cfi_offset 4, -32
 902              		.cfi_offset 5, -28
 903              		.cfi_offset 6, -24
 904              		.cfi_offset 7, -20
 905              		.cfi_offset 8, -16
 906              		.cfi_offset 9, -12
 907              		.cfi_offset 10, -8
 908              		.cfi_offset 14, -4
 909 0004 82B0     		sub	sp, sp, #8
 910              	.LCFI26:
 911              		.cfi_def_cfa_offset 40
 912 0006 0546     		mov	r5, r0
 731:../../../mod/flash/flash.c **** FLASH_STATUS      flash_status;     /* Status codes returned by flash API     */
 913              		.loc 1 731 1 is_stmt 1 view .LVU212
 732:../../../mod/flash/flash.c **** uint8_t           flash_opcode;     /* Opcode for flash instructions          */
 914              		.loc 1 732 1 view .LVU213
 733:../../../mod/flash/flash.c **** uint32_t          timeout;          /* Timeout for flash write calls          */
 915              		.loc 1 733 1 view .LVU214
 734:../../../mod/flash/flash.c **** uint32_t          timeout_ctr;      /* Counter to trigger timeout             */
 916              		.loc 1 734 1 view .LVU215
ARM GAS  /tmp/cc2q6PEf.s 			page 41


 735:../../../mod/flash/flash.c **** uint8_t*          pbuffer;          /* Pointer to data in flash buffer        */
 917              		.loc 1 735 1 view .LVU216
 736:../../../mod/flash/flash.c **** uint8_t           address_bytes[3]; /* Flash memory address in byte form      */
 918              		.loc 1 736 1 view .LVU217
 737:../../../mod/flash/flash.c **** 
 919              		.loc 1 737 1 view .LVU218
 743:../../../mod/flash/flash.c **** flash_status  = FLASH_OK;
 920              		.loc 1 743 1 view .LVU219
 743:../../../mod/flash/flash.c **** flash_status  = FLASH_OK;
 921              		.loc 1 743 15 is_stmt 0 view .LVU220
 922 0008 AD23     		movs	r3, #173
 923 000a 8DF80330 		strb	r3, [sp, #3]
 744:../../../mod/flash/flash.c **** timeout       = 100;
 924              		.loc 1 744 1 is_stmt 1 view .LVU221
 925              	.LVL77:
 745:../../../mod/flash/flash.c **** timeout_ctr   = 0;
 926              		.loc 1 745 1 view .LVU222
 746:../../../mod/flash/flash.c **** pbuffer       = pflash_handle -> pbuffer;
 927              		.loc 1 746 1 view .LVU223
 747:../../../mod/flash/flash.c **** address_to_bytes( pflash_handle -> address, &address_bytes[0] );
 928              		.loc 1 747 1 view .LVU224
 747:../../../mod/flash/flash.c **** address_to_bytes( pflash_handle -> address, &address_bytes[0] );
 929              		.loc 1 747 15 is_stmt 0 view .LVU225
 930 000e 8668     		ldr	r6, [r0, #8]
 931              	.LVL78:
 748:../../../mod/flash/flash.c **** 
 932              		.loc 1 748 1 is_stmt 1 view .LVU226
 933 0010 6946     		mov	r1, sp
 934 0012 4068     		ldr	r0, [r0, #4]
 935              	.LVL79:
 748:../../../mod/flash/flash.c **** 
 936              		.loc 1 748 1 is_stmt 0 view .LVU227
 937 0014 FFF7FEFF 		bl	address_to_bytes
 938              	.LVL80:
 756:../../../mod/flash/flash.c **** 	{
 939              		.loc 1 756 1 is_stmt 1 view .LVU228
 756:../../../mod/flash/flash.c **** 	{
 940              		.loc 1 756 5 is_stmt 0 view .LVU229
 941 0018 564B     		ldr	r3, .L80
 942 001a 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 756:../../../mod/flash/flash.c **** 	{
 943              		.loc 1 756 3 view .LVU230
 944 001c 002B     		cmp	r3, #0
 945 001e 00F09280 		beq	.L67
 762:../../../mod/flash/flash.c **** 	{
 946              		.loc 1 762 1 is_stmt 1 view .LVU231
 762:../../../mod/flash/flash.c **** 	{
 947              		.loc 1 762 25 is_stmt 0 view .LVU232
 948 0022 2B78     		ldrb	r3, [r5]	@ zero_extendqisi2
 762:../../../mod/flash/flash.c **** 	{
 949              		.loc 1 762 9 view .LVU233
 950 0024 012B     		cmp	r3, #1
 951 0026 4AD0     		beq	.L78
 766:../../../mod/flash/flash.c **** 	{
 952              		.loc 1 766 6 is_stmt 1 view .LVU234
 766:../../../mod/flash/flash.c **** 	{
 953              		.loc 1 766 9 is_stmt 0 view .LVU235
ARM GAS  /tmp/cc2q6PEf.s 			page 42


 954 0028 002B     		cmp	r3, #0
 955 002a 00F08E80 		beq	.L68
 777:../../../mod/flash/flash.c **** if ( flash_status != FLASH_OK )
 956              		.loc 1 777 1 is_stmt 1 view .LVU236
 777:../../../mod/flash/flash.c **** if ( flash_status != FLASH_OK )
 957              		.loc 1 777 16 is_stmt 0 view .LVU237
 958 002e FFF7FEFF 		bl	write_enable
 959              	.LVL81:
 778:../../../mod/flash/flash.c **** 	{
 960              		.loc 1 778 1 is_stmt 1 view .LVU238
 778:../../../mod/flash/flash.c **** 	{
 961              		.loc 1 778 4 is_stmt 0 view .LVU239
 962 0032 0028     		cmp	r0, #0
 963 0034 40F08D80 		bne	.L69
 784:../../../mod/flash/flash.c **** hal_status[0] = HAL_SPI_Transmit( &( FLASH_SPI )        ,
 964              		.loc 1 784 1 is_stmt 1 view .LVU240
 965 0038 DFF83C91 		ldr	r9, .L80+4
 966 003c 0022     		movs	r2, #0
 967 003e 4FF48051 		mov	r1, #4096
 968 0042 4846     		mov	r0, r9
 969              	.LVL82:
 784:../../../mod/flash/flash.c **** hal_status[0] = HAL_SPI_Transmit( &( FLASH_SPI )        ,
 970              		.loc 1 784 1 is_stmt 0 view .LVU241
 971 0044 FFF7FEFF 		bl	HAL_GPIO_WritePin
 972              	.LVL83:
 785:../../../mod/flash/flash.c **** 							      &flash_opcode         ,
 973              		.loc 1 785 1 is_stmt 1 view .LVU242
 785:../../../mod/flash/flash.c **** 							      &flash_opcode         ,
 974              		.loc 1 785 17 is_stmt 0 view .LVU243
 975 0048 DFF83081 		ldr	r8, .L80+8
 976 004c 0A23     		movs	r3, #10
 977 004e 0122     		movs	r2, #1
 978 0050 0DF10301 		add	r1, sp, #3
 979 0054 4046     		mov	r0, r8
 980 0056 FFF7FEFF 		bl	HAL_SPI_Transmit
 981              	.LVL84:
 982 005a 0446     		mov	r4, r0
 785:../../../mod/flash/flash.c **** 							      &flash_opcode         ,
 983              		.loc 1 785 15 view .LVU244
 984 005c 8DF80400 		strb	r0, [sp, #4]
 789:../../../mod/flash/flash.c **** 							      &address_bytes[0]      ,
 985              		.loc 1 789 1 is_stmt 1 view .LVU245
 789:../../../mod/flash/flash.c **** 							      &address_bytes[0]      ,
 986              		.loc 1 789 17 is_stmt 0 view .LVU246
 987 0060 0A23     		movs	r3, #10
 988 0062 0322     		movs	r2, #3
 989 0064 6946     		mov	r1, sp
 990 0066 4046     		mov	r0, r8
 991 0068 FFF7FEFF 		bl	HAL_SPI_Transmit
 992              	.LVL85:
 993 006c 0746     		mov	r7, r0
 789:../../../mod/flash/flash.c **** 							      &address_bytes[0]      ,
 994              		.loc 1 789 15 view .LVU247
 995 006e 8DF80500 		strb	r0, [sp, #5]
 793:../../../mod/flash/flash.c ****                                   pbuffer       ,
 996              		.loc 1 793 1 is_stmt 1 view .LVU248
 793:../../../mod/flash/flash.c ****                                   pbuffer       ,
ARM GAS  /tmp/cc2q6PEf.s 			page 43


 997              		.loc 1 793 17 is_stmt 0 view .LVU249
 998 0072 0A23     		movs	r3, #10
 999 0074 0222     		movs	r2, #2
 1000 0076 3146     		mov	r1, r6
 1001 0078 4046     		mov	r0, r8
 1002 007a FFF7FEFF 		bl	HAL_SPI_Transmit
 1003              	.LVL86:
 1004 007e 8046     		mov	r8, r0
 793:../../../mod/flash/flash.c ****                                   pbuffer       ,
 1005              		.loc 1 793 15 view .LVU250
 1006 0080 8DF80600 		strb	r0, [sp, #6]
 797:../../../mod/flash/flash.c **** 
 1007              		.loc 1 797 1 is_stmt 1 view .LVU251
 1008 0084 0122     		movs	r2, #1
 1009 0086 4FF48051 		mov	r1, #4096
 1010 008a 4846     		mov	r0, r9
 1011 008c FFF7FEFF 		bl	HAL_GPIO_WritePin
 1012              	.LVL87:
 800:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK ||
 1013              		.loc 1 800 1 view .LVU252
 800:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK ||
 1014              		.loc 1 800 4 is_stmt 0 view .LVU253
 1015 0090 002C     		cmp	r4, #0
 1016 0092 60D1     		bne	.L70
 800:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK ||
 1017              		.loc 1 800 30 discriminator 1 view .LVU254
 1018 0094 002F     		cmp	r7, #0
 1019 0096 60D1     		bne	.L71
 801:../../../mod/flash/flash.c **** 	 hal_status[2] != HAL_OK )
 1020              		.loc 1 801 30 view .LVU255
 1021 0098 B8F1000F 		cmp	r8, #0
 1022 009c 5FD1     		bne	.L72
 1023              	.LBB7:
 808:../../../mod/flash/flash.c **** 	{
 1024              		.loc 1 808 11 view .LVU256
 1025 009e 4FF00209 		mov	r9, #2
 1026              	.LVL88:
 1027              	.L61:
 808:../../../mod/flash/flash.c **** 	{
 1028              		.loc 1 808 20 is_stmt 1 discriminator 1 view .LVU257
 808:../../../mod/flash/flash.c **** 	{
 1029              		.loc 1 808 36 is_stmt 0 discriminator 1 view .LVU258
 1030 00a2 2B78     		ldrb	r3, [r5]	@ zero_extendqisi2
 808:../../../mod/flash/flash.c **** 	{
 1031              		.loc 1 808 20 discriminator 1 view .LVU259
 1032 00a4 4B45     		cmp	r3, r9
 1033 00a6 3ADD     		ble	.L65
 811:../../../mod/flash/flash.c **** 
 1034              		.loc 1 811 2 is_stmt 1 view .LVU260
 811:../../../mod/flash/flash.c **** 
 1035              		.loc 1 811 10 is_stmt 0 view .LVU261
 1036 00a8 0236     		adds	r6, r6, #2
 1037              	.LVL89:
 814:../../../mod/flash/flash.c **** 		{
 1038              		.loc 1 814 2 is_stmt 1 view .LVU262
 1039              	.L62:
 814:../../../mod/flash/flash.c **** 		{
ARM GAS  /tmp/cc2q6PEf.s 			page 44


 1040              		.loc 1 814 31 view .LVU263
 814:../../../mod/flash/flash.c **** 		{
 1041              		.loc 1 814 9 is_stmt 0 view .LVU264
 1042 00aa FFF7FEFF 		bl	flash_is_flash_busy
 1043              	.LVL90:
 814:../../../mod/flash/flash.c **** 		{
 1044              		.loc 1 814 31 view .LVU265
 1045 00ae 60B1     		cbz	r0, .L79
 816:../../../mod/flash/flash.c **** 			{
 1046              		.loc 1 816 3 is_stmt 1 view .LVU266
 816:../../../mod/flash/flash.c **** 			{
 1047              		.loc 1 816 6 is_stmt 0 view .LVU267
 1048 00b0 632C     		cmp	r4, #99
 1049 00b2 56D8     		bhi	.L73
 822:../../../mod/flash/flash.c **** 			HAL_Delay( 1 );
 1050              		.loc 1 822 4 is_stmt 1 view .LVU268
 822:../../../mod/flash/flash.c **** 			HAL_Delay( 1 );
 1051              		.loc 1 822 15 is_stmt 0 view .LVU269
 1052 00b4 0134     		adds	r4, r4, #1
 1053              	.LVL91:
 823:../../../mod/flash/flash.c **** 			}
 1054              		.loc 1 823 4 is_stmt 1 view .LVU270
 1055 00b6 0120     		movs	r0, #1
 1056 00b8 FFF7FEFF 		bl	HAL_Delay
 1057              	.LVL92:
 1058 00bc F5E7     		b	.L62
 1059              	.LVL93:
 1060              	.L78:
 823:../../../mod/flash/flash.c **** 			}
 1061              		.loc 1 823 4 is_stmt 0 view .LVU271
 1062              	.LBE7:
 764:../../../mod/flash/flash.c **** 	}
 1063              		.loc 1 764 2 is_stmt 1 view .LVU272
 764:../../../mod/flash/flash.c **** 	}
 1064              		.loc 1 764 59 is_stmt 0 view .LVU273
 1065 00be AB68     		ldr	r3, [r5, #8]
 764:../../../mod/flash/flash.c **** 	}
 1066              		.loc 1 764 9 view .LVU274
 1067 00c0 1978     		ldrb	r1, [r3]	@ zero_extendqisi2
 1068 00c2 2846     		mov	r0, r5
 1069 00c4 FFF7FEFF 		bl	flash_write_byte
 1070              	.LVL94:
 1071 00c8 40E0     		b	.L59
 1072              	.LVL95:
 1073              	.L79:
 1074              	.LBB8:
 828:../../../mod/flash/flash.c **** 	hal_status[0] = HAL_SPI_Transmit( &( FLASH_SPI )        ,
 1075              		.loc 1 828 2 is_stmt 1 view .LVU275
 1076 00ca DFF8ACA0 		ldr	r10, .L80+4
 1077 00ce 0022     		movs	r2, #0
 1078 00d0 4FF48051 		mov	r1, #4096
 1079 00d4 5046     		mov	r0, r10
 1080 00d6 FFF7FEFF 		bl	HAL_GPIO_WritePin
 1081              	.LVL96:
 829:../../../mod/flash/flash.c **** 									&flash_opcode         ,
 1082              		.loc 1 829 2 view .LVU276
 829:../../../mod/flash/flash.c **** 									&flash_opcode         ,
ARM GAS  /tmp/cc2q6PEf.s 			page 45


 1083              		.loc 1 829 18 is_stmt 0 view .LVU277
 1084 00da DFF8A080 		ldr	r8, .L80+8
 1085 00de 0A23     		movs	r3, #10
 1086 00e0 0122     		movs	r2, #1
 1087 00e2 0DF10301 		add	r1, sp, #3
 1088 00e6 4046     		mov	r0, r8
 1089 00e8 FFF7FEFF 		bl	HAL_SPI_Transmit
 1090              	.LVL97:
 1091 00ec 0746     		mov	r7, r0
 829:../../../mod/flash/flash.c **** 									&flash_opcode         ,
 1092              		.loc 1 829 16 view .LVU278
 1093 00ee 8DF80400 		strb	r0, [sp, #4]
 833:../../../mod/flash/flash.c **** 									pbuffer       ,
 1094              		.loc 1 833 2 is_stmt 1 view .LVU279
 833:../../../mod/flash/flash.c **** 									pbuffer       ,
 1095              		.loc 1 833 18 is_stmt 0 view .LVU280
 1096 00f2 0A23     		movs	r3, #10
 1097 00f4 0222     		movs	r2, #2
 1098 00f6 3146     		mov	r1, r6
 1099 00f8 4046     		mov	r0, r8
 1100 00fa FFF7FEFF 		bl	HAL_SPI_Transmit
 1101              	.LVL98:
 1102 00fe 8046     		mov	r8, r0
 833:../../../mod/flash/flash.c **** 									pbuffer       ,
 1103              		.loc 1 833 16 view .LVU281
 1104 0100 8DF80500 		strb	r0, [sp, #5]
 837:../../../mod/flash/flash.c **** 
 1105              		.loc 1 837 2 is_stmt 1 view .LVU282
 1106 0104 0122     		movs	r2, #1
 1107 0106 4FF48051 		mov	r1, #4096
 1108 010a 5046     		mov	r0, r10
 1109 010c FFF7FEFF 		bl	HAL_GPIO_WritePin
 1110              	.LVL99:
 840:../../../mod/flash/flash.c **** 		{
 1111              		.loc 1 840 2 view .LVU283
 840:../../../mod/flash/flash.c **** 		{
 1112              		.loc 1 840 5 is_stmt 0 view .LVU284
 1113 0110 4FBB     		cbnz	r7, .L74
 840:../../../mod/flash/flash.c **** 		{
 1114              		.loc 1 840 31 discriminator 1 view .LVU285
 1115 0112 B8F1000F 		cmp	r8, #0
 1116 0116 28D1     		bne	.L75
 808:../../../mod/flash/flash.c **** 	{
 1117              		.loc 1 808 52 is_stmt 1 discriminator 2 view .LVU286
 1118 0118 09F10209 		add	r9, r9, #2
 1119              	.LVL100:
 808:../../../mod/flash/flash.c **** 	{
 1120              		.loc 1 808 52 is_stmt 0 discriminator 2 view .LVU287
 1121 011c C1E7     		b	.L61
 1122              	.L65:
 808:../../../mod/flash/flash.c **** 	{
 1123              		.loc 1 808 52 discriminator 2 view .LVU288
 1124              	.LBE8:
 847:../../../mod/flash/flash.c **** 
 1125              		.loc 1 847 47 is_stmt 1 discriminator 1 view .LVU289
 847:../../../mod/flash/flash.c **** 
 1126              		.loc 1 847 31 discriminator 1 view .LVU290
ARM GAS  /tmp/cc2q6PEf.s 			page 46


 847:../../../mod/flash/flash.c **** 
 1127              		.loc 1 847 9 is_stmt 0 discriminator 1 view .LVU291
 1128 011e FFF7FEFF 		bl	flash_is_flash_busy
 1129              	.LVL101:
 847:../../../mod/flash/flash.c **** 
 1130              		.loc 1 847 31 discriminator 1 view .LVU292
 1131 0122 0028     		cmp	r0, #0
 1132 0124 FBD1     		bne	.L65
 850:../../../mod/flash/flash.c **** if ( flash_status != FLASH_OK )
 1133              		.loc 1 850 1 is_stmt 1 view .LVU293
 850:../../../mod/flash/flash.c **** if ( flash_status != FLASH_OK )
 1134              		.loc 1 850 16 is_stmt 0 view .LVU294
 1135 0126 FFF7FEFF 		bl	write_disable
 1136              	.LVL102:
 851:../../../mod/flash/flash.c **** 	{
 1137              		.loc 1 851 1 is_stmt 1 view .LVU295
 851:../../../mod/flash/flash.c **** 	{
 1138              		.loc 1 851 4 is_stmt 0 view .LVU296
 1139 012a 00BB     		cbnz	r0, .L76
 1140              	.LVL103:
 1141              	.L66:
 857:../../../mod/flash/flash.c **** 
 1142              		.loc 1 857 47 is_stmt 1 discriminator 1 view .LVU297
 857:../../../mod/flash/flash.c **** 
 1143              		.loc 1 857 31 discriminator 1 view .LVU298
 857:../../../mod/flash/flash.c **** 
 1144              		.loc 1 857 9 is_stmt 0 discriminator 1 view .LVU299
 1145 012c FFF7FEFF 		bl	flash_is_flash_busy
 1146              	.LVL104:
 857:../../../mod/flash/flash.c **** 
 1147              		.loc 1 857 31 discriminator 1 view .LVU300
 1148 0130 0028     		cmp	r0, #0
 1149 0132 FBD1     		bne	.L66
 860:../../../mod/flash/flash.c **** 	{
 1150              		.loc 1 860 1 is_stmt 1 view .LVU301
 860:../../../mod/flash/flash.c **** 	{
 1151              		.loc 1 860 22 is_stmt 0 view .LVU302
 1152 0134 2878     		ldrb	r0, [r5]	@ zero_extendqisi2
 860:../../../mod/flash/flash.c **** 	{
 1153              		.loc 1 860 4 view .LVU303
 1154 0136 10F00100 		ands	r0, r0, #1
 1155 013a 07D0     		beq	.L59
 862:../../../mod/flash/flash.c **** 	return flash_write_byte( pflash_handle, *pbuffer );
 1156              		.loc 1 862 2 is_stmt 1 view .LVU304
 1157              	.LVL105:
 863:../../../mod/flash/flash.c **** 	}
 1158              		.loc 1 863 2 view .LVU305
 863:../../../mod/flash/flash.c **** 	}
 1159              		.loc 1 863 9 is_stmt 0 view .LVU306
 1160 013c 7178     		ldrb	r1, [r6, #1]	@ zero_extendqisi2
 1161 013e 2846     		mov	r0, r5
 1162 0140 FFF7FEFF 		bl	flash_write_byte
 1163              	.LVL106:
 1164 0144 02E0     		b	.L59
 1165              	.LVL107:
 1166              	.L67:
 758:../../../mod/flash/flash.c **** 	}
ARM GAS  /tmp/cc2q6PEf.s 			page 47


 1167              		.loc 1 758 9 view .LVU307
 1168 0146 0520     		movs	r0, #5
 1169 0148 00E0     		b	.L59
 1170              	.L68:
 768:../../../mod/flash/flash.c **** 	}
 1171              		.loc 1 768 9 view .LVU308
 1172 014a 0C20     		movs	r0, #12
 1173              	.LVL108:
 1174              	.L59:
 871:../../../mod/flash/flash.c **** 
 1175              		.loc 1 871 1 view .LVU309
 1176 014c 02B0     		add	sp, sp, #8
 1177              	.LCFI27:
 1178              		.cfi_remember_state
 1179              		.cfi_def_cfa_offset 32
 1180              		@ sp needed
 1181 014e BDE8F087 		pop	{r4, r5, r6, r7, r8, r9, r10, pc}
 1182              	.LVL109:
 1183              	.L69:
 1184              	.LCFI28:
 1185              		.cfi_restore_state
 780:../../../mod/flash/flash.c **** 	}
 1186              		.loc 1 780 9 view .LVU310
 1187 0152 0920     		movs	r0, #9
 1188              	.LVL110:
 780:../../../mod/flash/flash.c **** 	}
 1189              		.loc 1 780 9 view .LVU311
 1190 0154 FAE7     		b	.L59
 1191              	.L70:
 804:../../../mod/flash/flash.c **** 	}
 1192              		.loc 1 804 9 view .LVU312
 1193 0156 0820     		movs	r0, #8
 1194 0158 F8E7     		b	.L59
 1195              	.L71:
 1196 015a 0820     		movs	r0, #8
 1197 015c F6E7     		b	.L59
 1198              	.L72:
 1199 015e 0820     		movs	r0, #8
 1200 0160 F4E7     		b	.L59
 1201              	.LVL111:
 1202              	.L73:
 1203              	.LBB9:
 818:../../../mod/flash/flash.c **** 			}
 1204              		.loc 1 818 11 view .LVU313
 1205 0162 0420     		movs	r0, #4
 1206 0164 F2E7     		b	.L59
 1207              	.L74:
 842:../../../mod/flash/flash.c **** 		}
 1208              		.loc 1 842 10 view .LVU314
 1209 0166 0B20     		movs	r0, #11
 1210 0168 F0E7     		b	.L59
 1211              	.L75:
 1212 016a 0B20     		movs	r0, #11
 1213 016c EEE7     		b	.L59
 1214              	.LVL112:
 1215              	.L76:
 842:../../../mod/flash/flash.c **** 		}
ARM GAS  /tmp/cc2q6PEf.s 			page 48


 1216              		.loc 1 842 10 view .LVU315
 1217              	.LBE9:
 853:../../../mod/flash/flash.c **** 	}
 1218              		.loc 1 853 9 view .LVU316
 1219 016e 0D20     		movs	r0, #13
 1220              	.LVL113:
 853:../../../mod/flash/flash.c **** 	}
 1221              		.loc 1 853 9 view .LVU317
 1222 0170 ECE7     		b	.L59
 1223              	.L81:
 1224 0172 00BF     		.align	2
 1225              	.L80:
 1226 0174 00000000 		.word	write_enabled
 1227 0178 00040258 		.word	1476527104
 1228 017c 00000000 		.word	hspi2
 1229              		.cfi_endproc
 1230              	.LFE152:
 1232              		.section	.text.flash_read,"ax",%progbits
 1233              		.align	1
 1234              		.global	flash_read
 1235              		.syntax unified
 1236              		.thumb
 1237              		.thumb_func
 1239              	flash_read:
 1240              	.LVL114:
 1241              	.LFB153:
 888:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 1242              		.loc 1 888 1 is_stmt 1 view -0
 1243              		.cfi_startproc
 1244              		@ args = 0, pretend = 0, frame = 16
 1245              		@ frame_needed = 0, uses_anonymous_args = 0
 888:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 1246              		.loc 1 888 1 is_stmt 0 view .LVU319
 1247 0000 2DE9F041 		push	{r4, r5, r6, r7, r8, lr}
 1248              	.LCFI29:
 1249              		.cfi_def_cfa_offset 24
 1250              		.cfi_offset 4, -24
 1251              		.cfi_offset 5, -20
 1252              		.cfi_offset 6, -16
 1253              		.cfi_offset 7, -12
 1254              		.cfi_offset 8, -8
 1255              		.cfi_offset 14, -4
 1256 0004 84B0     		sub	sp, sp, #16
 1257              	.LCFI30:
 1258              		.cfi_def_cfa_offset 40
 1259 0006 0546     		mov	r5, r0
 1260 0008 0E46     		mov	r6, r1
 892:../../../mod/flash/flash.c **** uint8_t           flash_opcode;  /* Data to be transmitted over SPI           */
 1261              		.loc 1 892 1 is_stmt 1 view .LVU320
 893:../../../mod/flash/flash.c **** uint8_t           address[3];    /* Flash address in byte format              */
 1262              		.loc 1 893 1 view .LVU321
 894:../../../mod/flash/flash.c **** uint8_t*          pbuffer;       /* Pointer to position in output buffer      */
 1263              		.loc 1 894 1 view .LVU322
 895:../../../mod/flash/flash.c **** uint8_t           dummy_byte;    /* Dummy byte needed for high speed read     */
 1264              		.loc 1 895 1 view .LVU323
 896:../../../mod/flash/flash.c **** 
 1265              		.loc 1 896 1 view .LVU324
ARM GAS  /tmp/cc2q6PEf.s 			page 49


 902:../../../mod/flash/flash.c **** dummy_byte   = 0;
 1266              		.loc 1 902 1 view .LVU325
 902:../../../mod/flash/flash.c **** dummy_byte   = 0;
 1267              		.loc 1 902 14 is_stmt 0 view .LVU326
 1268 000a 0B23     		movs	r3, #11
 1269 000c 8DF80B30 		strb	r3, [sp, #11]
 903:../../../mod/flash/flash.c **** address_to_bytes( pflash_handle -> address, &address[0] );
 1270              		.loc 1 903 1 is_stmt 1 view .LVU327
 903:../../../mod/flash/flash.c **** address_to_bytes( pflash_handle -> address, &address[0] );
 1271              		.loc 1 903 14 is_stmt 0 view .LVU328
 1272 0010 0024     		movs	r4, #0
 1273 0012 8DF80740 		strb	r4, [sp, #7]
 904:../../../mod/flash/flash.c **** 
 1274              		.loc 1 904 1 is_stmt 1 view .LVU329
 1275 0016 02A9     		add	r1, sp, #8
 1276              	.LVL115:
 904:../../../mod/flash/flash.c **** 
 1277              		.loc 1 904 1 is_stmt 0 view .LVU330
 1278 0018 4068     		ldr	r0, [r0, #4]
 1279              	.LVL116:
 904:../../../mod/flash/flash.c **** 
 1280              		.loc 1 904 1 view .LVU331
 1281 001a FFF7FEFF 		bl	address_to_bytes
 1282              	.LVL117:
 912:../../../mod/flash/flash.c **** 
 1283              		.loc 1 912 1 is_stmt 1 view .LVU332
 1284 001e 2246     		mov	r2, r4
 1285 0020 4FF48051 		mov	r1, #4096
 1286 0024 2248     		ldr	r0, .L92
 1287 0026 FFF7FEFF 		bl	HAL_GPIO_WritePin
 1288              	.LVL118:
 915:../../../mod/flash/flash.c **** 							      &flash_opcode         ,
 1289              		.loc 1 915 1 view .LVU333
 915:../../../mod/flash/flash.c **** 							      &flash_opcode         ,
 1290              		.loc 1 915 17 is_stmt 0 view .LVU334
 1291 002a 224F     		ldr	r7, .L92+4
 1292 002c 0A23     		movs	r3, #10
 1293 002e 0122     		movs	r2, #1
 1294 0030 0DF10B01 		add	r1, sp, #11
 1295 0034 3846     		mov	r0, r7
 1296 0036 FFF7FEFF 		bl	HAL_SPI_Transmit
 1297              	.LVL119:
 1298 003a 0446     		mov	r4, r0
 915:../../../mod/flash/flash.c **** 							      &flash_opcode         ,
 1299              		.loc 1 915 15 view .LVU335
 1300 003c 8DF80C00 		strb	r0, [sp, #12]
 921:../../../mod/flash/flash.c **** 							      &( address[0] )  ,
 1301              		.loc 1 921 1 is_stmt 1 view .LVU336
 921:../../../mod/flash/flash.c **** 							      &( address[0] )  ,
 1302              		.loc 1 921 17 is_stmt 0 view .LVU337
 1303 0040 0A23     		movs	r3, #10
 1304 0042 0322     		movs	r2, #3
 1305 0044 02A9     		add	r1, sp, #8
 1306 0046 3846     		mov	r0, r7
 1307 0048 FFF7FEFF 		bl	HAL_SPI_Transmit
 1308              	.LVL120:
 1309 004c 8046     		mov	r8, r0
ARM GAS  /tmp/cc2q6PEf.s 			page 50


 921:../../../mod/flash/flash.c **** 							      &( address[0] )  ,
 1310              		.loc 1 921 15 view .LVU338
 1311 004e 8DF80D00 		strb	r0, [sp, #13]
 927:../../../mod/flash/flash.c **** 							      &( dummy_byte )  ,
 1312              		.loc 1 927 1 is_stmt 1 view .LVU339
 927:../../../mod/flash/flash.c **** 							      &( dummy_byte )  ,
 1313              		.loc 1 927 17 is_stmt 0 view .LVU340
 1314 0052 0A23     		movs	r3, #10
 1315 0054 0122     		movs	r2, #1
 1316 0056 0DF10701 		add	r1, sp, #7
 1317 005a 3846     		mov	r0, r7
 1318 005c FFF7FEFF 		bl	HAL_SPI_Transmit
 1319              	.LVL121:
 927:../../../mod/flash/flash.c **** 							      &( dummy_byte )  ,
 1320              		.loc 1 927 15 view .LVU341
 1321 0060 8DF80E00 		strb	r0, [sp, #14]
 933:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK || 
 1322              		.loc 1 933 1 is_stmt 1 view .LVU342
 933:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK || 
 1323              		.loc 1 933 4 is_stmt 0 view .LVU343
 1324 0064 E4B9     		cbnz	r4, .L86
 1325 0066 0746     		mov	r7, r0
 933:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK || 
 1326              		.loc 1 933 30 discriminator 1 view .LVU344
 1327 0068 B8F1000F 		cmp	r8, #0
 1328 006c 1AD1     		bne	.L87
 934:../../../mod/flash/flash.c **** 	 hal_status[2] != HAL_OK )
 1329              		.loc 1 934 30 view .LVU345
 1330 006e D8B9     		cbnz	r0, .L88
 1331              	.L84:
 1332              	.LVL122:
 1333              	.LBB10:
 941:../../../mod/flash/flash.c **** 	{
 1334              		.loc 1 941 20 is_stmt 1 discriminator 1 view .LVU346
 1335 0070 B442     		cmp	r4, r6
 1336 0072 0BD2     		bcs	.L91
 943:../../../mod/flash/flash.c **** 	hal_status[3] = HAL_SPI_Receive( &( FLASH_SPI )      ,
 1337              		.loc 1 943 2 view .LVU347
 943:../../../mod/flash/flash.c **** 	hal_status[3] = HAL_SPI_Receive( &( FLASH_SPI )      ,
 1338              		.loc 1 943 28 is_stmt 0 view .LVU348
 1339 0074 A968     		ldr	r1, [r5, #8]
 1340              	.LVL123:
 944:../../../mod/flash/flash.c **** 								     pbuffer             ,
 1341              		.loc 1 944 2 is_stmt 1 view .LVU349
 944:../../../mod/flash/flash.c **** 								     pbuffer             ,
 1342              		.loc 1 944 18 is_stmt 0 view .LVU350
 1343 0076 0A23     		movs	r3, #10
 1344 0078 0122     		movs	r2, #1
 1345 007a 2144     		add	r1, r1, r4
 1346              	.LVL124:
 944:../../../mod/flash/flash.c **** 								     pbuffer             ,
 1347              		.loc 1 944 18 view .LVU351
 1348 007c 0D48     		ldr	r0, .L92+4
 1349 007e FFF7FEFF 		bl	HAL_SPI_Receive
 1350              	.LVL125:
 944:../../../mod/flash/flash.c **** 								     pbuffer             ,
 1351              		.loc 1 944 16 view .LVU352
ARM GAS  /tmp/cc2q6PEf.s 			page 51


 1352 0082 8DF80F00 		strb	r0, [sp, #15]
 949:../../../mod/flash/flash.c **** 		{
 1353              		.loc 1 949 2 is_stmt 1 view .LVU353
 949:../../../mod/flash/flash.c **** 		{
 1354              		.loc 1 949 5 is_stmt 0 view .LVU354
 1355 0086 88B9     		cbnz	r0, .L89
 941:../../../mod/flash/flash.c **** 	{
 1356              		.loc 1 941 33 is_stmt 1 discriminator 2 view .LVU355
 1357 0088 0134     		adds	r4, r4, #1
 1358              	.LVL126:
 941:../../../mod/flash/flash.c **** 	{
 1359              		.loc 1 941 33 is_stmt 0 discriminator 2 view .LVU356
 1360 008a F1E7     		b	.L84
 1361              	.LVL127:
 1362              	.L91:
 941:../../../mod/flash/flash.c **** 	{
 1363              		.loc 1 941 33 discriminator 2 view .LVU357
 1364              	.LBE10:
 956:../../../mod/flash/flash.c **** 
 1365              		.loc 1 956 1 is_stmt 1 view .LVU358
 1366 008c 0122     		movs	r2, #1
 1367 008e 4FF48051 		mov	r1, #4096
 1368 0092 0748     		ldr	r0, .L92
 1369 0094 FFF7FEFF 		bl	HAL_GPIO_WritePin
 1370              	.LVL128:
 959:../../../mod/flash/flash.c **** 
 1371              		.loc 1 959 1 view .LVU359
 1372              	.L83:
 961:../../../mod/flash/flash.c **** 
 1373              		.loc 1 961 1 is_stmt 0 view .LVU360
 1374 0098 3846     		mov	r0, r7
 1375 009a 04B0     		add	sp, sp, #16
 1376              	.LCFI31:
 1377              		.cfi_remember_state
 1378              		.cfi_def_cfa_offset 24
 1379              		@ sp needed
 1380 009c BDE8F081 		pop	{r4, r5, r6, r7, r8, pc}
 1381              	.LVL129:
 1382              	.L86:
 1383              	.LCFI32:
 1384              		.cfi_restore_state
 937:../../../mod/flash/flash.c **** 	}
 1385              		.loc 1 937 9 view .LVU361
 1386 00a0 0827     		movs	r7, #8
 1387 00a2 F9E7     		b	.L83
 1388              	.L87:
 1389 00a4 0827     		movs	r7, #8
 1390 00a6 F7E7     		b	.L83
 1391              	.L88:
 1392 00a8 0827     		movs	r7, #8
 1393 00aa F5E7     		b	.L83
 1394              	.LVL130:
 1395              	.L89:
 1396              	.LBB11:
 951:../../../mod/flash/flash.c **** 		}
 1397              		.loc 1 951 10 view .LVU362
 1398 00ac 0827     		movs	r7, #8
ARM GAS  /tmp/cc2q6PEf.s 			page 52


 1399 00ae F3E7     		b	.L83
 1400              	.L93:
 1401              		.align	2
 1402              	.L92:
 1403 00b0 00040258 		.word	1476527104
 1404 00b4 00000000 		.word	hspi2
 1405              	.LBE11:
 1406              		.cfi_endproc
 1407              	.LFE153:
 1409              		.section	.text.flash_erase,"ax",%progbits
 1410              		.align	1
 1411              		.global	flash_erase
 1412              		.syntax unified
 1413              		.thumb
 1414              		.thumb_func
 1416              	flash_erase:
 1417              	.LVL131:
 1418              	.LFB154:
 977:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 1419              		.loc 1 977 1 is_stmt 1 view -0
 1420              		.cfi_startproc
 1421              		@ args = 0, pretend = 0, frame = 8
 1422              		@ frame_needed = 0, uses_anonymous_args = 0
 977:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 1423              		.loc 1 977 1 is_stmt 0 view .LVU364
 1424 0000 70B5     		push	{r4, r5, r6, lr}
 1425              	.LCFI33:
 1426              		.cfi_def_cfa_offset 16
 1427              		.cfi_offset 4, -16
 1428              		.cfi_offset 5, -12
 1429              		.cfi_offset 6, -8
 1430              		.cfi_offset 14, -4
 1431 0002 82B0     		sub	sp, sp, #8
 1432              	.LCFI34:
 1433              		.cfi_def_cfa_offset 24
 981:../../../mod/flash/flash.c **** uint8_t      flash_opcode;  /* Data to be transmitted over SPI                */
 1434              		.loc 1 981 1 is_stmt 1 view .LVU365
 982:../../../mod/flash/flash.c **** FLASH_STATUS flash_status;
 1435              		.loc 1 982 1 view .LVU366
 983:../../../mod/flash/flash.c **** 
 1436              		.loc 1 983 1 view .LVU367
 989:../../../mod/flash/flash.c **** 
 1437              		.loc 1 989 1 view .LVU368
 989:../../../mod/flash/flash.c **** 
 1438              		.loc 1 989 14 is_stmt 0 view .LVU369
 1439 0004 6023     		movs	r3, #96
 1440 0006 8DF80730 		strb	r3, [sp, #7]
 997:../../../mod/flash/flash.c ****     {
 1441              		.loc 1 997 1 is_stmt 1 view .LVU370
 997:../../../mod/flash/flash.c ****     {
 1442              		.loc 1 997 5 is_stmt 0 view .LVU371
 1443 000a 124B     		ldr	r3, .L99
 1444 000c 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 997:../../../mod/flash/flash.c ****     {
 1445              		.loc 1 997 3 view .LVU372
 1446 000e DBB1     		cbz	r3, .L96
1008:../../../mod/flash/flash.c **** 
ARM GAS  /tmp/cc2q6PEf.s 			page 53


 1447              		.loc 1 1008 1 is_stmt 1 view .LVU373
1008:../../../mod/flash/flash.c **** 
 1448              		.loc 1 1008 16 is_stmt 0 view .LVU374
 1449 0010 FFF7FEFF 		bl	write_enable
 1450              	.LVL132:
1008:../../../mod/flash/flash.c **** 
 1451              		.loc 1 1008 16 view .LVU375
 1452 0014 0446     		mov	r4, r0
 1453              	.LVL133:
1011:../../../mod/flash/flash.c **** hal_status = HAL_SPI_Transmit( &( FLASH_SPI )        ,
 1454              		.loc 1 1011 1 is_stmt 1 view .LVU376
 1455 0016 104E     		ldr	r6, .L99+4
 1456 0018 0022     		movs	r2, #0
 1457 001a 4FF48051 		mov	r1, #4096
 1458 001e 3046     		mov	r0, r6
 1459 0020 FFF7FEFF 		bl	HAL_GPIO_WritePin
 1460              	.LVL134:
1012:../../../mod/flash/flash.c **** 							   &flash_opcode         ,
 1461              		.loc 1 1012 1 view .LVU377
1012:../../../mod/flash/flash.c **** 							   &flash_opcode         ,
 1462              		.loc 1 1012 14 is_stmt 0 view .LVU378
 1463 0024 0A23     		movs	r3, #10
 1464 0026 0122     		movs	r2, #1
 1465 0028 0DF10701 		add	r1, sp, #7
 1466 002c 0B48     		ldr	r0, .L99+8
 1467 002e FFF7FEFF 		bl	HAL_SPI_Transmit
 1468              	.LVL135:
 1469 0032 0546     		mov	r5, r0
 1470              	.LVL136:
1016:../../../mod/flash/flash.c **** 
 1471              		.loc 1 1016 1 is_stmt 1 view .LVU379
 1472 0034 0122     		movs	r2, #1
 1473 0036 4FF48051 		mov	r1, #4096
 1474 003a 3046     		mov	r0, r6
 1475 003c FFF7FEFF 		bl	HAL_GPIO_WritePin
 1476              	.LVL137:
1019:../../../mod/flash/flash.c **** 	{
 1477              		.loc 1 1019 1 view .LVU380
1019:../../../mod/flash/flash.c **** 	{
 1478              		.loc 1 1019 9 is_stmt 0 view .LVU381
 1479 0040 35B9     		cbnz	r5, .L97
1023:../../../mod/flash/flash.c **** 	{
 1480              		.loc 1 1023 6 is_stmt 1 view .LVU382
1023:../../../mod/flash/flash.c **** 	{
 1481              		.loc 1 1023 9 is_stmt 0 view .LVU383
 1482 0042 14B1     		cbz	r4, .L95
1025:../../../mod/flash/flash.c **** 	}
 1483              		.loc 1 1025 9 view .LVU384
 1484 0044 0124     		movs	r4, #1
 1485              	.LVL138:
1025:../../../mod/flash/flash.c **** 	}
 1486              		.loc 1 1025 9 view .LVU385
 1487 0046 00E0     		b	.L95
 1488              	.LVL139:
 1489              	.L96:
 999:../../../mod/flash/flash.c ****     }
 1490              		.loc 1 999 12 view .LVU386
ARM GAS  /tmp/cc2q6PEf.s 			page 54


 1491 0048 0524     		movs	r4, #5
 1492              	.LVL140:
 1493              	.L95:
1032:../../../mod/flash/flash.c **** 
 1494              		.loc 1 1032 1 view .LVU387
 1495 004a 2046     		mov	r0, r4
 1496 004c 02B0     		add	sp, sp, #8
 1497              	.LCFI35:
 1498              		.cfi_remember_state
 1499              		.cfi_def_cfa_offset 16
 1500              		@ sp needed
 1501 004e 70BD     		pop	{r4, r5, r6, pc}
 1502              	.LVL141:
 1503              	.L97:
 1504              	.LCFI36:
 1505              		.cfi_restore_state
1021:../../../mod/flash/flash.c **** 	}
 1506              		.loc 1 1021 9 view .LVU388
 1507 0050 0824     		movs	r4, #8
 1508              	.LVL142:
1021:../../../mod/flash/flash.c **** 	}
 1509              		.loc 1 1021 9 view .LVU389
 1510 0052 FAE7     		b	.L95
 1511              	.L100:
 1512              		.align	2
 1513              	.L99:
 1514 0054 00000000 		.word	write_enabled
 1515 0058 00040258 		.word	1476527104
 1516 005c 00000000 		.word	hspi2
 1517              		.cfi_endproc
 1518              	.LFE154:
 1520              		.section	.text.flash_cmd_execute,"ax",%progbits
 1521              		.align	1
 1522              		.global	flash_cmd_execute
 1523              		.syntax unified
 1524              		.thumb
 1525              		.thumb_func
 1527              	flash_cmd_execute:
 1528              	.LVL143:
 1529              	.LFB144:
  93:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 1530              		.loc 1 93 1 is_stmt 1 view -0
 1531              		.cfi_startproc
 1532              		@ args = 0, pretend = 0, frame = 520
 1533              		@ frame_needed = 0, uses_anonymous_args = 0
  93:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 1534              		.loc 1 93 1 is_stmt 0 view .LVU391
 1535 0000 70B5     		push	{r4, r5, r6, lr}
 1536              	.LCFI37:
 1537              		.cfi_def_cfa_offset 16
 1538              		.cfi_offset 4, -16
 1539              		.cfi_offset 5, -12
 1540              		.cfi_offset 6, -8
 1541              		.cfi_offset 14, -4
 1542 0002 ADF5027D 		sub	sp, sp, #520
 1543              	.LCFI38:
 1544              		.cfi_def_cfa_offset 536
ARM GAS  /tmp/cc2q6PEf.s 			page 55


 1545 0006 0C46     		mov	r4, r1
  97:../../../mod/flash/flash.c **** uint8_t          num_bytes;           /* Number of bytes on which to 
 1546              		.loc 1 97 1 is_stmt 1 view .LVU392
  98:../../../mod/flash/flash.c ****                                          operate                              */
 1547              		.loc 1 98 1 view .LVU393
 100:../../../mod/flash/flash.c **** uint8_t*         pbuffer;             /* Position within flash buffer         */
 1548              		.loc 1 100 1 view .LVU394
 101:../../../mod/flash/flash.c **** uint8_t          buffer[512];         /* buffer (flash extract)               */
 1549              		.loc 1 101 1 view .LVU395
 102:../../../mod/flash/flash.c **** FLASH_STATUS     flash_status;        /* Return value of flash API calls      */
 1550              		.loc 1 102 1 view .LVU396
 103:../../../mod/flash/flash.c **** USB_STATUS       usb_status;          /* Return value of USB API calls        */
 1551              		.loc 1 103 1 view .LVU397
 104:../../../mod/flash/flash.c **** 
 1552              		.loc 1 104 1 view .LVU398
 110:../../../mod/flash/flash.c **** num_bytes = ( subcommand & FLASH_NBYTES_BITMASK    ); 
 1553              		.loc 1 110 1 view .LVU399
 110:../../../mod/flash/flash.c **** num_bytes = ( subcommand & FLASH_NBYTES_BITMASK    ); 
 1554              		.loc 1 110 11 is_stmt 0 view .LVU400
 1555 0008 4609     		lsrs	r6, r0, #5
 1556              	.LVL144:
 111:../../../mod/flash/flash.c **** pflash_handle -> num_bytes = num_bytes;
 1557              		.loc 1 111 1 is_stmt 1 view .LVU401
 111:../../../mod/flash/flash.c **** pflash_handle -> num_bytes = num_bytes;
 1558              		.loc 1 111 11 is_stmt 0 view .LVU402
 1559 000a 00F01F05 		and	r5, r0, #31
 1560              	.LVL145:
 112:../../../mod/flash/flash.c **** pbuffer   = &buffer[0];
 1561              		.loc 1 112 1 is_stmt 1 view .LVU403
 112:../../../mod/flash/flash.c **** pbuffer   = &buffer[0];
 1562              		.loc 1 112 28 is_stmt 0 view .LVU404
 1563 000e 0D70     		strb	r5, [r1]
 113:../../../mod/flash/flash.c **** memset( pbuffer, 0, sizeof( buffer ) );
 1564              		.loc 1 113 1 is_stmt 1 view .LVU405
 1565              	.LVL146:
 114:../../../mod/flash/flash.c **** address_to_bytes( pflash_handle -> address, &address[0] );
 1566              		.loc 1 114 1 view .LVU406
 1567 0010 4FF40072 		mov	r2, #512
 1568 0014 0021     		movs	r1, #0
 1569              	.LVL147:
 114:../../../mod/flash/flash.c **** address_to_bytes( pflash_handle -> address, &address[0] );
 1570              		.loc 1 114 1 is_stmt 0 view .LVU407
 1571 0016 01A8     		add	r0, sp, #4
 1572              	.LVL148:
 114:../../../mod/flash/flash.c **** address_to_bytes( pflash_handle -> address, &address[0] );
 1573              		.loc 1 114 1 view .LVU408
 1574 0018 FFF7FEFF 		bl	memset
 1575              	.LVL149:
 115:../../../mod/flash/flash.c **** 
 1576              		.loc 1 115 1 is_stmt 1 view .LVU409
 1577 001c 81A9     		add	r1, sp, #516
 1578 001e 6068     		ldr	r0, [r4, #4]
 1579 0020 FFF7FEFF 		bl	address_to_bytes
 1580              	.LVL150:
 121:../../../mod/flash/flash.c **** 	{
 1581              		.loc 1 121 1 view .LVU410
 1582 0024 062E     		cmp	r6, #6
ARM GAS  /tmp/cc2q6PEf.s 			page 56


 1583 0026 00F28880 		bhi	.L117
 1584 002a DFE806F0 		tbb	[pc, r6]
 1585              	.L104:
 1586 002e 04       		.byte	(.L110-.L104)/2
 1587 002f 26       		.byte	(.L109-.L104)/2
 1588 0030 2D       		.byte	(.L108-.L104)/2
 1589 0031 31       		.byte	(.L107-.L104)/2
 1590 0032 53       		.byte	(.L106-.L104)/2
 1591 0033 58       		.byte	(.L105-.L104)/2
 1592 0034 67       		.byte	(.L103-.L104)/2
 1593 0035 00       		.p2align 1
 1594              	.L110:
 128:../../../mod/flash/flash.c ****                                   sizeof( address ), 
 1595              		.loc 1 128 3 view .LVU411
 128:../../../mod/flash/flash.c ****                                   sizeof( address ), 
 1596              		.loc 1 128 16 is_stmt 0 view .LVU412
 1597 0036 0A22     		movs	r2, #10
 1598 0038 0321     		movs	r1, #3
 1599 003a 81A8     		add	r0, sp, #516
 1600 003c FFF7FEFF 		bl	usb_receive
 1601              	.LVL151:
 132:../../../mod/flash/flash.c **** 			{
 1602              		.loc 1 132 3 is_stmt 1 view .LVU413
 132:../../../mod/flash/flash.c **** 			{
 1603              		.loc 1 132 6 is_stmt 0 view .LVU414
 1604 0040 0028     		cmp	r0, #0
 1605 0042 7CD1     		bne	.L118
 139:../../../mod/flash/flash.c **** 			flash_status = flash_read( pflash_handle, num_bytes );
 1606              		.loc 1 139 4 is_stmt 1 view .LVU415
 1607              	.LVL152:
 1608              	.LBB12:
 1609              	.LBI12:
1070:../../../mod/flash/flash.c **** 	(
 1610              		.loc 1 1070 24 view .LVU416
 1611              	.LBB13:
1075:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[1] << 8  ) |
 1612              		.loc 1 1075 1 view .LVU417
1075:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[1] << 8  ) |
 1613              		.loc 1 1075 34 is_stmt 0 view .LVU418
 1614 0044 9DF80422 		ldrb	r2, [sp, #516]	@ zero_extendqisi2
1076:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[2] << 0  );
 1615              		.loc 1 1076 31 view .LVU419
 1616 0048 9DF80532 		ldrb	r3, [sp, #517]	@ zero_extendqisi2
1076:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[2] << 0  );
 1617              		.loc 1 1076 35 view .LVU420
 1618 004c 1B02     		lsls	r3, r3, #8
1075:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[1] << 8  ) |
 1619              		.loc 1 1075 46 view .LVU421
 1620 004e 43EA0243 		orr	r3, r3, r2, lsl #16
1077:../../../mod/flash/flash.c **** } /* address_to_bytes */
 1621              		.loc 1 1077 31 view .LVU422
 1622 0052 9DF80622 		ldrb	r2, [sp, #518]	@ zero_extendqisi2
1076:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[2] << 0  );
 1623              		.loc 1 1076 43 view .LVU423
 1624 0056 1343     		orrs	r3, r3, r2
 1625              	.LVL153:
1076:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[2] << 0  );
ARM GAS  /tmp/cc2q6PEf.s 			page 57


 1626              		.loc 1 1076 43 view .LVU424
 1627              	.LBE13:
 1628              	.LBE12:
 139:../../../mod/flash/flash.c **** 			flash_status = flash_read( pflash_handle, num_bytes );
 1629              		.loc 1 139 29 view .LVU425
 1630 0058 6360     		str	r3, [r4, #4]
 140:../../../mod/flash/flash.c **** 			
 1631              		.loc 1 140 4 is_stmt 1 view .LVU426
 140:../../../mod/flash/flash.c **** 			
 1632              		.loc 1 140 19 is_stmt 0 view .LVU427
 1633 005a 2946     		mov	r1, r5
 1634 005c 2046     		mov	r0, r4
 1635              	.LVL154:
 140:../../../mod/flash/flash.c **** 			
 1636              		.loc 1 140 19 view .LVU428
 1637 005e FFF7FEFF 		bl	flash_read
 1638              	.LVL155:
 143:../../../mod/flash/flash.c **** 				{
 1639              		.loc 1 143 4 is_stmt 1 view .LVU429
 143:../../../mod/flash/flash.c **** 				{
 1640              		.loc 1 143 7 is_stmt 0 view .LVU430
 1641 0062 08B1     		cbz	r0, .L124
 146:../../../mod/flash/flash.c **** 				}
 1642              		.loc 1 146 12 view .LVU431
 1643 0064 0125     		movs	r5, #1
 1644              	.LVL156:
 146:../../../mod/flash/flash.c **** 				}
 1645              		.loc 1 146 12 view .LVU432
 1646 0066 0BE0     		b	.L102
 1647              	.LVL157:
 1648              	.L124:
 150:../../../mod/flash/flash.c ****                                        num_bytes               ,
 1649              		.loc 1 150 4 is_stmt 1 view .LVU433
 150:../../../mod/flash/flash.c ****                                        num_bytes               ,
 1650              		.loc 1 150 17 is_stmt 0 view .LVU434
 1651 0068 6422     		movs	r2, #100
 1652 006a 2946     		mov	r1, r5
 1653 006c A068     		ldr	r0, [r4, #8]
 1654              	.LVL158:
 150:../../../mod/flash/flash.c ****                                        num_bytes               ,
 1655              		.loc 1 150 17 view .LVU435
 1656 006e FFF7FEFF 		bl	usb_transmit
 1657              	.LVL159:
 154:../../../mod/flash/flash.c **** 				{
 1658              		.loc 1 154 4 is_stmt 1 view .LVU436
 154:../../../mod/flash/flash.c **** 				{
 1659              		.loc 1 154 7 is_stmt 0 view .LVU437
 1660 0072 0546     		mov	r5, r0
 1661              	.LVL160:
 154:../../../mod/flash/flash.c **** 				{
 1662              		.loc 1 154 7 view .LVU438
 1663 0074 20B1     		cbz	r0, .L102
 157:../../../mod/flash/flash.c **** 				}
 1664              		.loc 1 157 12 view .LVU439
 1665 0076 0725     		movs	r5, #7
 1666 0078 02E0     		b	.L102
 1667              	.LVL161:
ARM GAS  /tmp/cc2q6PEf.s 			page 58


 1668              	.L109:
 170:../../../mod/flash/flash.c **** 		return FLASH_OK;
 1669              		.loc 1 170 3 is_stmt 1 view .LVU440
 1670 007a FFF7FEFF 		bl	flash_write_enable
 1671              	.LVL162:
 171:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_ENABLE */
 1672              		.loc 1 171 3 view .LVU441
 171:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_ENABLE */
 1673              		.loc 1 171 10 is_stmt 0 view .LVU442
 1674 007e 0025     		movs	r5, #0
 1675              	.LVL163:
 1676              	.L102:
 293:../../../mod/flash/flash.c **** 
 1677              		.loc 1 293 1 view .LVU443
 1678 0080 2846     		mov	r0, r5
 1679 0082 0DF5027D 		add	sp, sp, #520
 1680              	.LCFI39:
 1681              		.cfi_remember_state
 1682              		.cfi_def_cfa_offset 16
 1683              		@ sp needed
 1684 0086 70BD     		pop	{r4, r5, r6, pc}
 1685              	.LVL164:
 1686              	.L108:
 1687              	.LCFI40:
 1688              		.cfi_restore_state
 177:../../../mod/flash/flash.c **** 		return FLASH_OK;
 1689              		.loc 1 177 3 is_stmt 1 view .LVU444
 1690 0088 FFF7FEFF 		bl	flash_write_disable
 1691              	.LVL165:
 178:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_DISABLE */
 1692              		.loc 1 178 3 view .LVU445
 178:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_DISABLE */
 1693              		.loc 1 178 10 is_stmt 0 view .LVU446
 1694 008c 0025     		movs	r5, #0
 1695              	.LVL166:
 178:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_DISABLE */
 1696              		.loc 1 178 10 view .LVU447
 1697 008e F7E7     		b	.L102
 1698              	.LVL167:
 1699              	.L107:
 185:../../../mod/flash/flash.c ****                                   sizeof( address ),
 1700              		.loc 1 185 3 is_stmt 1 view .LVU448
 185:../../../mod/flash/flash.c ****                                   sizeof( address ),
 1701              		.loc 1 185 16 is_stmt 0 view .LVU449
 1702 0090 0A22     		movs	r2, #10
 1703 0092 0321     		movs	r1, #3
 1704 0094 81A8     		add	r0, sp, #516
 1705 0096 FFF7FEFF 		bl	usb_receive
 1706              	.LVL168:
 189:../../../mod/flash/flash.c **** 			{
 1707              		.loc 1 189 3 is_stmt 1 view .LVU450
 189:../../../mod/flash/flash.c **** 			{
 1708              		.loc 1 189 6 is_stmt 0 view .LVU451
 1709 009a 0028     		cmp	r0, #0
 1710 009c 51D1     		bne	.L121
 197:../../../mod/flash/flash.c **** 
 1711              		.loc 1 197 4 is_stmt 1 view .LVU452
ARM GAS  /tmp/cc2q6PEf.s 			page 59


 1712              	.LVL169:
 1713              	.LBB14:
 1714              	.LBI14:
1070:../../../mod/flash/flash.c **** 	(
 1715              		.loc 1 1070 24 view .LVU453
 1716              	.LBB15:
1075:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[1] << 8  ) |
 1717              		.loc 1 1075 1 view .LVU454
1075:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[1] << 8  ) |
 1718              		.loc 1 1075 34 is_stmt 0 view .LVU455
 1719 009e 9DF80422 		ldrb	r2, [sp, #516]	@ zero_extendqisi2
1076:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[2] << 0  );
 1720              		.loc 1 1076 31 view .LVU456
 1721 00a2 9DF80532 		ldrb	r3, [sp, #517]	@ zero_extendqisi2
1076:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[2] << 0  );
 1722              		.loc 1 1076 35 view .LVU457
 1723 00a6 1B02     		lsls	r3, r3, #8
1075:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[1] << 8  ) |
 1724              		.loc 1 1075 46 view .LVU458
 1725 00a8 43EA0243 		orr	r3, r3, r2, lsl #16
1077:../../../mod/flash/flash.c **** } /* address_to_bytes */
 1726              		.loc 1 1077 31 view .LVU459
 1727 00ac 9DF80622 		ldrb	r2, [sp, #518]	@ zero_extendqisi2
1076:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[2] << 0  );
 1728              		.loc 1 1076 43 view .LVU460
 1729 00b0 1343     		orrs	r3, r3, r2
 1730              	.LVL170:
1076:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[2] << 0  );
 1731              		.loc 1 1076 43 view .LVU461
 1732              	.LBE15:
 1733              	.LBE14:
 197:../../../mod/flash/flash.c **** 
 1734              		.loc 1 197 29 view .LVU462
 1735 00b2 6360     		str	r3, [r4, #4]
 200:../../../mod/flash/flash.c **** 				{
 1736              		.loc 1 200 4 is_stmt 1 view .LVU463
 1737              	.LBB16:
 200:../../../mod/flash/flash.c **** 				{
 1738              		.loc 1 200 10 view .LVU464
 1739              	.LVL171:
 200:../../../mod/flash/flash.c **** 				{
 1740              		.loc 1 200 14 is_stmt 0 view .LVU465
 1741 00b4 0026     		movs	r6, #0
 1742              	.LVL172:
 200:../../../mod/flash/flash.c **** 				{
 1743              		.loc 1 200 4 view .LVU466
 1744 00b6 06E0     		b	.L111
 1745              	.LVL173:
 1746              	.L112:
 202:../../../mod/flash/flash.c **** 				flash_status = usb_receive( pbuffer          , 
 1747              		.loc 1 202 5 is_stmt 1 view .LVU467
 202:../../../mod/flash/flash.c **** 				flash_status = usb_receive( pbuffer          , 
 1748              		.loc 1 202 31 is_stmt 0 view .LVU468
 1749 00b8 A068     		ldr	r0, [r4, #8]
 1750              	.LVL174:
 203:../../../mod/flash/flash.c ****                                             sizeof( uint8_t ),
 1751              		.loc 1 203 5 is_stmt 1 view .LVU469
ARM GAS  /tmp/cc2q6PEf.s 			page 60


 203:../../../mod/flash/flash.c ****                                             sizeof( uint8_t ),
 1752              		.loc 1 203 20 is_stmt 0 view .LVU470
 1753 00ba 0A22     		movs	r2, #10
 1754 00bc 0121     		movs	r1, #1
 1755 00be 3044     		add	r0, r0, r6
 1756              	.LVL175:
 203:../../../mod/flash/flash.c ****                                             sizeof( uint8_t ),
 1757              		.loc 1 203 20 view .LVU471
 1758 00c0 FFF7FEFF 		bl	usb_receive
 1759              	.LVL176:
 208:../../../mod/flash/flash.c **** 					{
 1760              		.loc 1 208 5 is_stmt 1 view .LVU472
 200:../../../mod/flash/flash.c **** 				{
 1761              		.loc 1 200 37 view .LVU473
 1762 00c4 0136     		adds	r6, r6, #1
 1763              	.LVL177:
 1764              	.L111:
 200:../../../mod/flash/flash.c **** 				{
 1765              		.loc 1 200 23 discriminator 1 view .LVU474
 1766 00c6 B542     		cmp	r5, r6
 1767 00c8 F6DC     		bgt	.L112
 1768              	.LBE16:
 218:../../../mod/flash/flash.c **** 
 1769              		.loc 1 218 3 view .LVU475
 218:../../../mod/flash/flash.c **** 
 1770              		.loc 1 218 18 is_stmt 0 view .LVU476
 1771 00ca 2046     		mov	r0, r4
 1772 00cc FFF7FEFF 		bl	flash_write
 1773              	.LVL178:
 1774 00d0 0546     		mov	r5, r0
 1775              	.LVL179:
 220:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_WRITE */
 1776              		.loc 1 220 6 is_stmt 1 view .LVU477
 220:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_WRITE */
 1777              		.loc 1 220 13 is_stmt 0 view .LVU478
 1778 00d2 D5E7     		b	.L102
 1779              	.LVL180:
 1780              	.L106:
 227:../../../mod/flash/flash.c **** 
 1781              		.loc 1 227 3 is_stmt 1 view .LVU479
 227:../../../mod/flash/flash.c **** 
 1782              		.loc 1 227 18 is_stmt 0 view .LVU480
 1783 00d4 2046     		mov	r0, r4
 1784 00d6 FFF7FEFF 		bl	flash_erase
 1785              	.LVL181:
 1786 00da 0546     		mov	r5, r0
 1787              	.LVL182:
 229:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_ERASE */
 1788              		.loc 1 229 3 is_stmt 1 view .LVU481
 229:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_ERASE */
 1789              		.loc 1 229 10 is_stmt 0 view .LVU482
 1790 00dc D0E7     		b	.L102
 1791              	.LVL183:
 1792              	.L105:
 236:../../../mod/flash/flash.c **** 
 1793              		.loc 1 236 3 is_stmt 1 view .LVU483
 236:../../../mod/flash/flash.c **** 
ARM GAS  /tmp/cc2q6PEf.s 			page 61


 1794              		.loc 1 236 18 is_stmt 0 view .LVU484
 1795 00de 2046     		mov	r0, r4
 1796 00e0 FFF7FEFF 		bl	flash_get_status
 1797              	.LVL184:
 1798 00e4 0546     		mov	r5, r0
 1799              	.LVL185:
 239:../../../mod/flash/flash.c ****                                    sizeof( uint8_t )                    ,
 1800              		.loc 1 239 3 is_stmt 1 view .LVU485
 239:../../../mod/flash/flash.c ****                                    sizeof( uint8_t )                    ,
 1801              		.loc 1 239 16 is_stmt 0 view .LVU486
 1802 00e6 0A22     		movs	r2, #10
 1803 00e8 0121     		movs	r1, #1
 1804 00ea 04F10F00 		add	r0, r4, #15
 1805 00ee FFF7FEFF 		bl	usb_transmit
 1806              	.LVL186:
 244:../../../mod/flash/flash.c **** 			{
 1807              		.loc 1 244 3 is_stmt 1 view .LVU487
 244:../../../mod/flash/flash.c **** 			{
 1808              		.loc 1 244 11 is_stmt 0 view .LVU488
 1809 00f2 40BB     		cbnz	r0, .L122
 248:../../../mod/flash/flash.c **** 			{
 1810              		.loc 1 248 8 is_stmt 1 view .LVU489
 248:../../../mod/flash/flash.c **** 			{
 1811              		.loc 1 248 11 is_stmt 0 view .LVU490
 1812 00f4 002D     		cmp	r5, #0
 1813 00f6 C3D0     		beq	.L102
 250:../../../mod/flash/flash.c **** 			}
 1814              		.loc 1 250 11 view .LVU491
 1815 00f8 0825     		movs	r5, #8
 1816              	.LVL187:
 250:../../../mod/flash/flash.c **** 			}
 1817              		.loc 1 250 11 view .LVU492
 1818 00fa C1E7     		b	.L102
 1819              	.LVL188:
 1820              	.L103:
 262:../../../mod/flash/flash.c **** 		pflash_handle->address = 0;
 1821              		.loc 1 262 3 is_stmt 1 view .LVU493
 262:../../../mod/flash/flash.c **** 		pflash_handle->address = 0;
 1822              		.loc 1 262 26 is_stmt 0 view .LVU494
 1823 00fc 01AB     		add	r3, sp, #4
 1824              	.LVL189:
 262:../../../mod/flash/flash.c **** 		pflash_handle->address = 0;
 1825              		.loc 1 262 26 view .LVU495
 1826 00fe A360     		str	r3, [r4, #8]
 263:../../../mod/flash/flash.c **** 		while( pflash_handle->address <= FLASH_MAX_ADDR )
 1827              		.loc 1 263 3 is_stmt 1 view .LVU496
 263:../../../mod/flash/flash.c **** 		while( pflash_handle->address <= FLASH_MAX_ADDR )
 1828              		.loc 1 263 26 is_stmt 0 view .LVU497
 1829 0100 0023     		movs	r3, #0
 1830              	.LVL190:
 263:../../../mod/flash/flash.c **** 		while( pflash_handle->address <= FLASH_MAX_ADDR )
 1831              		.loc 1 263 26 view .LVU498
 1832 0102 6360     		str	r3, [r4, #4]
 264:../../../mod/flash/flash.c **** 			{
 1833              		.loc 1 264 3 is_stmt 1 view .LVU499
 264:../../../mod/flash/flash.c **** 			{
 1834              		.loc 1 264 8 is_stmt 0 view .LVU500
ARM GAS  /tmp/cc2q6PEf.s 			page 62


 1835 0104 05E0     		b	.L113
 1836              	.LVL191:
 1837              	.L114:
 276:../../../mod/flash/flash.c **** 				}
 1838              		.loc 1 276 5 is_stmt 1 view .LVU501
 1839 0106 FFF7FEFF 		bl	Error_Handler
 1840              	.LVL192:
 1841              	.L115:
 280:../../../mod/flash/flash.c **** 			}
 1842              		.loc 1 280 4 view .LVU502
 280:../../../mod/flash/flash.c **** 			}
 1843              		.loc 1 280 18 is_stmt 0 view .LVU503
 1844 010a 6368     		ldr	r3, [r4, #4]
 280:../../../mod/flash/flash.c **** 			}
 1845              		.loc 1 280 29 view .LVU504
 1846 010c 03F50073 		add	r3, r3, #512
 1847 0110 6360     		str	r3, [r4, #4]
 1848              	.LVL193:
 1849              	.L113:
 264:../../../mod/flash/flash.c **** 			{
 1850              		.loc 1 264 33 is_stmt 1 view .LVU505
 264:../../../mod/flash/flash.c **** 			{
 1851              		.loc 1 264 23 is_stmt 0 view .LVU506
 1852 0112 6368     		ldr	r3, [r4, #4]
 264:../../../mod/flash/flash.c **** 			{
 1853              		.loc 1 264 33 view .LVU507
 1854 0114 B3F5002F 		cmp	r3, #524288
 1855 0118 0DD2     		bcs	.L125
 266:../../../mod/flash/flash.c **** 			if( flash_status == FLASH_OK )
 1856              		.loc 1 266 4 is_stmt 1 view .LVU508
 266:../../../mod/flash/flash.c **** 			if( flash_status == FLASH_OK )
 1857              		.loc 1 266 19 is_stmt 0 view .LVU509
 1858 011a 4FF40071 		mov	r1, #512
 1859 011e 2046     		mov	r0, r4
 1860 0120 FFF7FEFF 		bl	flash_read
 1861              	.LVL194:
 267:../../../mod/flash/flash.c **** 				{
 1862              		.loc 1 267 4 is_stmt 1 view .LVU510
 267:../../../mod/flash/flash.c **** 				{
 1863              		.loc 1 267 6 is_stmt 0 view .LVU511
 1864 0124 0028     		cmp	r0, #0
 1865 0126 EED1     		bne	.L114
 269:../../../mod/flash/flash.c **** 						      sizeof( buffer ),
 1866              		.loc 1 269 5 is_stmt 1 view .LVU512
 1867 0128 6422     		movs	r2, #100
 1868 012a 4FF40071 		mov	r1, #512
 1869 012e 01A8     		add	r0, sp, #4
 1870              	.LVL195:
 269:../../../mod/flash/flash.c **** 						      sizeof( buffer ),
 1871              		.loc 1 269 5 is_stmt 0 view .LVU513
 1872 0130 FFF7FEFF 		bl	usb_transmit
 1873              	.LVL196:
 269:../../../mod/flash/flash.c **** 						      sizeof( buffer ),
 1874              		.loc 1 269 5 view .LVU514
 1875 0134 E9E7     		b	.L115
 1876              	.LVL197:
 1877              	.L125:
ARM GAS  /tmp/cc2q6PEf.s 			page 63


 283:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_EXTRACT */
 1878              		.loc 1 283 10 view .LVU515
 1879 0136 0025     		movs	r5, #0
 1880              	.LVL198:
 283:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_EXTRACT */
 1881              		.loc 1 283 10 view .LVU516
 1882 0138 A2E7     		b	.L102
 1883              	.LVL199:
 1884              	.L117:
 121:../../../mod/flash/flash.c **** 	{
 1885              		.loc 1 121 1 view .LVU517
 1886 013a 0325     		movs	r5, #3
 1887              	.LVL200:
 121:../../../mod/flash/flash.c **** 	{
 1888              		.loc 1 121 1 view .LVU518
 1889 013c A0E7     		b	.L102
 1890              	.LVL201:
 1891              	.L118:
 134:../../../mod/flash/flash.c **** 			}
 1892              		.loc 1 134 11 view .LVU519
 1893 013e 0725     		movs	r5, #7
 1894              	.LVL202:
 134:../../../mod/flash/flash.c **** 			}
 1895              		.loc 1 134 11 view .LVU520
 1896 0140 9EE7     		b	.L102
 1897              	.LVL203:
 1898              	.L121:
 192:../../../mod/flash/flash.c ****             }
 1899              		.loc 1 192 11 view .LVU521
 1900 0142 0725     		movs	r5, #7
 1901              	.LVL204:
 192:../../../mod/flash/flash.c ****             }
 1902              		.loc 1 192 11 view .LVU522
 1903 0144 9CE7     		b	.L102
 1904              	.LVL205:
 1905              	.L122:
 246:../../../mod/flash/flash.c **** 			}
 1906              		.loc 1 246 11 view .LVU523
 1907 0146 0725     		movs	r5, #7
 1908              	.LVL206:
 246:../../../mod/flash/flash.c **** 			}
 1909              		.loc 1 246 11 view .LVU524
 1910 0148 9AE7     		b	.L102
 1911              		.cfi_endproc
 1912              	.LFE144:
 1914              		.section	.bss.write_enabled,"aw",%nobits
 1917              	write_enabled:
 1918 0000 00       		.space	1
 1919              		.text
 1920              	.Letext0:
 1921              		.file 2 "/usr/lib/gcc/arm-none-eabi/12.2.0/include/stddef.h"
 1922              		.file 3 "/usr/arm-none-eabi/include/machine/_default_types.h"
 1923              		.file 4 "/usr/arm-none-eabi/include/sys/_stdint.h"
 1924              		.file 5 "../../../lib/Drivers/CMSIS/Device/ST/STM32H7xx/Include/stm32h750xx.h"
 1925              		.file 6 "../../../lib/Drivers/STM32H7xx_HAL_Driver/Inc/stm32h7xx_hal_def.h"
 1926              		.file 7 "../../../lib/Drivers/STM32H7xx_HAL_Driver/Inc/stm32h7xx_hal_gpio.h"
 1927              		.file 8 "../../../lib/Drivers/STM32H7xx_HAL_Driver/Inc/stm32h7xx_hal_dma.h"
ARM GAS  /tmp/cc2q6PEf.s 			page 64


 1928              		.file 9 "../../../lib/Drivers/STM32H7xx_HAL_Driver/Inc/stm32h7xx_hal_spi.h"
 1929              		.file 10 "../../../mod/flash/flash.h"
 1930              		.file 11 "../../../mod/usb/usb.h"
 1931              		.file 12 "../../../lib/Drivers/STM32H7xx_HAL_Driver/Inc/stm32h7xx_hal.h"
 1932              		.file 13 "/usr/arm-none-eabi/include/string.h"
 1933              		.file 14 "../../../lib/sdr_pin_defines_A0002.h"
 1934              		.file 15 "./main.h"
 1935              		.file 16 "<built-in>"
ARM GAS  /tmp/cc2q6PEf.s 			page 65


DEFINED SYMBOLS
                            *ABS*:0000000000000000 flash.c
     /tmp/cc2q6PEf.s:20     .text.address_to_bytes:0000000000000000 $t
     /tmp/cc2q6PEf.s:25     .text.address_to_bytes:0000000000000000 address_to_bytes
     /tmp/cc2q6PEf.s:52     .text.write_disable:0000000000000000 $t
     /tmp/cc2q6PEf.s:57     .text.write_disable:0000000000000000 write_disable
     /tmp/cc2q6PEf.s:128    .text.write_disable:0000000000000040 $d
     /tmp/cc2q6PEf.s:134    .text.write_enable:0000000000000000 $t
     /tmp/cc2q6PEf.s:139    .text.write_enable:0000000000000000 write_enable
     /tmp/cc2q6PEf.s:210    .text.write_enable:0000000000000040 $d
     /tmp/cc2q6PEf.s:216    .text.flash_get_status:0000000000000000 $t
     /tmp/cc2q6PEf.s:222    .text.flash_get_status:0000000000000000 flash_get_status
     /tmp/cc2q6PEf.s:313    .text.flash_get_status:0000000000000064 $d
     /tmp/cc2q6PEf.s:319    .text.flash_set_status:0000000000000000 $t
     /tmp/cc2q6PEf.s:325    .text.flash_set_status:0000000000000000 flash_set_status
     /tmp/cc2q6PEf.s:458    .text.flash_set_status:00000000000000a4 $d
     /tmp/cc2q6PEf.s:1917   .bss.write_enabled:0000000000000000 write_enabled
     /tmp/cc2q6PEf.s:465    .text.flash_is_flash_busy:0000000000000000 $t
     /tmp/cc2q6PEf.s:471    .text.flash_is_flash_busy:0000000000000000 flash_is_flash_busy
     /tmp/cc2q6PEf.s:537    .text.flash_write_enable:0000000000000000 $t
     /tmp/cc2q6PEf.s:543    .text.flash_write_enable:0000000000000000 flash_write_enable
     /tmp/cc2q6PEf.s:560    .text.flash_write_enable:0000000000000008 $d
     /tmp/cc2q6PEf.s:565    .text.flash_write_disable:0000000000000000 $t
     /tmp/cc2q6PEf.s:571    .text.flash_write_disable:0000000000000000 flash_write_disable
     /tmp/cc2q6PEf.s:588    .text.flash_write_disable:0000000000000008 $d
     /tmp/cc2q6PEf.s:593    .text.flash_init:0000000000000000 $t
     /tmp/cc2q6PEf.s:599    .text.flash_init:0000000000000000 flash_init
     /tmp/cc2q6PEf.s:728    .text.flash_write_byte:0000000000000000 $t
     /tmp/cc2q6PEf.s:734    .text.flash_write_byte:0000000000000000 flash_write_byte
     /tmp/cc2q6PEf.s:877    .text.flash_write_byte:0000000000000098 $d
     /tmp/cc2q6PEf.s:884    .text.flash_write:0000000000000000 $t
     /tmp/cc2q6PEf.s:890    .text.flash_write:0000000000000000 flash_write
     /tmp/cc2q6PEf.s:1226   .text.flash_write:0000000000000174 $d
     /tmp/cc2q6PEf.s:1233   .text.flash_read:0000000000000000 $t
     /tmp/cc2q6PEf.s:1239   .text.flash_read:0000000000000000 flash_read
     /tmp/cc2q6PEf.s:1403   .text.flash_read:00000000000000b0 $d
     /tmp/cc2q6PEf.s:1410   .text.flash_erase:0000000000000000 $t
     /tmp/cc2q6PEf.s:1416   .text.flash_erase:0000000000000000 flash_erase
     /tmp/cc2q6PEf.s:1514   .text.flash_erase:0000000000000054 $d
     /tmp/cc2q6PEf.s:1521   .text.flash_cmd_execute:0000000000000000 $t
     /tmp/cc2q6PEf.s:1527   .text.flash_cmd_execute:0000000000000000 flash_cmd_execute
     /tmp/cc2q6PEf.s:1586   .text.flash_cmd_execute:000000000000002e $d
     /tmp/cc2q6PEf.s:1918   .bss.write_enabled:0000000000000000 $d
     /tmp/cc2q6PEf.s:1593   .text.flash_cmd_execute:0000000000000035 $d
     /tmp/cc2q6PEf.s:1593   .text.flash_cmd_execute:0000000000000036 $t

UNDEFINED SYMBOLS
HAL_GPIO_WritePin
HAL_SPI_Transmit
hspi2
HAL_SPI_Receive
HAL_Delay
memset
usb_receive
usb_transmit
Error_Handler
